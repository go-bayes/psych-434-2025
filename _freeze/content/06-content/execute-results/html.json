{
  "hash": "8d64260b0dd4244f03bb8d344f31ac71",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Causal Inference: Effect-Modification and Interaction\"\ndate: \"2025-APR-01\"\nbibliography: /Users/joseph/GIT/templates/bib/references.bib\neditor_options: \n  chunk_output_type: console\nformat:\n  html:\n    warnings: FALSE\n    error: FALSE\n    messages: FALSE\n    code-overflow: scroll\n    highlight-style: kate\n    code-tools:\n      source: true\n      toggle: FALSE\nhtml-math-method: katex\nreference-location: margin\ncitation-location: margin\ncap-location: margin\ncode-block-border-left: true\n---\n\n\n```{=html}\n<style>\n  .boxedblue {\n      border: 2px solid blue;\n      border-radius: 4px; /* slight roundness */\n      padding: 3px 6px; /* vertical | horizontal */\n      display: inline-block;\n      color: blue;\n  }\n  .circleblue {\n      border: 2px dashed blue;\n      border-radius: 50%;\n      padding: 3px 6px;\n      display: inline-block;\n      color: blue;\n  }\n</style>\n```\n\n\n\n\n::: {.callout-note}\n**Required**\n- [@hernan2024WHATIF] Chapters 4-5 [link](https://www.dropbox.com/scl/fi/9hy6xw1g1o4yz94ip8cvd/hernanrobins_WhatIf_2jan24.pdf?rlkey=8eaw6lqhmes7ddepuriwk5xk9&dl=0)\n\n**Optional**\n- [@vanderweele2007FOURTYPESOFEFFECT] [link](https://www.dropbox.com/scl/fi/drytp2ui2b8o9jplh4bm9/four_types_of_effect_modification__a.6.pdf?rlkey=mb9nl599v93m6kyyo69iv5nz1&dl=0)\n- [@vanderweele2009distinction] [link](https://www.dropbox.com/scl/fi/srpynr0dvjcndveplcydn/OutcomeWide_StatisticalScience.pdf?rlkey=h4fv32oyjegdfl3jq9u1fifc3&dl=0)\n:::\n\n::: {.callout-important}\n## Key concepts for the test(s):\n  - **Causal Estimand**\n  - **Statistical Estimand**\n  - **Interaction/Moderation**\n  - **Heterogeneous Treatment Effects**\n  - **Conditional Average Treatment Effect**\n  - **Effect Modification**\n:::\n\n\n## If you learning nothing else from this course...\n\n\nTo answer a psychological question we must first ask it.\n\n\n## Causal inference begins by stating a counterfactual contrast\n\n\nIn the simpliest case, we calculate the contrast between two or more \"treatments\" or equivalently \"exposures\"\n\n\n\n$$\n\\text{Average Treatment Effect} = \\mathbb{E}[Y(a^*) -Y(a)]\n$$\n\n\n\nUnderstanding causal inference is fundamentally about comparing what happened with what could have happened *an average* under different conditions or treatments *in some population*, while carefully accounting for factors that might confound or distort the comparison that interests us (i.e. that might give a false answer to the question we asked).\n\n\n##  In Causal Inference, What do the words \"Moderation\" and \"Interaction\" mean? \n\n\nWe here these words used freely in psychology.  What do they mean?   Causal inference allows us to be precise. \n\n\nLet's set the term *moderation* to the side, and in its place consider \"effect-modification.\" Our task today is to use counterfactual notation to distinguish between two concepts: \n\n1. Interaction\n2. Effect-modification\n\n\n## Interaction\n\n\nAn interaction is a **joint intervention**\n\nWhen assessing \"interaction\" we are interested in  the combined effect of two interventions (two \"treatments\" or \"exposures\").  \n\nCall these treatments, $A$ and $B$.  Call the outcome $Y$.\n\nRecall that in potential outcomes terminology, we defined the potential outcome under treatment $A = \\tilde{a}$:\n\n$$\nY(\\tilde{a})\n$$\n\nAnd we identify $Y(\\tilde{a})$ from data using the consistency assumption: $Y_i(\\tilde{a}) = (Y_i |A_i = \\tilde{a})$, assuming that $Y_i(\\tilde{a})\\coprod A|L$, where, again, $L$ donotes a set of measured covariates sufficient to insure no confounding (no common causes), or equivalently, no open backdoor path between $A$ and $Y$.\n\n\nA joint intervention of two treatments, call them $A$ and $B$, which may act on $Y$, requires that we extend our notation:\n\n$$\nY(\\tilde{a}, \\tilde{b})\n$$\nThis is the effect on $Y$ when $A$ is set to $\\tilde{a}$ amd $B$ is set to $\\tilde{b}$.\n\n\nIn addition to requiring $Y_i(\\tilde{a}) = (Y_i \\mid A_i = \\tilde{a})$, assuming that $Y_i(\\tilde{a}) \\coprod A \\mid L$, we require that for all $i \\in 1\\dots N$ individuals in the target population, both $Y_i(\\tilde{b}) = (Y_i \\mid B_i = \\tilde{b})$, and that $Y_i(\\tilde{b}) \\coprod B \\mid Q$, where $Q$ denotes a set of confounders sufficient to ensure no confounding for the effect of $B$ on $Y$. \n\nNotably, the sets $L$ and $Q$ may have overlapping variables, which in set notation we write: \n\n$$\nL \\cap Q \\not\\equiv \\emptyset\n$$\n\nThat is the union of $L$ and $Q$ does not imply the empty set,  which implies that identification may be harder when there are interactions.  Statistical estimation is more difficult too, but we'll ignore that. \n\n\n\n### How do we define such a contrast between two interventions of equal status in our model? \n\n\nConsider the effect of beliefs in Big Gods (treatment, denoted  $A$) on social complexity (outcome, denoted$Y$), potentially influenced by a culture's monumental architecture (treatment, denoted $B$). Suppose we wish to assess the individual and combined effects of $A$ and $B$ on the difference scale.  Let assume the treatments are binary variables.\n\n\nIn the counterfactual framework, we say there is evidence for interaction only if the following inequality were to hold:\n\n$$\\bigg(\\underbrace{\\mathbb{E}[Y(1,1)]}_{\\text{joint exposure}} - \\underbrace{\\mathbb{E}[Y(0,0)]}_{\\text{neither exposed}}\\bigg) - \\bigg[ \\bigg(\\underbrace{\\mathbb{E}[Y(1,0)]}_{\\text{only A exposed}} - \\underbrace{\\mathbb{E}[Y(0,0)]}_{\\text{neither exposed}}\\bigg) + \\bigg(\\underbrace{\\mathbb{E}[Y(0,1)]}_{\\text{only B exposed}} - \\underbrace{\\mathbb{E}[Y(0,0)]}_{\\text{neither exposed}} \\bigg)\\bigg] \\neq 0 $$\n\n\nExpanding the terms inside the brackets:\n\n   $$ \\mathbb{E}[Y(1,1)] - \\mathbb{E}[Y(0,0)] - \\mathbb{E}[Y(1,0)] + \\mathbb{E}[Y(0,0)] - \\mathbb{E}[Y(0,1)] + \\mathbb{E}[Y(0,0)] $$\n\n\nAnd cancelling $\\mathbb{E}[Y(0,0)]$, which appears three times, once with a minus sign and twice with a plus sign, simplifies to:\n\n\n   $$ \\mathbb{E}[Y(1,1)] - \\mathbb{E}[Y(1,0)] - \\mathbb{E}[Y(0,1)] + \\mathbb{E}[Y(0,0)] $$\n\n\nAnd we define interaction on the additive scale:\n\n$$ \\underbrace{\\mathbb{E}[Y(1,1)]}_{\\text{joint exposure}} - \\underbrace{\\mathbb{E}[Y(1,0)]}_{\\text{only A exposed}} - \\underbrace{\\mathbb{E}[Y(0,1)]}_{\\text{only B exposed}} + \\underbrace{\\mathbb{E}[Y(0,0)]}_{\\text{neither exposed}} \\neq 0 $$\n\nThe estimand is net interaction effect, after accounting for the individual effects of $A$ and $B$, as well as the baseline where neither treatment $A$ nor treatment $B$ is given.\n\n\n\nA positive value would indicate evidence for additive interaction. A negative value would indicate evidence for sub-additive interaction. A value near zero would imply no reliable evidence for interaction.\n\n\nNote that the order of the terms does not matter: \n\n\n$$\nY(\\tilde{a}, \\tilde{b})\\equiv Y(\\tilde{b}, \\tilde{a})\n$$\n\n\n#### Having defined the causal estimand, we next consider what would be needed to identify it using data?\n\nFor this we can write our causal diagram. @fig-dag-interaction describes the structure of the identification problem:\n\n::: {.cell}\n::: {.cell-output-display}\n![This diagram presents the individual and joint effects of two exposures, A and B, on outcome Y. We assume that A and B are causally independent. If either exposure affects the other, then we may conduct effect-modification analysis or mediation analysis, but we should avoid causal interaction analysis. The diagram includes confounders L and W. Control for these confounders is necessary to close the backdoor paths that relate each exposure, A and B, to the outcome. Each exposure has equal status in our model: Y(a,b) = Y(b,a). The red path denotes paths of confounding.](06-content_files/figure-html/fig-dag-interaction-1.png){#fig-dag-interaction width=100%}\n:::\n:::\n\nHere, @fig-dag-interaction clarifies the need to evaluate two sources of counfounding, one for each intervention ($A$ and $B$).\n\nBy adjusting for $L_{0}$ we obtain an unbiased estimate of the $A\\to Y$ path. \n\nBy adjusting for $Q_{0}$ we obtain an unbiased estimate of the $B\\to Y$ path. As indicated in @fig-dag-interaction-solved, we must condition on both $L_{0}$ and $Q_{0}$ to identify causal interaction conceived as a joint interaction. \n\n\n<!-- [^noteinteraction] -->\n\n<!--  [^noteinteraction]: An important complication is that evidence for causal interaction may differ depending on the measurement scale one chooses to assess it [@vanderweele2014; @vanderweele2012; @vanderweele2014]. For most applications in psychological science we would use the the causal difference scale (refer to @vanderweele2014 for discussion).  We set this complication to the side, noting that investigators must state the scale of causal contrast on which there study focusses.  -->\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![We adjust for confounding in causal interaction analysis by adjusting for all confounders of the A to Y path as well as all for the B to Y path. The box over the confounders indicates the biasing paths are closed.](06-content_files/figure-html/fig-dag-interaction-solved-1.png){#fig-dag-interaction-solved width=80%}\n:::\n:::\n\n\nConsider the following set of plausible confounders:\n\n**L**: variables in $L$ that might confound the relationship between beliefs in Big Gods and social complexity:\n\n1. **General religiosity**: prevalence of religion might influence both the belief in Big Gods and social complexity.\n2. **Cultural norms and values**: ingrained social norms and values, not any part of religion.\n3. **Historical path dependent events**: e.g. conquest.\n4. **Education**: affects religious beliefs and the complexity.\n5. **Economic development**: economic conditions might whether people prefer religious practices or resource intensive hobbies and also, social complexity.\n6. **Political stability**: stable governance can influence both the proliferation of religious practices and the development of complex social structures\n7. **Political complexity in the past**:  huge confounder, must be adjusted for.\n8. **Beliefs in big gods in the past**: huge confounder, must be adjusted for.\n\n**Q**: variables in $Q$ that that might confound the relationship between monumental architecture and social complexity:\n \n1. **Technology**: for constructing of monumental architecture and managing social complexity.\n2. **Economic resources**: as above (overlap)\n3. **Historical path dependent events**: e.g. conquestm as above\n4. **Labour**: the availability of builders, slaves, etc.\n5. **Geography**: natural resources can affect a society's ability to build monumental structures and its social development.\n6. **Cultural norms and values**: ingrained social norms and values, not any part of religion.\n7. **Political complexity in the past**:  huge confounder, must be adjusted for.\n8. **Beliefs in big gods in the past**: huge confounder, must be adjusted for.\n\n\n\nAs we see:\n\n$$\nL \\cap Q \\not\\equiv \\emptyset\n$$\n\n\nHowever, the set of control variables are larger, and note, we are assuming that monumental architecture and big God beliefs do not affect each other. \n\n\n## Effect Modification\n\n**It is often scientifically interesting to consider whether treatment effects vary over levels of other variable without imagining a double intervention.** \nBroadly, we will think of \"effect-modification\" as a set of related and overlapping concepts pertaining to the understanding variability of a single effect within a population.  \n\n\n### Heterogeneous Treatment Effects -- a broad concept of effect-modification\n\n\nHeterogeneous Treatment Effects (HTE) refer to settings where treatment effects vary across individuals or subgroups within a study population. This variability can arise from differences in baseline characteristics, environmental conditions, histories, .... much of which is unmeasured. \n\n**Appendix A** discusses the challenges in identifying HTE from data, but we already know that individual causal effects are not typically identifiable, and so heteroeneous treatment effects, at the limit of individual causal effects, are elusive. \n\n\n\n### Conditional Average Treatment Effect (CATE) -- a narrower concept of effect-modification.\n\nWe might be interested estimating average treatment effects within specific levels of measured covariates\n\nWhen our focus is estimation of the average treatment effect conditional on a specific level of a covariate or set of covariates. Our causal estimand is often written:\n\n $$\\text{CATE}(x) = E[Y(1) - Y(0) | X = x]$$ \n \n where $X = x$, where $X$ denotes the level of a measured covariate or covariates of interest. \n\nThe question: how does a causal effect vary within the population defined by levels of stratum $X=x$ \n\n\n### Comparing Effect Heterogenity in Groups. \n\n\n\nWe might be interested in the following causal quantity (estimand), which compares two conditional average treatment effects between levels defined by $G = \\tilde{g}$:\n\n\n$${\\gamma} = \\overbrace{\\big( \\mathbb{E}[Y(a^*)|G=g] - \\mathbb{E}[Y(a)|G=g] \\big)}^{{\\delta_g}} - \\overbrace{\\big(\\mathbb{E}[Y(a^*)|G=g^{\\prime}]- \\mathbb{E}[Y(a)|G=g']\\big)}^{{\\delta_{g^{\\prime}}}}$$\n\n\nSuppose $A$ is the treatment, $G$ is the effect-modifier, and $Y$ is the outcome. The analysis of effect-modification assesses whether the effect of $A$ on $Y$ is different across levels of $G$ (i.e., whether the effect of $A$ on $Y$ is different when $G = g_1$ compared to when $G = g_2$).\n\nWhat do we need to identify such effects?  Note that $G$ here is not an intervention variable. It might not be coherent to imagine that $G$ *can* be intervened upon. \n\n@fig-dag-effect-modification is a causal diagram. Imagine we are intereste in whether the effect of $A$ on $Y$ differs across levels of $G$. Because we are not interested in the causal effect of $G$ as such, but rather, how the effect of $A$ varies across $G$, we need *not* adjust by $Q$.  However, which variables shall we include in our model?  What will happen if we assess the $G$ by examining a regression coefficient?  Suppose $L$ were not a confounder of $A$ to $Y$.  How then should we interpret our model?  \n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Imagine A is an experiment. How shall we investigate effect modification of A on Y by Z? Can you see why regression coefficients will not work?](06-content_files/figure-html/fig-dag-effect-modification-1.png){#fig-dag-effect-modification width=80%}\n:::\n:::\n\n\n\nOften, it is useful to obtain causal effects by restricting to one level of a population. Where $G$ denotes a society, consider:\n\n\n\n\n1.  **Causal effect within North American societies (**$G=1$):\n    $$\\delta_{g_1} = \\mathbb{E}[Y(1)|G= g_1] - \\mathbb{E}[Y(0)|G = g_1]$$ \n    \nHere, $\\delta_{g_2}$ represents the estimated causal effect of changing the exposure from $A = 0$ to $A = 1$ within the North American societies.\n\n2.  **Causal effect within Continental societies (**$G=g_2$):\n\n    $$\\delta_{g2} = \\mathbb{E}[Y(1)|G=g_2] - \\mathbb{E}[Y(0)|G=g_2]$$\n\n    Similarly, ${\\delta}_{g_2}$ denotes the estimated causal effect for the Continental societies.\n\n3.  **Comparing causal effects across groups**:\n\n    $${\\gamma} = {\\delta}_{g_1} - {\\delta}_{g_2}$$ \n    \nThe quantity ${\\gamma}$ defines the difference in the causal estimands between the two groups. A nonzero $\\hat{\\gamma}$ indicates effect-modification, suggesting that the effect of changing the exposure differs between the two groups. If we were to observe that $\\hat{\\gamma} \\neq 0$, this would provide evidence for variability in the effect of the exposure on the outcome in different groups. Note that the causal effect for one group might be indistinguishable from zero, and yet we might nevertheless find evidence for effect-modification if the comparison group exhibits reliably different responses from the contrast group that is indistinguishable from zero.\n\n\n\nThat's it, we now know our causal quantity of interest.  Next week, we'll develop our statistical estimands, estimators, and begin evaluating effect-modification by groups. \n\n\n### Summary of what we learned\n\n- Interaction targets a joint intervention in a population\n- Effect modificiation targets how a single intervention varies by groups within a population\n\nNote, to obtain the group-wise contrasts, we must be able to imagine the groups as belonging to a larger population. When thinking of people, we all belong Later we shall consider how measurement complicates this assumption, even if all humans belong to the same species...\n\n\n## Lab Part 1: Setting up your data\n\n\n### Set up your libraries\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"margot\")\nlibrary(\"tidyverse\")\nlibrary(\"ggplot2\")\nlibrary(\"here\")\nlibrary(\"skimr\")\nif (!require(gtsummary)) install.packages(\"gtsummary\")\nif (!require(janitor)) install.packages(\"janitor\")\n\n\n# if you need to update the margot package, uncomment and do this\n# devtools::install_github(\"go-bayes/margot\")\n#devtools::install_github(\"go-bayes/margot\")\n```\n:::\n\n\n\n\n### Set up a path to a folder in your directory \n\n\nThis will allow you to save the outputs of models and other information, which will be handy when you are producing your manuscript. Call this `push_mods`\n\n::: {.cell}\n\n```{.r .cell-code}\n### Set up a path to a folder in your directory \n\n# create a folder called saved and make a path like this\npush_mods <- here::here('/Users/joseph/v-project\\ Dropbox/data/courses/25-psych-434')\n\n# view it (will be different for you)\npush_mods\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"/Users/joseph/v-project Dropbox/data/courses/25-psych-434\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# another option\n# saveRDS(object, here::here(push_mods, \"object\"))\n```\n:::\n\n\n\n### Initial Data Wrangling to select the study sample\n\n#### Where to find variable names information\n\nFind it the data directory here: <https://osf.io/75snb/>\n\nAlso see here: <https://github.com/go-bayes/templates/tree/main/method>\n\n\n#### Think, what are my eligibility criteria? \n\n- Participated in at baseline\n- Participated at treatment wave\n- May have been lost to follow up at the end of the study\n- Full information on the treatment variable (think about this...)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(margot)\nlibrary(tidyverse)\nlibrary(table1)\n# eliminate haven labels\ndf_nz <- as.data.frame(df_nz)\ndf_nz <- haven::zap_formats(df_nz)\ndf_nz <- haven::zap_label(df_nz)\ndf_nz <- haven::zap_widths(df_nz)\n\n# name output folder\npush_mods <- here::here(\"outputs\")\n\n# set exposure name\nname_exposure <-  \"perfectionism\"\n\n# obtain ids for individuals who participated in 2018 and have no missing baseline exposure\nids_2018 <- df_nz %>%\n   dplyr::filter(year_measured == 1, wave == 2018) %>%\n   dplyr::filter(!is.na(!!sym(name_exposure))) |> # criteria, no missing\n  pull(id)\n\n# obtain ids for individuals who participated in 2019\nids_2019 <- df_nz %>%\n   dplyr::filter(year_measured == 1, wave == 2019) %>%\n   dplyr::filter(!is.na(!!sym(name_exposure))) |> # criteria, no missing\n  pull(id)\n\n# intersect IDs from 2018 and 2019 to ensure participation in both years\nids_2018_2019 <- intersect(ids_2018, ids_2019)\n\n# data wrangling\ndat_long <- df_nz |>\n  dplyr::filter(id %in% ids_2018_2019 &\n                  wave %in% c(2018, 2019, 2020)) |>\n  arrange(id, wave) |>\n  select(\n    \"id\",\n    \"wave\",\n    \"year_measured\",\n    \"age\",\n    \"male\",\n    \"born_nz\",\n    \"eth_cat\",\n    #factor(EthCat, labels = c(\"Euro\", \"Maori\", \"Pacific\", \"Asian\")),\n    \"employed\",\n    # Are you currently employed? (this includes self-employment or casual work)\n    \"edu\",\n    # \"gen_cohort\",\n    \"household_inc\",\n    \"partner\",\n    # 0 = no, 1 = yes\n    \"parent\",\n    \"alert_level_combined_lead\", # see bibliography\n    # 0 = no, 1 = yes\n    \"political_conservative\", # see nzavs sheet\n    \"hours_exercise\", # see nzavs sheet\n    \"agreeableness\", \n    # Mini-IPIP6 Agreeableness (also modelled as empathy facet)\n    # Sympathize with others' feelings.\n    # Am not interested in other people's problems.\n    # Feel others' emotions.\n    # Am not really interested in others.\n    \"conscientiousness\",\n    # see mini ipip6\n    # Get chores done right away.\n    # Like order.\n    # Make a mess of things.\n    # Often forget to put things back in their proper place.\n    \"extraversion\",\n    # Mini-IPIP6 Extraversion\n    # Am the life of the party.\n    # Don't talk a lot.\n    # Keep in the background.\n    # Talk to a lot of different people at parties.\n    \"honesty_humility\",\n    # see mini ipip6\n    # Would like to be seen driving around in a very expensive car.\n    # Would get a lot of pleasure from owning expensive luxury goods.\n    # Feel entitled to more of everything.\n    # Deserve more things in life.\n    \"openness\",\n    # see mini ipip6\n    # Have a vivid imagination.\n    # Have difficulty understanding abstract ideas.\n    # Do not have a good imagination.\n    # Am not interested in abstract ideas.\n    \"neuroticism\",\n    # see mini ipip6\n    # Have frequent mood swings.\n    # Am relaxed most of the time.\n    # Get upset easily.\n    # Seldom feel blue.\n    \"modesty\",\n    # # see mini ipip6\n    # # I want people to know that I am an important person of high status,\n    # # I am an ordinary person who is no better than others.\n    # # I wouldnâ€™t want people to treat me as though I were superior to them.\n    # # I think that I am entitled to more respect than the average person is\n    #\"w_gend_age_ethnic\",\n    \"sample_weights\", # see nzavs sheet\n    \"neighbourhood_community\",\n    # #I feel a sense of community with others in my local neighbourhood.\n    \"belong\", # see nzavs sheet\n    \"rural_gch_2018_l\",# see nzavs sheet\n    \"support\",\n    # \"support_help\",\n    # # 'There are people I can depend on to help me if I really need it.\n    # \"support_turnto\",\n    # # There is no one I can turn to for guidance in times of stress.\n    # \"support_rnoguidance\",\n    #There is no one I can turn to for guidance in times of stress.\n    \"perfectionism\",\n    \"religion_religious\",\n    \"kessler_latent_depression\",\n    \"kessler_latent_anxiety\"\n  ) |>\n  mutate(\n    #initialize 'censored'\n    censored = ifelse(lead(year_measured) == 1, 1, 0),\n    \n    # modify 'censored' based on the condition; no need to check for NA here as 'censored' is already defined in the previous step\n    censored =  ifelse(is.na(censored) &\n                         year_measured == 1, 1, censored)\n  ) |>\n  select(-year_measured) |>\n  dplyr::mutate(\n    # rescale these variables, to get all variables on a similar scale\n    # otherwise your models can blow up, or become uninterpretable. \n    household_inc_log = log(household_inc + 1),\n    hours_exercise_log = log(hours_exercise + 1)  ) |>\n  dplyr::select(\n    -c(\n      household_inc,\n      hours_exercise)\n  ) |>\n  droplevels() |>\n  # dplyr::rename(sample_weights = w_gend_age_ethnic,\n  #               sample_origin =  sample_origin_names_combined) |>\n  arrange(id, wave) |>\n  mutate(\n  rural_gch_2018_l = as.numeric(as.character(rural_gch_2018_l)),\n  #   parent = as.numeric(as.character(parent)),\n  partner = as.numeric(as.character(partner)),\n  born_nz = as.numeric(as.character(born_nz)),\n  censored = as.numeric(as.character(censored)),\n  employed = as.numeric(as.character(employed))\n  ) |>\n  droplevels() |>\n  data.frame() |>\n  droplevels() |>\n  arrange(id, wave) |>\n  data.frame()\n\n# check n in this sample\nn_participants <- skimr::n_unique(dat_long$id)\n\n\n# make number pretty\nn_participants<- prettyNum(n_participants,big.mark=\",\")\n\n# save this so that you can use it in your manuscript\nmargot::here_save(n_participants, \"n_participants\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nObject saved to: /Users/joseph/GIT/psych-434-2025/outputs/n_participants.rds\nObject size: 0.00 MB\nðŸ‘ Save operation completed successfully!\n```\n\n\n:::\n\n```{.r .cell-code}\n# try reading \nn_participants_did_it_work_question_mark <- margot::here_read(\"n_participants\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nObject read from: /Users/joseph/GIT/psych-434-2025/outputs/n_participants.rds\nObject size: 0.00 MB\nðŸ‘ Read operation completed successfully!\n```\n\n\n:::\n\n```{.r .cell-code}\n# view\n# n_participants_did_it_work_question_mark\n```\n:::\n\nThere are N = 14,439 participants.\n\n### Define your baseline covariates, treatment (exposure), and outcome\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# for example \nbaseline_vars = c(\"age\", \"male\", \"edu\", \"eth_cat\", \"partner\", \"employed\", \"born_nz\", \"neighbourhood_community\", \"household_inc_log\",\n\"parent\", \"religion_religious\", \"rural_gch_2018_l\",\"sample_weights\", \"employed\", \"alert_level_combined_lead\")\n\n# treatment\nexposure_var = c(\"perfectionism\", \"censored\") # we will use the censored variable later\n\n# outcome, can be many\noutcome_vars = c(\"kessler_latent_anxiety\", \"kessler_latent_depression\")\n\n# define waves\nbaseline_wave = \"2018\"\n\n# exposure waves\nexposure_waves = c(\"2018\",\"2019\")\n\n#outcome wave\noutcome_wave = \"2020\"\n\n# exoposure\nname_exposure = \"perfectionism\"\n```\n:::\n\n\n### Make your baseline table\n\n\n### Make tables\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntables <- margot::margot_summary_tables(dat_long, exposure_waves = exposure_waves, baseline_wave = baseline_wave, outcome_wave = outcome_wave, name_exposure = name_exposure, baseline_vars = baseline_vars, outcome_vars = outcome_vars)\n\n\n# save tables\n# here_save(table_exposures, \"table_exposures\")\n```\n:::\n\n## Baseline table\n\n::: {.cell}\n\n```{.r .cell-code}\nprint(tables$baseline_table)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n<div id=\"pkrvsjnkah\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n  <style>#pkrvsjnkah table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#pkrvsjnkah thead, #pkrvsjnkah tbody, #pkrvsjnkah tfoot, #pkrvsjnkah tr, #pkrvsjnkah td, #pkrvsjnkah th {\n  border-style: none;\n}\n\n#pkrvsjnkah p {\n  margin: 0;\n  padding: 0;\n}\n\n#pkrvsjnkah .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#pkrvsjnkah .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#pkrvsjnkah .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#pkrvsjnkah .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#pkrvsjnkah .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#pkrvsjnkah .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#pkrvsjnkah .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#pkrvsjnkah .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#pkrvsjnkah .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#pkrvsjnkah .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#pkrvsjnkah .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#pkrvsjnkah .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#pkrvsjnkah .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#pkrvsjnkah .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#pkrvsjnkah .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#pkrvsjnkah .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#pkrvsjnkah .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#pkrvsjnkah .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#pkrvsjnkah .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#pkrvsjnkah .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#pkrvsjnkah .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#pkrvsjnkah .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#pkrvsjnkah .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#pkrvsjnkah .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#pkrvsjnkah .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#pkrvsjnkah .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#pkrvsjnkah .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#pkrvsjnkah .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#pkrvsjnkah .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#pkrvsjnkah .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#pkrvsjnkah .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#pkrvsjnkah .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#pkrvsjnkah .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#pkrvsjnkah .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#pkrvsjnkah .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#pkrvsjnkah .gt_left {\n  text-align: left;\n}\n\n#pkrvsjnkah .gt_center {\n  text-align: center;\n}\n\n#pkrvsjnkah .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#pkrvsjnkah .gt_font_normal {\n  font-weight: normal;\n}\n\n#pkrvsjnkah .gt_font_bold {\n  font-weight: bold;\n}\n\n#pkrvsjnkah .gt_font_italic {\n  font-style: italic;\n}\n\n#pkrvsjnkah .gt_super {\n  font-size: 65%;\n}\n\n#pkrvsjnkah .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#pkrvsjnkah .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#pkrvsjnkah .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#pkrvsjnkah .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#pkrvsjnkah .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#pkrvsjnkah .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#pkrvsjnkah .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#pkrvsjnkah .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#pkrvsjnkah div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n  <table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"label\"><span data-qmd-base64=\"PHN0cm9uZz5FeHBvc3VyZSArIERlbW9ncmFwaGljIFZhcmlhYmxlczwvc3Ryb25nPg==\"><span class='gt_from_md'><strong>Exposure + Demographic Variables</strong></span></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"stat_0\"><span data-qmd-base64=\"PHN0cm9uZz5OID0gMTQsNDM5PC9zdHJvbmc+\"><span class='gt_from_md'><strong>N = 14,439</strong></span></span><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>1</sup></span></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"label\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Age</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\"><br /></td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Mean (SD)</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">50 (14)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Min, Max</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">18, 94</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Q1, Q3</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">41, 61</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Alert Level Combined Lead</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\"><br /></td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â no_alert</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">10,261 (71%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â early_covid</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">1,617 (11%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â alert_level_1</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">1,272 (8.8%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â alert_level_2</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">366 (2.5%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â alert_level_2_5_3</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">253 (1.8%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â alert_level_4</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">670 (4.6%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Born Nz</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">11,398 (79%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Unknown</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">25</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Edu</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\"><br /></td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Mean (SD)</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">5.38 (2.72)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Min, Max</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">0.00, 10.00</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Q1, Q3</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">3.00, 7.00</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Unknown</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">110</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Employed</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">11,466 (80%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Unknown</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">22</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Eth Cat</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\"><br /></td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â euro</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">11,835 (83%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â maori</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">1,526 (11%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â pacific</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">314 (2.2%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â asian</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">655 (4.6%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Unknown</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">109</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Household Inc log</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\"><br /></td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Mean (SD)</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">11.41 (0.74)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Min, Max</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">0.71, 14.40</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Q1, Q3</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">11.00, 11.92</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Unknown</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">655</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Male</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">5,238 (36%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Neighbourhood Community</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\"><br /></td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Mean (SD)</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">4.23 (1.66)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Min, Max</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">1.00, 7.00</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Q1, Q3</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">2.99, 5.95</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Unknown</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">73</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Parent</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">10,350 (72%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Unknown</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">8</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Partner</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">10,661 (76%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Unknown</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">399</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Religion Religious</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">5,218 (36%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Unknown</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">19</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Rural Gch 2018 l</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\"><br /></td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â 1</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">8,822 (62%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â 2</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">2,784 (19%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â 3</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">1,740 (12%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â 4</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">820 (5.7%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â 5</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">170 (1.2%)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Unknown</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">103</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Sample Weights</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\"><br /></td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Mean (SD)</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">0.94 (1.22)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Min, Max</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">0.30, 19.96</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Q1, Q3</td>\n<td headers=\"stat_0\" class=\"gt_row gt_center\">0.40, 1.03</td></tr>\n  </tbody>\n  \n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"2\"><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>1</sup></span> <span data-qmd-base64=\"biAoJSk=\"><span class='gt_from_md'>n (%)</span></span></td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n\n:::\n:::\n\n## Exposure table\n\n::: {.cell}\n\n```{.r .cell-code}\nprint(tables$exposure_tables)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$perfectionism\n<div id=\"lyxgtulfyl\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n  <style>#lyxgtulfyl table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#lyxgtulfyl thead, #lyxgtulfyl tbody, #lyxgtulfyl tfoot, #lyxgtulfyl tr, #lyxgtulfyl td, #lyxgtulfyl th {\n  border-style: none;\n}\n\n#lyxgtulfyl p {\n  margin: 0;\n  padding: 0;\n}\n\n#lyxgtulfyl .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#lyxgtulfyl .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#lyxgtulfyl .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#lyxgtulfyl .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#lyxgtulfyl .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#lyxgtulfyl .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#lyxgtulfyl .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#lyxgtulfyl .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#lyxgtulfyl .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#lyxgtulfyl .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#lyxgtulfyl .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#lyxgtulfyl .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#lyxgtulfyl .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#lyxgtulfyl .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#lyxgtulfyl .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#lyxgtulfyl .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#lyxgtulfyl .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#lyxgtulfyl .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#lyxgtulfyl .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#lyxgtulfyl .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#lyxgtulfyl .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#lyxgtulfyl .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#lyxgtulfyl .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#lyxgtulfyl .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#lyxgtulfyl .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#lyxgtulfyl .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#lyxgtulfyl .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#lyxgtulfyl .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#lyxgtulfyl .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#lyxgtulfyl .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#lyxgtulfyl .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#lyxgtulfyl .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#lyxgtulfyl .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#lyxgtulfyl .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#lyxgtulfyl .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#lyxgtulfyl .gt_left {\n  text-align: left;\n}\n\n#lyxgtulfyl .gt_center {\n  text-align: center;\n}\n\n#lyxgtulfyl .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#lyxgtulfyl .gt_font_normal {\n  font-weight: normal;\n}\n\n#lyxgtulfyl .gt_font_bold {\n  font-weight: bold;\n}\n\n#lyxgtulfyl .gt_font_italic {\n  font-style: italic;\n}\n\n#lyxgtulfyl .gt_super {\n  font-size: 65%;\n}\n\n#lyxgtulfyl .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#lyxgtulfyl .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#lyxgtulfyl .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#lyxgtulfyl .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#lyxgtulfyl .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#lyxgtulfyl .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#lyxgtulfyl .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#lyxgtulfyl .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#lyxgtulfyl div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n  <table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"label\"><span data-qmd-base64=\"PHN0cm9uZz5FeHBvc3VyZSBWYXJpYWJsZTogUGVyZmVjdGlvbmlzbSBieSBXYXZlPC9zdHJvbmc+\"><span class='gt_from_md'><strong>Exposure Variable: Perfectionism by Wave</strong></span></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"stat_1\"><span data-qmd-base64=\"PHN0cm9uZz4yMDE4PC9zdHJvbmc+PGJyIC8+Ck4gPSAxNCw0Mzk=\"><span class='gt_from_md'><strong>2018</strong><br />\nN = 14,439</span></span><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"stat_2\"><span data-qmd-base64=\"PHN0cm9uZz4yMDE5PC9zdHJvbmc+PGJyIC8+Ck4gPSAxNCw0Mzk=\"><span class='gt_from_md'><strong>2019</strong><br />\nN = 14,439</span></span><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>1</sup></span></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"label\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Perfectionism</td>\n<td headers=\"stat_1\" class=\"gt_row gt_center\">3.00 (2.01, 4.02)</td>\n<td headers=\"stat_2\" class=\"gt_row gt_center\">2.99 (2.00, 4.02)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Unknown</td>\n<td headers=\"stat_1\" class=\"gt_row gt_center\">0</td>\n<td headers=\"stat_2\" class=\"gt_row gt_center\">0</td></tr>\n  </tbody>\n  \n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"3\"><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>1</sup></span> <span data-qmd-base64=\"TWVkaWFuIChRMSwgUTMp\"><span class='gt_from_md'>Median (Q1, Q3)</span></span></td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n\n:::\n:::\n\n\n# Outcome table\n\n::: {.cell}\n\n```{.r .cell-code}\nprint(tables$outcome_table)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n<div id=\"myuyndetcp\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n  <style>#myuyndetcp table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#myuyndetcp thead, #myuyndetcp tbody, #myuyndetcp tfoot, #myuyndetcp tr, #myuyndetcp td, #myuyndetcp th {\n  border-style: none;\n}\n\n#myuyndetcp p {\n  margin: 0;\n  padding: 0;\n}\n\n#myuyndetcp .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#myuyndetcp .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#myuyndetcp .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#myuyndetcp .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#myuyndetcp .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#myuyndetcp .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#myuyndetcp .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#myuyndetcp .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#myuyndetcp .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#myuyndetcp .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#myuyndetcp .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#myuyndetcp .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#myuyndetcp .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#myuyndetcp .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#myuyndetcp .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#myuyndetcp .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#myuyndetcp .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#myuyndetcp .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#myuyndetcp .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#myuyndetcp .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#myuyndetcp .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#myuyndetcp .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#myuyndetcp .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#myuyndetcp .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#myuyndetcp .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#myuyndetcp .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#myuyndetcp .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#myuyndetcp .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#myuyndetcp .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#myuyndetcp .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#myuyndetcp .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#myuyndetcp .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#myuyndetcp .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#myuyndetcp .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#myuyndetcp .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#myuyndetcp .gt_left {\n  text-align: left;\n}\n\n#myuyndetcp .gt_center {\n  text-align: center;\n}\n\n#myuyndetcp .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#myuyndetcp .gt_font_normal {\n  font-weight: normal;\n}\n\n#myuyndetcp .gt_font_bold {\n  font-weight: bold;\n}\n\n#myuyndetcp .gt_font_italic {\n  font-style: italic;\n}\n\n#myuyndetcp .gt_super {\n  font-size: 65%;\n}\n\n#myuyndetcp .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#myuyndetcp .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#myuyndetcp .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#myuyndetcp .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#myuyndetcp .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#myuyndetcp .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#myuyndetcp .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#myuyndetcp .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#myuyndetcp div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n  <table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"label\"><span data-qmd-base64=\"PHN0cm9uZz5PdXRjb21lIFZhcmlhYmxlcyBieSBXYXZlPC9zdHJvbmc+\"><span class='gt_from_md'><strong>Outcome Variables by Wave</strong></span></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"stat_1\"><span data-qmd-base64=\"PHN0cm9uZz4yMDE4PC9zdHJvbmc+PGJyIC8+Ck4gPSAxNCw0Mzk=\"><span class='gt_from_md'><strong>2018</strong><br />\nN = 14,439</span></span><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"stat_2\"><span data-qmd-base64=\"PHN0cm9uZz4yMDIwPC9zdHJvbmc+PGJyIC8+Ck4gPSAxNCw0Mzk=\"><span class='gt_from_md'><strong>2020</strong><br />\nN = 14,439</span></span><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>1</sup></span></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"label\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Kessler Latent Anxiety</td>\n<td headers=\"stat_1\" class=\"gt_row gt_center\">1.04 (0.65, 1.67)</td>\n<td headers=\"stat_2\" class=\"gt_row gt_center\">1.03 (0.65, 1.67)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Unknown</td>\n<td headers=\"stat_1\" class=\"gt_row gt_center\">148</td>\n<td headers=\"stat_2\" class=\"gt_row gt_center\">2,893</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\" style=\"font-weight: bold;\">Kessler Latent Depression</td>\n<td headers=\"stat_1\" class=\"gt_row gt_center\">0.31 (0.01, 0.96)</td>\n<td headers=\"stat_2\" class=\"gt_row gt_center\">0.31 (0.01, 0.96)</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">Â Â Â Â Unknown</td>\n<td headers=\"stat_1\" class=\"gt_row gt_center\">152</td>\n<td headers=\"stat_2\" class=\"gt_row gt_center\">2,890</td></tr>\n  </tbody>\n  \n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"3\"><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>1</sup></span> <span data-qmd-base64=\"TWVkaWFuIChRMSwgUTMp\"><span class='gt_from_md'>Median (Q1, Q3)</span></span></td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n\n:::\n:::\n\n\n\n\n### Inspect the distribution of the exposure in treatment wave\n\n::: {.cell}\n\n```{.r .cell-code}\n# select 2019 wave\ndt_19 <- dat_long |> dplyr::filter(wave == 2019)\n\n# mean\nmean_exposure <-mean(dt_19$perfectionism, na.rm=TRUE)\n\n# median\nmedian_exposure <-median(dt_19$perfectionism, na.rm=TRUE)\n\n# check if you like\n# median_exposure\n# mean_exposure\n# generate bar plot\ngraph_density_of_exposure_up <- margot::margot_plot_shift(\n  dt_19,\n  shift = \"up\",\n  col_name = \"perfectionism\",\n  binwidth = .25, \n  range_highlight = c(0,mean_exposure)\n)\n\n# show\ngraph_density_of_exposure_up\n```\n\n::: {.cell-output-display}\n![](06-content_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# save\n#margot::here_save(graph_density_of_exposure_up, \"graph_density_of_exposure_up\")\n```\n:::\n\n\n\n### Check for change in the treatment (Positivity )\n\n::: {.cell}\n\n```{.r .cell-code}\n#  select data from wave 18 and 19 \ndt_18_19_positivity <- dat_long |>\n  dplyr::filter(wave == 2018 | wave == 2019) |>\n  dplyr::mutate(perfectionism_round = round(perfectionism, digits = 0)) |>\n  dplyr::select(perfectionism_round, id, wave) |>\n  droplevels()\n\nout <-margot::margot_transition_table(data = dt_18_19_positivity, state_var = \"perfectionism_round\", id_var = \"id\", wave_var = \"wave\")\n\n# table\nout$tables[[1]]\n```\n\n::: {.cell-output-display}\n\n\n|From / To | State 1| State 2| State 3| State 4| State 5| State 6| State 7| Total|\n|:---------|-------:|-------:|-------:|-------:|-------:|-------:|-------:|-----:|\n|State 1   |     893|     484|     194|      40|      16|       3|       2|  1632|\n|State 2   |     657|    1737|     904|     283|      78|       9|       1|  3669|\n|State 3   |     237|    1073|    1368|     768|     245|      40|       5|  3736|\n|State 4   |      66|     335|     803|    1076|     523|     108|      10|  2921|\n|State 5   |      24|      77|     253|     531|     579|     223|      26|  1713|\n|State 6   |       7|       9|      38|     106|     205|     216|      53|   634|\n|State 7   |       2|       1|       5|       8|      25|      45|      48|   134|\n\n\n:::\n\n```{.r .cell-code}\n# for import later\n# margot::here_save(transition_table, \"transition_table\")\n```\n:::\n\n\n### Explanation for the table\n\n::: {.cell}\n\n```{.r .cell-code}\ncat(out$explanation)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nThese transition matrices capture shifts in states between consecutive waves. Each cell represents the count of individuals transitioning from one state to another. The rows correspond to the initial state (From), and the columns correspond to the subsequent state (To). **Diagonal entries** (in **bold**) correspond to individuals who remained in the same state. **Off-diagonal entries** correspond to individuals who transitioned to a different state.\n\nA higher number on the diagonal relative to off-diagonal entries indicates greater stability in a state. Conversely, higher off-diagonal numbers suggest more frequent shifts between states.\n```\n\n\n:::\n:::\n\n\n\n## Lab Part 2: Simulation to Clarify Why The Distribution of Effect Modifiers Matter For Estimating Treatment Effects \n\n\nFirst, we load the `stdReg` library, which obtains marginal effect estimates by simulating counterfactuals under different levels of treatment [@sjÃ¶lander2016]. If a treatment is continuous, the levels can be specified. \n\nWe also load the `parameters` library, which creates nice tables [@parameters2020].\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# to obtain marginal effects\nlibrary(stdReg)\n# to create nice tables\nlibrary(parameters)\n```\n:::\n\nNext, we write a function to simulate data for the sample and and target populations. \n\nWe assume the treatment effect is the same in the sample and target population. We will assume that the coefficient for the effect-modifier and the coefficient for interaction are the same.  We assume no unmeasured confounding throughout the study.  We assume only selective attrition of one effect modifier such that the baseline population differs from the sample population at the end of the study.   \n\nThat is: **the distribution of effect modifiers is the only respect in which the sample will differ from the target population.**\n\nThis function will generate data under a range of scenarios.[^margot]\n\n[^margot]: See documentation in the `margot` package: @margot2024\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# function to generate data for the sample and population, \n# along with precise sample weights for the population, there are differences \n# in the distribution of the true effect modifier but no differences in the treatment effect \n# or the effect modification.all that differs between the sample and the population is \n# the distribution of effect-modifiers.\n\n\n# reproducability\nset.seed(123)\n\n# simulate the data -- you can use different parameters\ndata <- margot::simulate_ate_data_with_weights(\n  n_sample = 10000,\n  n_population = 100000,\n  p_z_sample = 0.1,\n  p_z_population = 0.5,\n  beta_a = 1,\n  beta_z = 2.5,\n  noise_sd = 0.5\n)\n\nskimr::skim(data)\n```\n\n::: {.cell-output-display}\n\nTable: Data summary\n\n|                         |       |\n|:------------------------|:------|\n|Name                     |data   |\n|Number of rows           |100000 |\n|Number of columns        |7      |\n|_______________________  |       |\n|Column type frequency:   |       |\n|numeric                  |7      |\n|________________________ |       |\n|Group variables          |None   |\n\n\n**Variable type: numeric**\n\n|skim_variable                | n_missing| complete_rate| mean|   sd|    p0|  p25|  p50|  p75| p100|hist  |\n|:----------------------------|---------:|-------------:|----:|----:|-----:|----:|----:|----:|----:|:-----|\n|sample_data.y_sample         |         0|             1| 0.74| 1.08| -1.71| 0.01| 0.59| 1.21| 5.21|â–‚â–‡â–ƒâ–â– |\n|sample_data.a_sample         |         0|             1| 0.49| 0.50|  0.00| 0.00| 0.00| 1.00| 1.00|â–‡â–â–â–â–‡ |\n|sample_data.z_sample         |         0|             1| 0.09| 0.29|  0.00| 0.00| 0.00| 0.00| 1.00|â–‡â–â–â–â– |\n|sample_data.weights          |         0|             1| 0.98| 1.30|  0.56| 0.56| 0.56| 0.56| 5.00|â–‡â–â–â–â– |\n|population_data.y_population |         0|             1| 1.88| 1.60| -2.09| 0.51| 1.76| 3.26| 6.01|â–â–‡â–†â–†â– |\n|population_data.a_population |         0|             1| 0.50| 0.50|  0.00| 0.00| 1.00| 1.00| 1.00|â–‡â–â–â–â–‡ |\n|population_data.z_population |         0|             1| 0.50| 0.50|  0.00| 0.00| 1.00| 1.00| 1.00|â–‡â–â–â–â–‡ |\n\n\n:::\n:::\n\nOk, we have generated both sample and population data. \n\nNext, we verify that the distributions of effect modifiers differ in the sample and in the target population:\n\n::: {.cell}\n\n```{.r .cell-code}\n# obtain the generated data\nsample_data <- data$sample_data\npopulation_data <- data$population_data\n\n\n# check imbalance\ntable(sample_data$z_sample) # type 1 is rare\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n   0    1 \n9055  945 \n```\n\n\n:::\n\n```{.r .cell-code}\ntable(population_data$z_population) # type 1 is common\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n    0     1 \n49916 50084 \n```\n\n\n:::\n:::\n\n\n\nGood, the distributions differ. The simulation is working as intended.\n\nNext, consider the question: \"What are the differences in the coefficients that we obtain from the study population at the end of study, as compared with the target population?\"  \n\nFirst, we obtain the coefficients for the sample. They are as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# model coefficients sample\nmodel_sample  <-\n  glm(y_sample ~ a_sample * z_sample, data = sample_data)\n\n# summary\nparameters::model_parameters(model_sample, ci_method = \"wald\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nParameter           | Coefficient |       SE |        95% CI | t(9996) |      p\n-------------------------------------------------------------------------------\n(Intercept)         |   -6.89e-03 | 7.38e-03 | [-0.02, 0.01] |   -0.93 | 0.350 \na sample            |        1.01 |     0.01 | [ 0.99, 1.03] |   95.84 | < .001\nz sample            |        2.47 |     0.02 | [ 2.43, 2.52] |  104.09 | < .001\na sample Ã— z sample |        0.51 |     0.03 | [ 0.44, 0.57] |   14.82 | < .001\n```\n\n\n:::\n:::\n\nOk, let's obtain the coefficients for the weighted regression of the sample.   Notice that the coefficients are virtually the same:\n\n::: {.cell}\n\n```{.r .cell-code}\n# model the sample weighted to the population, again note that these coefficients are similar \nmodel_weighted_sample <-\n  glm(y_sample ~  a_sample  * z_sample,\n      data = sample_data,\n      weights = weights)\n\n# summary\nsummary(parameters::model_parameters(model_weighted_sample, ci_method =\n                                       \"wald\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nParameter           | Coefficient |        95% CI |      p\n----------------------------------------------------------\n(Intercept)         |   -6.89e-03 | [-0.03, 0.01] | 0.480 \na sample            |        1.01 | [ 0.98, 1.04] | < .001\nz sample            |        2.47 | [ 2.45, 2.50] | < .001\na sample Ã— z sample |        0.51 | [ 0.47, 0.55] | < .001\n\nModel: y_sample ~ a_sample * z_sample (10000 Observations)\nSigma: 0.494 (df = 9996)\n```\n\n\n:::\n:::\n\n\nWe might be tempted to infer that weighting wasn't relevant to the analysis. However, we'll see that such an interpretation would be a mistake.\n\n\nNext, let us obtain model coefficients for the population. Note again there is no difference -- only narrower errors owing to the large sample size. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# model coefficients population -- note that these coefficients are very similar. \nmodel_population <-\n  glm(y_population ~ a_population * z_population, data = population_data)\n\nparameters::model_parameters(model_population, ci_method = \"wald\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nParameter                   | Coefficient |       SE |        95% CI | t(99996) |      p\n----------------------------------------------------------------------------------------\n(Intercept)                 |    2.49e-03 | 3.18e-03 | [ 0.00, 0.01] |     0.78 | 0.434 \na population                |        1.00 | 4.49e-03 | [ 0.99, 1.01] |   222.35 | < .001\nz population                |        2.50 | 4.49e-03 | [ 2.49, 2.51] |   556.80 | < .001\na population Ã— z population |        0.50 | 6.35e-03 | [ 0.49, 0.51] |    78.80 | < .001\n```\n\n\n:::\n:::\n\n\nAgain, there is no difference. That is, we find that all model coefficients are practically equivalent. The different distribution of effect modifiers does not result in different coefficient values for the treatment effect, the effect-modifier \"effect,\" or the interaction of effect modifier and treatment. \n\nConsider why this is the case: in a large sample where the causal effects are invariant -- as we have simulated them to be -- we will have good replication in the effect modifiers within the sample, so our statistical model can recover the *coefficients* for the population -- no problem. \n\nHowever, **in causal inference, we are interested in obtaining the marginal effect of the treatment**. That is, we seek an estimate for the counterfactual contrast in which everyone in a pre-specified population was subject to one level of treatment compared with a counterfactual condition in which everyone in a population was subject to another level of the same treatment. **When the sample population differs in the distribution of effect modifiers from the target population effect, the marginal effect estimates will typically differ.**\n\nTo see this, we use the `stdReg` package to recover marginal effect estimates, comparing (1) the sample ATE, (2) the true oracle ATE for the population, and (3) the weighted sample ATE.  We will use the outputs of the same models above. The only difference is that we will calculate marginal effects from these outputs. We will contrast a difference from an intervention in which everyone receives treatment = 0 with one in which everyone receives treatment = 1, however, this choice is arbitrary, and the general lessons apply irrespective of the estimand.\n\n\nFirst, consider this ATE for the sample population. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# What inference do we draw?  We cannot say the models are unbiased for the marginal effect estimates. \n# regression standardisation \nlibrary(stdReg) # to obtain marginal effects \n\n\n# obtain sample ate\nfit_std_sample <-\n  stdReg::stdGlm(model_sample, data = sample_data, X = \"a_sample\")\n\n# summary\nsummary(fit_std_sample,\n        contrast = \"difference\",\n        reference = 0)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFormula: y_sample ~ a_sample * z_sample\nFamily: gaussian \nLink function: identity \nExposure:  a_sample \nReference level:  a_sample = 0 \nContrast:  difference \n\n  Estimate Std. Error lower 0.95 upper 0.95\n0     0.00     0.0000       0.00       0.00\n1     1.06     0.0101       1.04       1.08\n```\n\n\n:::\n:::\n\nThe treatment effect is given as a 1.06 unit change in the outcome across the sample population, with a confidence interval from 1.04 to 1.08. \n\n\nNext, we obtain the true (oracle) treatment effect for the population under the same intervention.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## note the population effect is different\n\n#obtain true ate\nfit_std_population <-\n  stdReg::stdGlm(model_population, data = population_data, X = \"a_population\")\n\n# summary\nsummary(fit_std_population,\n        contrast = \"difference\",\n        reference = 0)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFormula: y_population ~ a_population * z_population\nFamily: gaussian \nLink function: identity \nExposure:  a_population \nReference level:  a_population = 0 \nContrast:  difference \n\n  Estimate Std. Error lower 0.95 upper 0.95\n0     0.00    0.00000       0.00       0.00\n1     1.25    0.00327       1.24       1.26\n```\n\n\n:::\n:::\n\n\nNote, the true treatment effect is a 1.25 unit change in the population, with a confidence bound between 1.24 and 1.26. This is well outside the ATE that we obtain from the sample population!\n\n\n\nNext, consider the ATE in the weighted regression, where the sample was weighted to the target population's true distribution of effect modifiers. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n## next try weights adjusted ate where we correctly assign population weights to the sample\nfit_std_weighted_sample_weights <- stdReg::stdGlm( model_weighted_sample, \n    data = sample_data, \n    X = \"a_sample\")\n\n# this gives us the right answer\nsummary(fit_std_weighted_sample_weights, \n    contrast = \"difference\", \n    reference = 0)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFormula: y_sample ~ a_sample * z_sample\nFamily: gaussian \nLink function: identity \nExposure:  a_sample \nReference level:  a_sample = 0 \nContrast:  difference \n\n  Estimate Std. Error lower 0.95 upper 0.95\n0     0.00     0.0000       0.00       0.00\n1     1.25     0.0172       1.22       1.29\n```\n\n\n:::\n\n```{.r .cell-code}\n# moral of the story. when we marginalise over the entire sample we need to weight estimates to the target population. \n```\n:::\n\n\nWe find that we obtain the population-level causal effect estimate with accurate coverage by weighting the sample to the target population. So with appropriate weights, our results generalise from the sample to the target population.\n\n\n## Lessons from Lab 2\n\n- Regression coefficients do not clarify the problem of sample/target population mismatch -- or selection bias as discussed in this manuscript.\n- The correct advice to investigators is that they should not rely on regression coefficients when evaluating the biases that arise from sample attrition. This advice applies to both methods that the authors use to investigate threats of bias. That is, to implement this advice, the authors must first take it.\n- Generally, observed data are insufficient for assessing threats. Observed data do not clarify structural sources of bias, nor do they clarify effect-modification in the full counterfactual data condition in which all receive the treatment and all do not receive the treatment (at the same level).\n- To properly assess bias, one would need access to the counterfactual outcomeâ€”what would have happened to the missing participants had they not been lost to follow-up or had they responded. Again, the join distributions over \"full data\" are inherently unobservable [@vanderlaan2011]. \n- In simple settings like the one we just simulated, we may address the gap between the sample and target population using methods such as modelling the censoring (e.g., censoring weighting). However, we never know what setting we are in or whether it is simpleâ€”such modelling must be handled with care. There is a large and growing epidemiology literature on this topic (see, for example, @li2023non).\n<!-- - Matters become more complex when there is confounding and selection bias because the problem is not merely one of external validity but also internal validity (i.e. obtaining valid causal effect estimates for the baseline sample). See for example @scharfstein1999adjusting; @laan2003unified; @howe2016selection (note that @howe2016selection, \"selection\" bias is defined as collider stratification bias, a variety of confounding bias and not simple sample and target population mismatch.)   -->\n\n\n\n## Appendix A \n\n\n### Evidence for effect-modification is relative to inclusion of other variables in the model\n\nThe 'sharp-null hypothesis' states there is no effect of the exposure on\nthe outcome for any unit in the target population. Unless the 'sharp-null hypothesis' is false, there may be effect-modification. For any study worth conducting, we cannot evaluate whether the sharp-null hypothesis is false. If we could the experiment would be otiose. Therefore, we must assume the possibility of effect-modification. Notably, whether a variable is an effect-modifier also depends on which other variables are included in the model. That is, just as for the concept of a 'confounder', where a variable is an 'effect-modifier' cannot be stated without reference to an assumed causal order and an explicit statement about which other variables will be included in the model [@vanderweele2012].\n\nAs illustrated in  @fig-eff-mod-rel, the marginal association between $A$ and $Y$ is unbiased. Here, exposure $A$ is unconditionally associated with $Y$. Recall our convention <svg width=\"40px\" height=\"40px\"><circle cx=\"20\" cy=\"20\" r=\"18\" fill=\"none\" stroke=\"blue\" stroke-width=\"2\"/><text x=\"20\" y=\"20\" alignment-baseline=\"middle\" text-anchor=\"middle\" fill=\"blue\" font-size=\"16\">G</text></svg> denotes effect-modification with conditioning and <svg width=\"40px\" height=\"40px\"><circle cx=\"20\" cy=\"20\" r=\"18\" fill=\"none\" stroke=\"blue\" stroke-width=\"2\" stroke-dasharray=\"4,4\"/><text x=\"20\" y=\"20\" alignment-baseline=\"middle\" text-anchor=\"middle\" fill=\"blue\" font-size=\"16\">Z</text></svg> indicates effect-modification without conditioning.\n\n::: {.cell}\n::: {.cell-output-display}\n![Consider a randomised experiment. There is no confounding. Here, the marginal association between A and Y provides an unbiased estimate for the causal effect of A on Y. Does the conditional association of A on Y vary within levels of G? The causal diagram allows for a classification of G as an effect modifier of A on Y by proxy. G modifies A's effect on Y in virtue of G's relationship to Z, which, according to this graph, is a direct effect modifier for the effect of A on Y.](06-content_files/figure-html/fig-eff-mod-rel-1.png){#fig-eff-mod-rel width=80%}\n:::\n:::\n\n@fig-dag-effect-modificationb presents the same a randomised experiment as in the previous causal diagram. We again assume that there is no confounding of the marginal association between the exposure, $A$, and the outcome, $Y$. However, suppose we were to adjust for $Z$ and ask, does the conditional association of $A$ on $Y$ vary within levels of $G$, after adjusting for $Z$? That is, does $G$ remain an effect-modifier of the exposure on the outcome? @vanderweele2007 proved that for effect-modification to occur, at least one other arrow besides the treatment must enter into the outcome. According to @fig-dag-effect-modificationb the only arrow into $Y$ other than $A$ arrives from $Z$. Because $Y$ is independent of $G$ conditional on $Z$ we may infer that $G$ is no longer an effect modifier for the effect of $A$ on $Y$. Viewed another way, $G$ no longer co-varies with $Y$\nconditional on $Z$ and so cannot act as an effect-modifier.\n\n::: {.cell}\n::: {.cell-output-display}\n![Conditioning on Z renders G independent of Y. G is no longer an effect modifier after conditioning on Z because G is independent of Y. Although Z is an unconditional effect modifier, G is not.](06-content_files/figure-html/fig-dag-effect-modificationb-1.png){#fig-dag-effect-modificationb width=80%}\n:::\n:::\n\n@fig-dag-effect-modificationc presents the same a randomised experiment as in the previous graph. We assume a true effect of $A \\rightarrow Y$. If we do not condition on $B$, then $G$ will not modify the effect of $A  \\rightarrow Y$ because $G$ will not be associated with $Y$. However, if we were to condition on $B$, then both $B$ (an effect modifier by proxy) and $G$ may become effect-modifiers for the causal effect of $A$ on $Y$. In this setting, both $B$ and $G$ are conditional effect-modifiers.\n\nNote that casual graphs help us to evaluate classifications of conditional and unconditional effect modifiers. They may also help to clarify conditions in which conditioning on unconditional effect-modifiers may remove conditional effect-modification. However we cannot not tell from a causal diagram whether the ancestors of an\nunconditional effect-modifier will be conditional effect-modifiers for the effect of the exposure on the outcome; see: @vanderweele2007, also @suzuki2013counterfactual. Causal diagrams express non-parametric relations. I have adopted an off-label colouring convention to denote instances of effect-modification to highlight possible pathways for effect-modification, which may be relative to other variables in a model.\n\n::: {.cell}\n::: {.cell-output-display}\n![Blue path denotes effect-modification for G by conditioning on B. Both B and G are conditional effect modifiers.](06-content_files/figure-html/fig-dag-effect-modificationc-1.png){#fig-dag-effect-modificationc width=80%}\n:::\n:::\n\n@fig-dag-effect-modificationd reveals the relativity of effect-modification. If investigators do not condition on $B$, then $G$\ncannot be a conditional effect-modifier because $G$ would then be independent of $Z$ because $B$ is a collider. However, as we observed in\n@fig-dag-effect-modificationc, conditioning on $B$, a collider, may open a path for effect-modification of $G$ by $Z$. Both $B$ and $G$ are\nconditional effect modifiers.\n\n::: {.cell}\n::: {.cell-output-display}\n![Blue path denotes effect-modification. Here G is not an effect modifier because B, a common effect (collider) of G and Z, is not conditioned on. Any conditional effect modification for G would require conditioning on B, and not-conditioning on G. Otherwise G will be d-separated from Y.](06-content_files/figure-html/fig-dag-effect-modificationd-1.png){#fig-dag-effect-modificationd width=80%}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Blue path denotes effect-modification. Neither, G nor B are unconditional effect-modifiers for the effect of A on Y after Z is conditioned upon. If investigators condition on Z, the causal diagram implies they will not find evidence for effect-modification by B or G, which are conditionally independent of Y once Z is conditioned upon.](06-content_files/figure-html/fig-dag-effect-modification5c-1.png){#fig-dag-effect-modification5c width=80%}\n:::\n:::\n\n@fig-dag-effect-modification5c considers the implications of\nconditioning on $Z$, which is the only unconditional effect-modifier on\nthe graph. If $Z$ is measured, conditioning on $Z$ will remove\neffect-modification for $B$ and $G$ because $B,G\\coprod Y |Z$. This\nexamples again reveals the context dependency of effect-modification.\nHere, causal diagrams are useful for clarifying features of dependent\nand independent effect modification. For further discussion, see:\n@suzuki2013counterfactual; @vanderweele2009distinction.\n\n\n\n\n\n### Packages\n\n::: {.cell}\n\n```{.r .cell-code}\nreport::cite_packages()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  - Bulbulia J (2024). _margot: MARGinal Observational Treatment-effects_. doi:10.5281/zenodo.10907724 <https://doi.org/10.5281/zenodo.10907724>, R package version 0.3.3.1 Functions to obtain MARGinal Observational Treatment-effects from observational data., <https://go-bayes.github.io/margot/>.\n  - Chang W (2023). _extrafont: Tools for Using Fonts_. R package version 0.19, <https://CRAN.R-project.org/package=extrafont>.\n  - CsÃ¡rdi G (2024). _crayon: Colored Terminal Output_. R package version 1.5.3, <https://CRAN.R-project.org/package=crayon>.\n  - CsÃ¡rdi G (2025). _cli: Helpers for Developing Command Line Interfaces_. R package version 3.6.4, <https://CRAN.R-project.org/package=cli>.\n  - Firke S (2024). _janitor: Simple Tools for Examining and Cleaning Dirty Data_. R package version 2.2.1, <https://CRAN.R-project.org/package=janitor>.\n  - Grolemund G, Wickham H (2011). \"Dates and Times Made Easy with lubridate.\" _Journal of Statistical Software_, *40*(3), 1-25. <https://www.jstatsoft.org/v40/i03/>.\n  - Larmarange J (2025). _labelled: Manipulating Labelled Data_. R package version 2.14.0, <https://CRAN.R-project.org/package=labelled>.\n  - LÃ¼decke D, Ben-Shachar M, Patil I, Makowski D (2020). \"Extracting, Computing and Exploring the Parameters of Statistical Models using R.\" _Journal of Open Source Software_, *5*(53), 2445. doi:10.21105/joss.02445 <https://doi.org/10.21105/joss.02445>.\n  - MÃ¼ller K (2020). _here: A Simpler Way to Find Your Files_. R package version 1.0.1, <https://CRAN.R-project.org/package=here>.\n  - MÃ¼ller K, Wickham H (2023). _tibble: Simple Data Frames_. R package version 3.2.1, <https://CRAN.R-project.org/package=tibble>.\n  - R Core Team (2024). _R: A Language and Environment for Statistical Computing_. R Foundation for Statistical Computing, Vienna, Austria. <https://www.R-project.org/>.\n  - Rich B (2023). _table1: Tables of Descriptive Statistics in HTML_. R package version 1.4.3, <https://CRAN.R-project.org/package=table1>.\n  - Sjoberg D, Whiting K, Curry M, Lavery J, Larmarange J (2021). \"Reproducible Summary Tables with the gtsummary Package.\" _The R Journal_, *13*, 570-580. doi:10.32614/RJ-2021-053 <https://doi.org/10.32614/RJ-2021-053>, <https://doi.org/10.32614/RJ-2021-053>.\n  - Sjolander A, Dahlqwist E (2021). _stdReg: Regression Standardization_. R package version 3.4.1, <https://CRAN.R-project.org/package=stdReg>.\n  - Waring E, Quinn M, McNamara A, Arino de la Rubia E, Zhu H, Ellis S (2022). _skimr: Compact and Flexible Summaries of Data_. R package version 2.1.5, <https://CRAN.R-project.org/package=skimr>.\n  - Wickham H (2016). _ggplot2: Elegant Graphics for Data Analysis_. Springer-Verlag New York. ISBN 978-3-319-24277-4, <https://ggplot2.tidyverse.org>.\n  - Wickham H (2023). _forcats: Tools for Working with Categorical Variables (Factors)_. R package version 1.0.0, <https://CRAN.R-project.org/package=forcats>.\n  - Wickham H (2023). _stringr: Simple, Consistent Wrappers for Common String Operations_. R package version 1.5.1, <https://CRAN.R-project.org/package=stringr>.\n  - Wickham H, Averick M, Bryan J, Chang W, McGowan LD, FranÃ§ois R, Grolemund G, Hayes A, Henry L, Hester J, Kuhn M, Pedersen TL, Miller E, Bache SM, MÃ¼ller K, Ooms J, Robinson D, Seidel DP, Spinu V, Takahashi K, Vaughan D, Wilke C, Woo K, Yutani H (2019). \"Welcome to the tidyverse.\" _Journal of Open Source Software_, *4*(43), 1686. doi:10.21105/joss.01686 <https://doi.org/10.21105/joss.01686>.\n  - Wickham H, FranÃ§ois R, Henry L, MÃ¼ller K, Vaughan D (2023). _dplyr: A Grammar of Data Manipulation_. R package version 1.1.4, <https://CRAN.R-project.org/package=dplyr>.\n  - Wickham H, Henry L (2025). _purrr: Functional Programming Tools_. R package version 1.0.4, <https://CRAN.R-project.org/package=purrr>.\n  - Wickham H, Hester J, Bryan J (2024). _readr: Read Rectangular Text Data_. R package version 2.1.5, <https://CRAN.R-project.org/package=readr>.\n  - Wickham H, Vaughan D, Girlich M (2024). _tidyr: Tidy Messy Data_. R package version 1.3.1, <https://CRAN.R-project.org/package=tidyr>.\n  - Xie Y (2025). _tinytex: Helper Functions to Install and Maintain TeX Live, and Compile LaTeX Documents_. R package version 0.56, <https://github.com/rstudio/tinytex>. Xie Y (2019). \"TinyTeX: A lightweight, cross-platform, and easy-to-maintain LaTeX distribution based on TeX Live.\" _TUGboat_, *40*(1), 30-32. <https://tug.org/TUGboat/Contents/contents40-1.html>.\n```\n\n\n:::\n:::\n\n\n\n\n\n",
    "supporting": [
      "06-content_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}