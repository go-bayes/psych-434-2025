{
  "hash": "636111a8af6f24edb31c645ca19f55e6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Causal Diagrams: The Structures of Interaction/Effect Modification, Measurement Bias, Selection Bias\"\ndate: \"2025-MAR-18\"\nbibliography: /Users/joseph/GIT/templates/bib/references.bib\neditor_options: \n  chunk_output_type: console\nformat:\n  html:\n    warnings: FALSE\n    error: FALSE\n    messages: FALSE\n    code-overflow: scroll\n    highlight-style: kate\n    code-tools:\n      source: true\n      toggle: FALSE\nhtml-math-method: katex\nreference-location: margin\ncitation-location: margin\ncap-location: margin\ncode-block-border-left: true\n---\n\n::: {.cell}\n\n:::\n\n\n::: {.callout-note}\n**Required**\n\n- [@bulbulia2023] [link](https://www.cambridge.org/core/journals/evolutionary-human-sciences/article/methods-in-causal-inference-part-1-causal-diagrams-and-confounding/E734F72109F1BE99836E268DF3AA0359)\n\n- see [simplified reading](https://osf.io/preprints/psyarxiv/tbjx8_v1)\n\n**Optional**\n\n- [@hernan2024WHATIF] Chapter 6-9 [link](https://www.dropbox.com/scl/fi/9hy6xw1g1o4yz94ip8cvd/hernanrobins_WhatIf_2jan24.pdf?rlkey=8eaw6lqhmes7ddepuriwk5xk9&dl=0)\n- [@hernan2004STRUCTURAL] [link](https://www.dropbox.com/scl/fi/qni0y1lstntmdw410m2nh/Heran2004StructuralSelectionBias.pdf?rlkey=0ob86mmx7vscxqmn3ipg9m94f&dl=0)\n- [@hernan2017SELECTIONWITHOUTCOLLIDER] [link](https://www.dropbox.com/scl/fi/zr3tk7ngsutjprqr18bbg/hernan-selection-without-colliders.pdf?rlkey=vfluyl3a7zksfphqepao04fix&dl=0)\n- [@hernan2009MEASUREMENT] [link](https://www.dropbox.com/scl/fi/ip8nil6uc5l0x9xw14mbr/hernan_cole_Measure_causal_diagrams.pdf?rlkey=wkj3ayen8xb6ncog46sps2g49&dl=0)\n- [@vanderweele2012MEASUREMENT] [link](https://www.dropbox.com/scl/fi/wtqoibuyitdwm5nlpjuu7/vander_hernan_measurement_error_vanderweel.pdf?rlkey=e4znxaqdfzf2vg6sj4ui799bb&dl=0)\n:::\n\n::: {.callout-important}\n## Key concepts for the test(s):\n  - **effect (measure) modification**\n  - **undirected/uncorrelated measurement error bias**\n  - **undirected/correlated measurement error bias**\n  - **directed/uncorrelated measurement error bias**\n  - **directed/correlated measurement error bias**\n  - **selection bias and transportability**\n:::\n\n::: {.callout-important}\n## For the lab, copy and paste code chunks following the \"LAB 4\" section.\n:::\n\n\n# Seminar\n\n## Learning Outcomes\n\n- You will learn the elementary structures of measurement error bias and be able to use them to explain how measurement can go wrong.\n\n- You will begin to understand the relationship between structural sources of bias and meaasurement in cross-cultural studies.\n\n- You will begin to understand how the concepts of target population and sample population clarify external validity/transportability of results in cross-cultural research.\n\n\n\n## Common Causal Questions Presented as Causal Graphs\n\n::: {#fig-time-solved}\n![](common-causal-questions.pdf){fig-align=\"left\" height=100% width=100%}\n\nThis figure is adapted from [@bulbulia2024wierd]\n:::\n\n\n## A Typology of Measurement Error Bias\n\n::: {#fig-time-solved}\n![](measurementerrorbias.pdf){fig-align=\"left\" height=100% width=100%}\n\nThis figure is adapted from [@bulbulia2024wierd]\n:::\n\n\n## Threats to External Validity \n\n::: {#fig-time-solved}\n![](externalvalidity.pdf){fig-align=\"left\" width=800px}\n\nThis figure is adapted from [@bulbulia2024wierd][Download PDF](externalvalidity.pdf){.btn .btn-primary .btn-sm}\n:::\n\n\n\n# Lab 04 \n\n## Load libraries\n\n::: {.cell}\n\n```{.r .cell-code}\n# data-wrangling\nif (!require(tidyverse, quietly = TRUE)) {\n  install.packages(\"tidyverse\")\n  library(tidyverse)\n}\n\n# graphing \nif (!require(ggplot2, quietly = TRUE)) {\n  install.packages(\"ggplot2\")\n  library(ggplot2)\n}\n\n\n# automated causal diagrams\nif (!require(ggdag, quietly = TRUE)) {\n  install.packages(\"ggdag\")\n  library(ggdag)\n}\n```\n:::\n\n\nWe can use the `ggdag` package to evaluate confounding .\n\n### Omitted Variable Bias Causal Graph\n\nLet's use `ggdag` to identify confounding arising from omitting Z in our regression of X on Y.\n\nFirst we write out the DAG as follows:\n\n::: {.cell}\n\n```{.r .cell-code}\n# code for creating a DAG\ngraph_fork <- dagify(Y ~ L,\n                   A ~ L,\n                   exposure = \"A\",\n                   outcome = \"Y\") |>\n  tidy_dagitty(layout = \"tree\")\n\n# plot the DAG\ngraph_fork |>\n  ggdag() + theme_dag_blank() + labs(title = \"L is a common cause of A and Y\")\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\nNext we ask `ggdag` which variables we need to include if we are to obtain an unbiased estimate of the outcome from the exposure:\n\n::: {.cell}\n\n```{.r .cell-code}\n# use this code\n\nggdag::ggdag_adjustment_set( graph_fork ) +  theme_dag_blank() + labs(title = \"{L} is the exclusive member of the confounder set for A and Y. Conditioning on L 'd-separates' A and Y \")\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\nThe causal graph tells us to obtain an unbiased estimate of A on Y we must condition on L.\n\nAnd indeed, when we included the omitted variable L in our simulated dateset it breaks the association between X and Y:\n\n::: {.cell}\n\n```{.r .cell-code}\n# set seed\nset.seed(123)\n\n# number of observations\nN = 1000\n\n# confounder\nL = rnorm(N)\n\n# A is caused by \nA = rnorm(N, L)\n\n# Y draws randomly from L but is not caused by A\nY = rnorm(N, L)\n\n# note we did not need to make a data frame\n\n# regress Y on A without control\nfit_fork  <- lm(Y ~ A)\n\n# A is \"significant\nparameters::model_parameters(fit_fork)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nParameter   | Coefficient |   SE |        95% CI | t(998) |      p\n------------------------------------------------------------------\n(Intercept) |       -0.03 | 0.04 | [-0.11, 0.04] |  -0.89 | 0.373 \nA           |        0.50 | 0.03 | [ 0.45, 0.54] |  19.72 | < .001\n```\n\n\n:::\n\n```{.r .cell-code}\n# regress Y on A with control\nfit_fork_controlled  <- lm(Y ~ A + L)\n\n# A and Y are no longer associated, conditioning worked.\nparameters::model_parameters(fit_fork_controlled)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nParameter   | Coefficient |   SE |        95% CI | t(997) |      p\n------------------------------------------------------------------\n(Intercept) |       -0.02 | 0.03 | [-0.08, 0.04] |  -0.68 | 0.499 \nA           |        0.03 | 0.03 | [-0.03, 0.09] |   0.89 | 0.372 \nL           |        0.95 | 0.05 | [ 0.86, 1.04] |  20.77 | < .001\n```\n\n\n:::\n:::\n\n\n\n\n## Mediation and causation\n\nSuppose we were interested in the causal effect of X on Y.  We have a direct effect of X on Y as well as an indirect effect of X on Y through M. We use `ggdag` to draw the DAG:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngraph_mediation <- dagify(Y ~  M,\n                 M ~ A,\n                exposure = \"A\",\n                outcome = \"Y\") |>\n  ggdag::tidy_dagitty(layout = \"tree\")\n\ngraph_mediation |>\n  ggdag() +   \n  theme_dag_blank() + \n  labs(title = \"Mediation Graph\")\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\nHere is another way\n\n::: {.cell}\n\n```{.r .cell-code}\ngraph_mediation_full <- ggdag_mediation_triangle(x = \"A\", \n                         y = \"Y\", \n                         m = \"M\", \n                         x_y_associated = FALSE) \n\n\ngraph_mediation_full +  theme_dag_blank() + \n  labs(title = \"Fully Mediated Graph\")\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nWhat should we condition on if we are interested in the causal effect of changes in X on changes in Y?\n\nWe can pose the question to `ggdag`:\n\n::: {.cell}\n\n```{.r .cell-code}\n# ask ggdag which variables to condition on:\n\nggdag::ggdag_adjustment_set(graph_fork)\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n'Backdoor Paths Unconditionally Closed' means that, assuming the DAG we have drawn is correct, we may obtain an unbiased estimate of X on Y without including additional variables. \n\nLater we shall understand why this is the case.^[We shall see there is no \"backdoor path\" from X to Y that would bias our estimate, hence the estimate X->Y is an unbiased causal estimate -- again, conditional on our DAG.]\n\nFor now, we can enrich our language for causal inference by considering the concept of `d-connected` and `d-separated`:\n\nTwo variables are `d-connected` if information flows between them (condional on the graph), and they are `d-separated` if they are conditionally independent of each other.\n\n::: {.cell}\n\n```{.r .cell-code}\n# use this code to examine d-connectedness\nggdag::ggdag_dconnected(graph_mediation)\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\nIn this case, d-connection is a good thing because we can estimate the causal effect of A on Y. \n\nIn other cases, d-connection will spoil the model. We have seen this for omitted variable bias. A and Y are d-separated conditional on L, and that's our motivation for including L. These concepts are tricky, but they get easier with practice. \n\nTo add some grit to our exploration of mediation lets simulate data that are consistent with our mediation DAG\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\nN <- 100\nx <- rnorm(N)# sim x\nm <- rnorm(N , x) # sim X -> M\ny <- rnorm(N , x + m) # sim M -> Y\ndf <- data.frame(x, m, y)\n\ndf <- df |>\n  dplyr::mutate(x_s = scale(x),\n                m_s = scale(m))\n```\n:::\n\n\nFirst we ask, is X is related to Y?\n\n::: {.cell}\n\n```{.r .cell-code}\nfit_mediation <- lm(y ~ x_s, data = df)\nparameters::model_parameters(fit_mediation)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nParameter   | Coefficient |   SE |        95% CI | t(98) |      p\n-----------------------------------------------------------------\n(Intercept) |        0.19 | 0.14 | [-0.08, 0.47] |  1.41 | 0.161 \nx s         |        1.66 | 0.14 | [ 1.38, 1.93] | 12.00 | < .001\n```\n\n\n:::\n:::\n\nYes.\n\nNext we ask, is A related to Y conditional on M? \n\n::: {.cell}\n\n```{.r .cell-code}\nfit_total_mediated_effect <- lm(y ~ x_s + m_s, data = df)\nparameters::model_parameters(fit_total_mediated_effect) |> parameters::print_html()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"pikksjwbyf\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#pikksjwbyf table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#pikksjwbyf thead, #pikksjwbyf tbody, #pikksjwbyf tfoot, #pikksjwbyf tr, #pikksjwbyf td, #pikksjwbyf th {\n  border-style: none;\n}\n\n#pikksjwbyf p {\n  margin: 0;\n  padding: 0;\n}\n\n#pikksjwbyf .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 100%;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#pikksjwbyf .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#pikksjwbyf .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#pikksjwbyf .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#pikksjwbyf .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#pikksjwbyf .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#pikksjwbyf .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#pikksjwbyf .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#pikksjwbyf .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#pikksjwbyf .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#pikksjwbyf .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#pikksjwbyf .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#pikksjwbyf .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#pikksjwbyf .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#pikksjwbyf .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#pikksjwbyf .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#pikksjwbyf .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#pikksjwbyf .gt_row {\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#pikksjwbyf .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#pikksjwbyf .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#pikksjwbyf .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#pikksjwbyf .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#pikksjwbyf .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#pikksjwbyf .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#pikksjwbyf .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#pikksjwbyf .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#pikksjwbyf .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#pikksjwbyf .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#pikksjwbyf .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#pikksjwbyf .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#pikksjwbyf .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#pikksjwbyf .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#pikksjwbyf .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#pikksjwbyf .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#pikksjwbyf .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#pikksjwbyf .gt_left {\n  text-align: left;\n}\n\n#pikksjwbyf .gt_center {\n  text-align: center;\n}\n\n#pikksjwbyf .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#pikksjwbyf .gt_font_normal {\n  font-weight: normal;\n}\n\n#pikksjwbyf .gt_font_bold {\n  font-weight: bold;\n}\n\n#pikksjwbyf .gt_font_italic {\n  font-style: italic;\n}\n\n#pikksjwbyf .gt_super {\n  font-size: 65%;\n}\n\n#pikksjwbyf .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#pikksjwbyf .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#pikksjwbyf .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#pikksjwbyf .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#pikksjwbyf .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#pikksjwbyf .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#pikksjwbyf .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#pikksjwbyf .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#pikksjwbyf div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Parameter\">Parameter</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Coefficient\">Coefficient</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"SE\">SE</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"a95%-CI\">95% CI</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"t(97)\">t(97)</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"p\">p</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">(Intercept)</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">0.19</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.10</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(4.92e-03, 0.38)</td>\n<td headers=\"t(97)\" class=\"gt_row gt_center\">2.04</td>\n<td headers=\"p\" class=\"gt_row gt_center\">0.044 </td></tr>\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">x s</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">0.77</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.13</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(0.51, 1.02)</td>\n<td headers=\"t(97)\" class=\"gt_row gt_center\">6.00</td>\n<td headers=\"p\" class=\"gt_row gt_center\">&lt; .001</td></tr>\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">m s</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">1.33</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.13</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(1.07, 1.58)</td>\n<td headers=\"t(97)\" class=\"gt_row gt_center\">10.34</td>\n<td headers=\"p\" class=\"gt_row gt_center\">&lt; .001</td></tr>\n  </tbody>\n  <tfoot class=\"gt_sourcenotes\">\n    <tr>\n      <td class=\"gt_sourcenote\" colspan=\"6\"></td>\n    </tr>\n  </tfoot>\n  \n</table>\n</div>\n```\n\n:::\n:::\n\nYes, but notice this is a different question. The effect of X is attenuated because M contributes to the causal effect of Y. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit_total_effect <- lm(y ~ x_s, data = df)\nparameters::model_parameters(fit_total_effect) |> parameters::print_html()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"tnnfrbxhku\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#tnnfrbxhku table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#tnnfrbxhku thead, #tnnfrbxhku tbody, #tnnfrbxhku tfoot, #tnnfrbxhku tr, #tnnfrbxhku td, #tnnfrbxhku th {\n  border-style: none;\n}\n\n#tnnfrbxhku p {\n  margin: 0;\n  padding: 0;\n}\n\n#tnnfrbxhku .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 100%;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#tnnfrbxhku .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#tnnfrbxhku .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#tnnfrbxhku .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#tnnfrbxhku .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#tnnfrbxhku .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#tnnfrbxhku .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#tnnfrbxhku .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#tnnfrbxhku .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#tnnfrbxhku .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#tnnfrbxhku .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#tnnfrbxhku .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#tnnfrbxhku .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#tnnfrbxhku .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#tnnfrbxhku .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#tnnfrbxhku .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#tnnfrbxhku .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#tnnfrbxhku .gt_row {\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#tnnfrbxhku .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#tnnfrbxhku .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#tnnfrbxhku .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#tnnfrbxhku .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#tnnfrbxhku .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#tnnfrbxhku .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#tnnfrbxhku .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#tnnfrbxhku .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#tnnfrbxhku .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#tnnfrbxhku .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#tnnfrbxhku .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#tnnfrbxhku .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#tnnfrbxhku .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#tnnfrbxhku .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#tnnfrbxhku .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#tnnfrbxhku .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#tnnfrbxhku .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#tnnfrbxhku .gt_left {\n  text-align: left;\n}\n\n#tnnfrbxhku .gt_center {\n  text-align: center;\n}\n\n#tnnfrbxhku .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#tnnfrbxhku .gt_font_normal {\n  font-weight: normal;\n}\n\n#tnnfrbxhku .gt_font_bold {\n  font-weight: bold;\n}\n\n#tnnfrbxhku .gt_font_italic {\n  font-style: italic;\n}\n\n#tnnfrbxhku .gt_super {\n  font-size: 65%;\n}\n\n#tnnfrbxhku .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#tnnfrbxhku .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#tnnfrbxhku .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#tnnfrbxhku .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#tnnfrbxhku .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#tnnfrbxhku .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#tnnfrbxhku .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#tnnfrbxhku .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#tnnfrbxhku div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Parameter\">Parameter</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Coefficient\">Coefficient</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"SE\">SE</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"a95%-CI\">95% CI</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"t(98)\">t(98)</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"p\">p</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">(Intercept)</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">0.19</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.14</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(-0.08, 0.47)</td>\n<td headers=\"t(98)\" class=\"gt_row gt_center\">1.41</td>\n<td headers=\"p\" class=\"gt_row gt_center\">0.161 </td></tr>\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">x s</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">1.66</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.14</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(1.38, 1.93)</td>\n<td headers=\"t(98)\" class=\"gt_row gt_center\">12.00</td>\n<td headers=\"p\" class=\"gt_row gt_center\">&lt; .001</td></tr>\n  </tbody>\n  <tfoot class=\"gt_sourcenotes\">\n    <tr>\n      <td class=\"gt_sourcenote\" colspan=\"6\"></td>\n    </tr>\n  </tfoot>\n  \n</table>\n</div>\n```\n\n:::\n:::\n\n## Pipe confounding (full mediation)\n\nSuppose we are interested in the effect of x on y, in a scenario when m fully mediates the relationship of x on y.\n\n::: {.cell}\n\n```{.r .cell-code}\nmediation_triangle(\n  x = NULL,\n  y = NULL,\n  m = NULL,\n  x_y_associated = FALSE\n) |>\n  ggdag()\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\nWhat variables do we need to include to obtain an unbiased estimate of X on Y?\n\nLet's fill out this example out by imagining an experiment. \n\nSuppose we want to know whether a ritual action condition (X) influences charity (Y). We have good reason to assume the effect of X on Y happens *entirely* through perceived social cohesion (M):  \n\nX$\\to$M$\\to$Z or \nritual $\\to$ social cohesion $\\to$ charity\n\nLets simulate some data\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\n# Participants\nN <-100\n\n# initial charitable giving\nc0 <- rnorm(N ,10 ,2)\n\n# assign treatments and simulate charitable giving and increase in social cohesion\nritual <- rep( 0:1 , each = N/2 )\ncohesion <- ritual * rnorm(N,.5,.2)\n\n# increase in charity\nc1 <- c0 + ritual * cohesion \n\n# dataframe\nd <- data.frame( c0 = c0 , \n                 c1=c1 , \n                 ritual = ritual , \n                 cohesion = cohesion )\nskimr::skim(d)\n```\n\n::: {.cell-output-display}\n\nTable: Data summary\n\n|                         |     |\n|:------------------------|:----|\n|Name                     |d    |\n|Number of rows           |100  |\n|Number of columns        |4    |\n|_______________________  |     |\n|Column type frequency:   |     |\n|numeric                  |4    |\n|________________________ |     |\n|Group variables          |None |\n\n\n**Variable type: numeric**\n\n|skim_variable | n_missing| complete_rate|  mean|   sd|   p0|  p25|   p50|   p75|  p100|hist  |\n|:-------------|---------:|-------------:|-----:|----:|----:|----:|-----:|-----:|-----:|:-----|\n|c0            |         0|             1| 10.18| 1.83| 5.38| 9.01| 10.12| 11.38| 14.37|▁▃▇▅▂ |\n|c1            |         0|             1| 10.43| 1.85| 5.89| 9.17| 10.30| 11.57| 14.99|▂▆▇▆▂ |\n|ritual        |         0|             1|  0.50| 0.50| 0.00| 0.00|  0.50|  1.00|  1.00|▇▁▁▁▇ |\n|cohesion      |         0|             1|  0.25| 0.29| 0.00| 0.00|  0.12|  0.48|  1.15|▇▃▃▁▁ |\n\n\n:::\n:::\n\nDoes the ritual increase charity?\n\nIf we only include the ritual condition in the model, we find that ritual condition reliable predicts increases in charitable giving:\n\n::: {.cell}\n\n```{.r .cell-code}\nparameters::model_parameters(\n  lm(c1 ~  c0 + ritual, data = d)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nParameter   | Coefficient |       SE |        95% CI |  t(97) |      p\n----------------------------------------------------------------------\n(Intercept) |        0.08 |     0.08 | [-0.07, 0.23] |   1.05 | 0.297 \nc0          |        0.99 | 7.26e-03 | [ 0.98, 1.01] | 136.74 | < .001\nritual      |        0.51 |     0.03 | [ 0.46, 0.56] |  19.33 | < .001\n```\n\n\n:::\n:::\n\nDoes the ritual increase charity adjusting for levels of social cohesion?\n\n::: {.cell}\n\n```{.r .cell-code}\nparameters::model_parameters(\n  lm(c1 ~  c0 + ritual + cohesion, data = d)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nParameter   | Coefficient |       SE |         95% CI |    t(96) |      p\n-------------------------------------------------------------------------\n(Intercept) |   -1.05e-14 | 1.02e-15 | [ 0.00,  0.00] |   -10.31 | < .001\nc0          |        1.00 | 9.78e-17 | [ 1.00,  1.00] | 1.02e+16 | < .001\nritual      |    7.36e-16 | 7.78e-16 | [ 0.00,  0.00] |     0.95 | 0.346 \ncohesion    |        1.00 | 1.36e-15 | [ 1.00,  1.00] | 7.35e+14 | < .001\n```\n\n\n:::\n:::\n\nThe answer is that the (direct) effect of ritual entirely drops out when we include both ritual and social cohesion. Why is this? The answer is that once our model knows `m` it does not obtain any new information by knowing `x`.\n\nIf we were interested in assessing x$\\to$y but x were to effect y through m (i.e x$\\to$m$\\to$y) then conditioning on m would **block the path** from x$\\to$y. Including m leads to **Pipe Confounding**.\n\nIn experiments we should never condition on a post-treatment variable.\n\n## Masked relationships\n\nImagine two variables were to affect an outcome. Both are correlated with each other. One affects the outcome positively and the other affects the outcome negatively. How shall we investigate the causal role of the focal predictor?\n\nConsider two correlated variables that jointly predict Political conservatism (C), religion (R). Imagine that one variable has a positive effect and the other has a negative effect on distress (K6).\n\nFirst consider this relationship, where conservatism causes religion\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggdag)\ndag_m1 <- dagify(K ~ C + R,\n                 R ~ C,\n                 exposure = \"C\",\n                 outcome = \"K\") |>\n  tidy_dagitty(layout = \"tree\")\n\n# graph\ndag_m1|>\n  ggdag()\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\nWe can simulate the data:\n\n::: {.cell}\n\n```{.r .cell-code}\n# C -> K <- R\n# C -> R\nset.seed(123)\nn <- 100\nC <- rnorm( n )\nR <- rnorm( n , C )\nK <- rnorm( n , R - C )\n\nd_sim <- data.frame(K=K,R=R,C=C)\n```\n:::\n\nFirst we only condition on conservatism\n\n::: {.cell}\n\n```{.r .cell-code}\nms1 <- parameters::model_parameters(\n  lm(K  ~ C, data = d_sim)\n)\nplot(ms1)\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n\n```{.r .cell-code}\nms1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nParameter   | Coefficient |   SE |        95% CI | t(98) |     p\n----------------------------------------------------------------\n(Intercept) |        0.03 | 0.14 | [-0.24, 0.30] |  0.22 | 0.829\nC           |       -0.19 | 0.15 | [-0.49, 0.11] | -1.24 | 0.219\n```\n\n\n:::\n:::\n\nNext, only religion:\n\n::: {.cell}\n\n```{.r .cell-code}\nms2<- parameters::model_parameters(\n  lm(K  ~ R, data = d_sim)\n)\nplot(ms2)\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\nWhen we add both C and R, we see them \"pop\" in opposite directions, as is typical of masking:\n\n::: {.cell}\n\n```{.r .cell-code}\nms3<- parameters::model_parameters(\n  lm(K  ~ C + R, data = d_sim)\n)\nplot(ms3)\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\nNote that when you ask `ggdag` to assess how to obtain an unbiased estimate of C on K it will tell you you don't need to condition on R.\n\n::: {.cell}\n\n```{.r .cell-code}\ndag_m1|>\n  ggdag_adjustment_set()\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\nYet recall when we just assessed the relationship of C on K we got this:\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(ms1)\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\nIs the DAG wrong? \n\nNo. The fact that C$\\to$R is positive and R$\\to$K is negative means that if we were to increase C, we wouldn't reliably increase K. The total effect of C just isn't reliable\n\n## Collider Confounding\n\nThe selection-distortion effect (Berkson's paradox)\n\nThis example is from the book **Statistical Rethinking**.  Imagine in science there is no relationship between the newsworthiness of science and its trustworthiness. Imagine further that selection committees make decisions on the basis of the both newsworthiness and the trustworthiness of scientific proposals.\n\nThis presents us with the following graph\n\n::: {.cell code_folding='true'}\n\n```{.r .cell-code}\ndag_sd <- dagify(S ~ N,\n                 S ~ T,\n                 labels = c(\"S\" = \"Selection\",\n                            \"N\" = \"Newsworthy\",\n                            \"T\" = \"Trustworthy\")) |>\n  tidy_dagitty(layout = \"nicely\")\n\n# Graph\ndag_sd |>\n  ggdag(text = FALSE, use_labels = \"label\") + theme_dag_blank()\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\nWhen two arrows enter into an variable, it opens a path of information between the two variables.\n\nVery often this openning of information has disasterous implications. *In the human sciences, included variable bias is a woefully underrated problem*.\n\n::: {.cell code_folding='true'}\n\n```{.r .cell-code}\nggdag_dseparated(\n  dag_sd,\n  from = \"T\",\n  to = \"N\",\n  controlling_for = \"S\",\n  text = FALSE,\n  use_labels = \"label\"\n) + theme_dag_blank()\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\nWe can use the `ggdag package` to find colliders among our variables:\n\n::: {.cell}\n\n```{.r .cell-code}\n# code for finding colliders\n\nggdag::ggdag_collider(dag_sd,\n                      text = FALSE,\n                      use_labels = \"label\")\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n:::\n\nThe following simulation (by Solomon Kurz) illustrates the selection-distortion effect, which Richard McElreath discusses in *Statistical Rethinking*:\n\nFirst simulated uncorrelated variables and a process of selection for sub-populations score high on both indicators.\n\n::: {.cell code_folding='true'}\n\n```{.r .cell-code}\n# simulate selection distortion effect, following Solomon Kurz\n# https://bookdown.org/content/4857/the-haunted-dag-the-causal-terror.html\nset.seed(123)\nn <- 1000  # number of grant proposals\np <- 0.05  # proportion to select\n\nd <-\n  # uncorrelated newsworthiness and trustworthiness\n  dplyr::tibble(\n    newsworthiness  = rnorm(n, mean = 0, sd = 1),\n    trustworthiness = rnorm(n, mean = 0, sd = 1)\n  ) |>\n  # total_score\n  dplyr::mutate(total_score = newsworthiness + trustworthiness) |>\n  # select top 10% of combined scores\n  dplyr::mutate(selected = ifelse(total_score >= quantile(total_score, 1 - p), TRUE, FALSE))\n```\n:::\n\nNext filter out the high scoring examples, and assess their correlation.\n\nNote that the act of selection *induces* a correlation within our dataset.\n\n::: {.cell}\n\n```{.r .cell-code}\nd |> \n  dplyr::filter(selected == TRUE) |> \n  dplyr::select(newsworthiness, trustworthiness) |> \n  cor()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                newsworthiness trustworthiness\nnewsworthiness       1.0000000      -0.7318408\ntrustworthiness     -0.7318408       1.0000000\n```\n\n\n:::\n:::\n\nThis makes it seems as if there is a relationship between Trustworthiness and Newsworthiness in science, even when there isn't any.\n\n::: {.cell code_folding='true'}\n\n```{.r .cell-code}\n# we'll need this for the annotation\nlibrary(ggplot2)\ntext <-\n  dplyr::tibble(\n    newsworthiness  = c(2, 1),\n    trustworthiness = c(2.25, -2.5),\n    selected        = c(TRUE, FALSE),\n    label           = c(\"selected\", \"rejected\")\n  )\n\nd |>\n  ggplot2::ggplot(aes(x = newsworthiness, y = trustworthiness, color = selected)) +\n  ggplot2::geom_point(aes(shape = selected), alpha = 3 / 4) +\n  ggplot2::geom_text(data = text,\n            aes(label = label)) +\n  ggplot2::geom_smooth(\n    data = d |> filter(selected == TRUE),\n    method = \"lm\",\n    fullrange = T,\n    color = \"lightblue\",\n    se = F,\n    size = 1\n  ) +\n  # scale_color_manual(values = c(\"black\", \"lightblue\")) +\n  ggplot2::scale_shape_manual(values = c(1, 19)) +\n  ggplot2::scale_x_continuous(limits = c(-3, 3.9), expand = c(0, 0)) +\n  ggplot2::coord_cartesian(ylim = range(d$trustworthiness)) +\n  ggplot2::theme(legend.position = \"none\") +\n  ggplot2::xlab(\"Newsworthy\") +\n  ggplot2::ylab(\"Trustworthy\") + theme_bw()\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-30-1.png){width=672}\n:::\n:::\n\nOnce we know a proposal has been selected, if it is newsworthy we can predict that it is less trustworthy. Our simulation produces this prediction even though we simulated a world in which there is no relationship between trustworthiness and newsworthiness.\n\nSelection bias is commonplace.\n\n## Collider bias within experiments\n\nWe noted that conditioning on a post-treatment variable can induce bias by blocking the path between the experimental manipulation and the outcome. However, such conditioning can open a path even when there is no experimental effect.\n\n::: {.cell code_folding='true'}\n\n```{.r .cell-code}\ndag_ex2 <- dagify(\n  C1 ~ C0 + U,\n  Ch ~ U + R,\n  labels = c(\n    \"R\" = \"Ritual\",\n    \"C1\" = \"Charity-post\",\n    \"C0\" = \"Charity-pre\",\n    \"Ch\" = \"Cohesion\",\n    \"U\" = \"Religiousness (Unmeasured)\"\n  ),\n  exposure = \"R\",\n  outcome = \"C1\",\n  latent = \"U\"\n) |>\n  control_for(c(\"Ch\",\"C0\"))  \n\ndag_ex2 |>\n  ggdag( text = FALSE,\n    use_labels = \"label\")\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-31-1.png){width=672}\n:::\n:::\n\nHow do we avoid collider-bias here?\n\nNote what happens if we condition on cohesion?\n\n::: {.cell}\n\n```{.r .cell-code}\ndag_ex2 |>\n  ggdag_collider(\n    text = FALSE,\n    use_labels = \"label\"\n  )  +\n  ggtitle(\"Cohesion is a collider that opens a path from ritual to charity\")\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-32-1.png){width=672}\n:::\n:::\n\nDon't condition on a post-treatment variable!\n\n::: {.cell}\n\n```{.r .cell-code}\ndag_ex3 <- dagify(\n  C1 ~ C0,\n  C1 ~ U,\n  Ch ~ U + R,\n  labels = c(\n    \"R\" = \"Ritual\",\n    \"C1\" = \"Charity-post\",\n    \"C0\" = \"Charity-pre\",\n    \"Ch\" = \"Cohesion\",\n    \"U\" = \"Religiousness (Unmeasured)\"\n  ),\n  exposure = \"R\",\n  outcome = \"C1\",\n  latent = \"U\"\n)\nggdag_adjustment_set(dag_ex3)\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-33-1.png){width=672}\n:::\n:::\n\n## Taxonomy of confounding\n\nThere is good news. Remember, ultimately are only four basic types of confounding:\n\n### The Fork (omitted variable bias)\n\n::: {.cell}\n\n```{.r .cell-code}\nconfounder_triangle(x = \"Coffee\",\n                    y = \"Lung Cancer\",\n                    z = \"Smoking\") |>\n  ggdag_dconnected(text = FALSE,\n                   use_labels = \"label\")\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-34-1.png){width=672}\n:::\n:::\n\n### The Pipe (fully mediated effects)\n\n::: {.cell}\n\n```{.r .cell-code}\nmediation_triangle(\n  x = NULL,\n  y = NULL,\n  m = NULL,\n  x_y_associated = FALSE\n) |>\n  tidy_dagitty(layout = \"nicely\") |>\n  ggdag()\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-35-1.png){width=672}\n:::\n:::\n\n### The Collider\n\n::: {.cell}\n\n```{.r .cell-code}\ncollider_triangle() |>\n  ggdag_dseparated(controlling_for = \"m\")\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-36-1.png){width=672}\n:::\n:::\n\n### Confounding by proxy\n\nIf we \"control for\" a descendant of a collider, we will introduce collider bias.\n\n::: {.cell}\n\n```{.r .cell-code}\ndag_sd <- dagify(\n  Z ~ X,\n  Z ~ Y,\n  D ~ Z,\n  labels = c(\n    \"Z\" = \"Collider\",\n    \"D\" = \"Descendant\",\n    \"X\" = \"X\",\n    \"Y\" = \"Y\"\n  ),\n  exposure = \"X\",\n  outcome = \"Y\"\n) |>\n  control_for(\"D\") \n\ndag_sd |>\n  ggdag_dseparated(\n    from = \"X\",\n    to = \"Y\",\n    controlling_for = \"D\",\n    text = FALSE,\n    use_labels = \"label\"\n  )  +\n  ggtitle(\"X --> Y, controlling for D\",\n          subtitle = \"D induces collider bias\")\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-37-1.png){width=672}\n:::\n:::\n\n## Rules for avoiding confounding\n\nFrom *Statistical Rethinking*, p.286\n\n> List all of the paths connecting X (the potential cause of interest) and Y (the outcome).\n\n> Classify each path by whether it is open or closed. A path is open unless it contains a collider.\n\n> Classify each path by whether it is a backdoor path. A backdoor path has an arrow entering X.\n\n> If there are any open backdoor paths, decide which variable(s) to condition on to close it (if possible).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Examle\n# call ggdag model\n# write relationships:\n\nlibrary(ggdag)\ndg_1 <- ggdag::dagify(\n  b ~  im + ordr + rel + sr  + st,\n  rel ~  age + ses + edu + male + cny,\n  ses ~ cny + edu + age,\n  edu ~ cny + male + age,\n  im ~ mem + rel + cny,\n  mem ~ age + edu + ordr,\n  exposure = \"sr\",\n  outcome = \"b\",\n  labels = c(\n    \"b\" = \"statement credibility\",\n    \"sr\" = \"source\",\n    \"st\" = \"statement\",\n    \"im\" = \"importance\",\n    \"mem\" = \"memory\",\n    \"s\" = \"source\",\n    \"rel\" = \"religious\",\n    \"cny\" = \"country\",\n    \"mem\" = \"memory\",\n    \"male\" = \"male\",\n    \"ordr\" = \"presentation order\",\n    \"ses\" = \"perceived SES\",\n    \"edu\" = \"education\",\n    \"age\" = \"age\"\n  )\n) |>\n  control_for(\"rel\")\n\nggdag::ggdag_collider(dg_1, text = FALSE, use_labels = \"label\")\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-38-1.png){width=672}\n:::\n:::\n\n\nNote the colliders induced from the \"controls\" that we had included in the study:\n\n::: {.cell}\n\n```{.r .cell-code}\np3 <- ggdag::ggdag_dseparated(\n  dg_1,\n  from = \"sr\",\n  to = \"b\",\n  controlling_for = c(\"ses\", \"age\", \"cny\", \"im\", \"edu\", \"mem\", \"male\", \"rel\"),\n  text = FALSE,\n  use_labels  = \"label\"\n) +\n  theme_dag_blank() +\n  labs(title = \"Collider Confounding occurs when we `control for` a bunch of variables\")\np3\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-39-1.png){width=672}\n:::\n:::\n\nHow do we fix the problem? Think hard about the causal network and let `ggdag` do the work.\n\n::: {.cell}\n\n```{.r .cell-code}\n# find adjustment set\np2 <- ggdag::ggdag_adjustment_set(dg_1,\n                                  text = FALSE,\n                                  use_labels  = \"label\") +\n  theme_dag_blank() +\n  labs(title = \"Adjustment set\",\n       subtite = \"Model for Source credibility from belief \")\np2\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-40-1.png){width=672}\n:::\n:::\n\n## Inference depends on assumptions that are not contained in the data.\n\n> regression itself does not provide the evidence you need to justify a causal model. Instead, you need some science.\" -- Richard McElreath: \"Statistical Rethinking, Chapter 6\"\n\n> \"...the data alone can never tell you which causal model is correct\"- Richard McElreath: \"Statistical Rethinking\" Chapter 5\n\n> \"The parameter estimates will always depend upon what you believe about the causal model, because typically several (or very many) causal models are consistent with any one set of parameter estimates.\" \"Statistical Rethinking\" Chapter 5\n\n\nSuppose we assume that the source condition affects religion, say through priming. We then have the following dag:\n\n::: {.cell}\n\n```{.r .cell-code}\n## adding religion to effect on edu\ndg_3 <- ggdag::dagify(\n  b ~  im + ordr + rel  + st + sr,\n  rel ~  age + ses + edu + male + cny + sr,\n  ses ~ cny + edu + age,\n  edu ~ cny + male + age,\n  im ~ mem + rel + cny,\n  mem ~ age + edu + ordr,\n  exposure = \"rel\",\n  outcome = \"b\",\n  labels = c(\n    \"b\" = \"statement credibility\",\n    \"sr\" = \"source\",\n    \"st\" = \"statement\",\n    \"im\" = \"importance\",\n    \"mem\" = \"memory\",\n    \"s\" = \"source\",\n    \"rel\" = \"religious\",\n    \"cny\" = \"country\",\n    \"mem\" = \"memory\",\n    \"male\" = \"male\",\n    \"ordr\" = \"presentation order\",\n    \"ses\" = \"perceived SES\",\n    \"edu\" = \"education\",\n    \"age\" = \"age\"\n   )\n)|>\n  control_for(\"rel\")\n\nggdag(dg_3, text = FALSE, use_labels  = \"label\")\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-41-1.png){width=672}\n:::\n:::\n\nWe turn to our trusted oracle, and and ask: \"What do we condition on to obtain an unbiased causal estimate?\"\n\nThe oracle replies:\n\n::: {.cell}\n\n```{.r .cell-code}\nggdag::ggdag_adjustment_set(\n  dg_3,\n  exposure = \"sr\",\n  outcome = \"b\",\n  text = FALSE,\n  use_labels  = \"label\"\n) +\n  theme_dag_blank() +\n  labs(title = \"Adjustment set\",\n       subtite = \"Model for Source credibility from belief \")\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-42-1.png){width=672}\n:::\n:::\n\nYour data cannot answer your question.\n\n## More examples of counfounding/de-confounding\n\nHere's another example from recent NZAVS research\n\n::: {.cell}\n\n```{.r .cell-code}\ntidy_ggdag <- dagify(\n  WB ~ belief + age_within + age_between + partner + nzdep + urban + male + pols + empl,\n  WB ~~ partner,\n  belief ~ age_within + age_between + male + ethn,\n  partner ~ nzdep + age_within + age_between + belief, \n  nzdep ~ empl + age_within + age_between,\n  pols ~ age_within + age_between + empl + ethn,\n  empl ~  edu + ethn + age_within + age_between,\n  exposure =  \"belief\",\n  outcome =   \"WB\")|>\n  tidy_dagitty()\n\n# graph\ntidy_ggdag |>\n  ggdag()\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-43-1.png){width=672}\n:::\n:::\n\nWe can examine which variables to select, conditional on the causal assumptions of this dag\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# graph adjustment sets\nggdag::ggdag_adjustment_set(tidy_ggdag, node_size = 14) + \n  theme(legend.position = \"bottom\") + theme_dag_blank()\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-44-1.png){width=672}\n:::\n:::\n\nThis method reveals two adjustments sets: {age, employment, male,\npolitical conservativism, and time}, and {age, ethnicty, male, and\ntime.} We report the second set because employment is likely to contain\nmore measurement error: some are not employed because they cannot find\nemployment, others because they are not seeking employment (e.g.\nretirement).\n\n### Unmeasured causes\n\nReturn to the previous example of R and C on K6 distress, but imagine an underlying common cause of both C and R (say childhood upbringing) called \"U\":\n\n::: {.cell}\n\n```{.r .cell-code}\ndag_m3 <- dagify(\n  K ~ C + R,\n  C ~ U,\n  R ~ U,\n  exposure = \"C\",\n  outcome = \"K\",\n  latent = \"U\"\n) |>\n  tidy_dagitty(layout = \"nicely\")\n\ndag_m3 |>\n  ggdag()\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-45-1.png){width=672}\n:::\n:::\n\nHow do we assess the relationship of C on K?\n\nWe can close the backdoor from U through R by conditioning on R\n\n::: {.cell}\n\n```{.r .cell-code}\nggdag::ggdag_adjustment_set(dag_m3)\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-46-1.png){width=672}\n:::\n:::\n\nAside, we can simulate this relationship using the following code:\n\n::: {.cell}\n\n```{.r .cell-code}\n# C -> K <- R\n# C <- U -> R\nn <- 100\nU <- rnorm( n )\nR <- rnorm( n , U )\nC <- rnorm( n , U )\nK <- rnorm( n , R - C )\nd_sim3 <- data.frame(K = K, R = R, U = U, C = C )\n```\n:::\n\n### What is the relationship between smoking and cardiac arrest?\n\n\nThis example is from the `ggdag` package, by Malcolm Barrett [here](https://ggdag.malco.io/)\n\n::: {.cell}\n\n```{.r .cell-code}\nsmoking_ca_dag <- dagify(\n  cardiacarrest ~ cholesterol,\n  cholesterol ~ smoking + weight,\n  smoking ~ unhealthy,\n  weight ~ unhealthy,\n  labels = c(\n    \"cardiacarrest\" = \"Cardiac\\n Arrest\",\n    \"smoking\" = \"Smoking\",\n    \"cholesterol\" = \"Cholesterol\",\n    \"unhealthy\" = \"Unhealthy\\n Lifestyle\",\n    \"weight\" = \"Weight\"\n  ),\n  latent = \"unhealthy\",\n  exposure = \"smoking\",\n  outcome = \"cardiacarrest\"\n)\n\nggdag(smoking_ca_dag,\n      text = FALSE,\n      use_labels = \"label\")\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-48-1.png){width=672}\n:::\n:::\n\nWhat do we condition on to close any open backdoor paths, while avoiding colliders? We imagine that unhealthy lifestyle is unmeasured.\n\n::: {.cell}\n\n```{.r .cell-code}\nggdag_adjustment_set(\n  smoking_ca_dag,\n  text = FALSE,\n  use_labels = \"label\",\n  shadow = TRUE\n)\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-49-1.png){width=672}\n:::\n:::\n\nWhat if we control for cholesterol?\n\n::: {.cell}\n\n```{.r .cell-code}\nggdag_dseparated(\n  smoking_ca_dag,\n  controlling_for = c(\"weight\", \"cholesterol\"),\n  text = FALSE,\n  use_labels = \"label\",\n  collider_lines = FALSE\n)\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-50-1.png){width=672}\n:::\n:::\n\n> Controlling for intermediate variables may also induce bias, because it decomposes the total effect of x on y into its parts. (ggdag documentation)\n\n### Selection bias in sampling\n\nThis example is from <https://ggdag.malco.io/articles/bias-structures.html>\n\n> Let's say we're doing a case-control study and want to assess the effect of smoking on glioma, a type of brain cancer. We have a group of glioma patients at a hospital and want to compare them to a group of controls, so we pick people in the hospital with a broken bone, since that seems to have nothing to do with brain cancer. However, perhaps there is some unknown confounding between smoking and being in the hospital with a broken bone, like being prone to reckless behavior. In the normal population, there is no causal effect of smoking on glioma, but in our case, we're selecting on people who have been hospitalized, which opens up a back-door path:\n\n::: {.cell}\n\n```{.r .cell-code}\ncoords_mine <- tibble::tribble(\n  ~name,           ~x,  ~y,\n  \"glioma\",         1,   2,\n  \"hospitalized\",   2,   3,\n  \"broken_bone\",    3,   2,\n  \"reckless\",       4,   1,\n  \"smoking\",        5,   2\n)\n\ndagify(hospitalized ~ broken_bone + glioma,\n       broken_bone ~ reckless,\n       smoking ~ reckless,\n       labels = c(hospitalized = \"Hospitalization\",\n                  broken_bone = \"Broken Bone\",\n                  glioma = \"Glioma\",\n                  reckless = \"Reckless \\nBehavior\",\n                  smoking = \"Smoking\"),\n       coords = coords_mine) |> \n  ggdag_dconnected(\"glioma\", \"smoking\", controlling_for = \"hospitalized\", \n                   text = FALSE, use_labels = \"label\", collider_lines = FALSE)\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-51-1.png){width=672}\n:::\n:::\n\n> Even though smoking doesn't actually cause glioma, it will appear as if there is an association. Actually, in this case, it may make smoking appear to be protective against glioma, since controls are more likely to be smokers.\n\n### Selection bias in longitudinal research\n\nSuppose we want to estimate the effect of ethnicity on ecological orientation in a longitudinal dataset where there is selection bias from homeownership (it is easier to reach homeowners by the mail.)\n\nSuppose the following DAG:\n\n::: {.cell}\n\n```{.r .cell-code}\ndag_sel <- dagify(\n  retained ~ homeowner,\n  homeowner ~ income + ethnicity,\n  ecologicalvalues ~  ethnicity + income,\n  labels = c(\n    retained = \"retained\",\n    homeowner = \"homeowner\",\n    ethnicity = \"ethnicity\",\n    income = \"income\",\n    ecologicalvalues = \"Ecological \\n Orientation\"\n  ),\n  exposure = \"ethnicity\",\n  outcome = \"ecologicalvalues\"\n) |>\n  control_for(\"retained\")\n\n\ndag_sel |>\n  ggdag_adjust(\n    \"retained\",\n    layout = \"mds\",\n    text = FALSE,\n    use_labels = \"label\",\n    collider_lines = FALSE\n  )\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-52-1.png){width=672}\n:::\n:::\n\nNotice that \"retained\" falls downstream from a collider, \"home ownership\"\n\n::: {.cell}\n\n```{.r .cell-code}\nggdag_collider(dag_sel)\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-53-1.png){width=672}\n:::\n:::\n\nBecause we are stratifying on \"retained\", we introduce collider bias in our estimate of ethnicity on ecological values.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggdag_dseparated(\n  dag_sel,\n  controlling_for = \"retained\",\n  text = FALSE,\n  use_labels = \"label\",\n  collider_lines = TRUE\n)\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-54-1.png){width=672}\n:::\n:::\n\n\nHowever we have an adjustment set\n\n::: {.cell}\n\n```{.r .cell-code}\nggdag_adjustment_set(dag_sel)\n```\n\n::: {.cell-output-display}\n![](04-content_files/figure-html/unnamed-chunk-55-1.png){width=672}\n:::\n:::\n\n## Workflow\n\n1. Import your data\n2. Check that data types are correct\n3. Graph your data\n4. Consider your question\n5. If causal, draw your DAG/S\n6. Explain your DAG's\n7. Write your model\n8. Run your model\n9. Graph and interpret your results\n10. Return to your question, and assess what you have learned. \n\n(Typically there are multiple iterations between these steps in your workflow. Annotate your scripts; keep track of your decisions)\n\n\n## Summary\n\n-  We control for variables to avoid omitted variable bias\n-  Omitted variable bias is real, but also commonplace is included variable bias\n-  Included variable biases arise from \"pipes\", \"colliders\", and conditioning on descendant of colliders.\n-  The `ggdag` package can help you to obtain causal inference, but it relies on assumptions that are not part of your data. \n-  Clarify your assumption.\n\n\n### Packages\n\n::: {.cell}\n\n```{.r .cell-code}\nreport::cite_packages()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  - Barrett M (2024). _ggdag: Analyze and Create Elegant Directed Acyclic Graphs_. R package version 0.2.13, <https://CRAN.R-project.org/package=ggdag>.\n  - Chang W (2023). _extrafont: Tools for Using Fonts_. R package version 0.19, <https://CRAN.R-project.org/package=extrafont>.\n  - Grolemund G, Wickham H (2011). \"Dates and Times Made Easy with lubridate.\" _Journal of Statistical Software_, *40*(3), 1-25. <https://www.jstatsoft.org/v40/i03/>.\n  - Müller K, Wickham H (2023). _tibble: Simple Data Frames_. R package version 3.2.1, <https://CRAN.R-project.org/package=tibble>.\n  - R Core Team (2024). _R: A Language and Environment for Statistical Computing_. R Foundation for Statistical Computing, Vienna, Austria. <https://www.R-project.org/>.\n  - Wickham H (2016). _ggplot2: Elegant Graphics for Data Analysis_. Springer-Verlag New York. ISBN 978-3-319-24277-4, <https://ggplot2.tidyverse.org>.\n  - Wickham H (2023). _forcats: Tools for Working with Categorical Variables (Factors)_. R package version 1.0.0, <https://CRAN.R-project.org/package=forcats>.\n  - Wickham H (2023). _stringr: Simple, Consistent Wrappers for Common String Operations_. R package version 1.5.1, <https://CRAN.R-project.org/package=stringr>.\n  - Wickham H, Averick M, Bryan J, Chang W, McGowan LD, François R, Grolemund G, Hayes A, Henry L, Hester J, Kuhn M, Pedersen TL, Miller E, Bache SM, Müller K, Ooms J, Robinson D, Seidel DP, Spinu V, Takahashi K, Vaughan D, Wilke C, Woo K, Yutani H (2019). \"Welcome to the tidyverse.\" _Journal of Open Source Software_, *4*(43), 1686. doi:10.21105/joss.01686 <https://doi.org/10.21105/joss.01686>.\n  - Wickham H, François R, Henry L, Müller K, Vaughan D (2023). _dplyr: A Grammar of Data Manipulation_. R package version 1.1.4, <https://CRAN.R-project.org/package=dplyr>.\n  - Wickham H, Henry L (2025). _purrr: Functional Programming Tools_. R package version 1.0.4, <https://CRAN.R-project.org/package=purrr>.\n  - Wickham H, Hester J, Bryan J (2024). _readr: Read Rectangular Text Data_. R package version 2.1.5, <https://CRAN.R-project.org/package=readr>.\n  - Wickham H, Vaughan D, Girlich M (2024). _tidyr: Tidy Messy Data_. R package version 1.3.1, <https://CRAN.R-project.org/package=tidyr>.\n  - Xie Y (2025). _tinytex: Helper Functions to Install and Maintain TeX Live, and Compile LaTeX Documents_. R package version 0.56, <https://github.com/rstudio/tinytex>. Xie Y (2019). \"TinyTeX: A lightweight, cross-platform, and easy-to-maintain LaTeX distribution based on TeX Live.\" _TUGboat_, *40*(1), 30-32. <https://tug.org/TUGboat/Contents/contents40-1.html>.\n```\n\n\n:::\n:::\n\n\n  ",
    "supporting": [
      "04-content_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}