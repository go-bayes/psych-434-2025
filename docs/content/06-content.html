<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.20">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joseph Bulbulia">
<meta name="dcterms.date" content="2025-04-01">

<title>Causal Inference: Understanding How Effects Differ – PSYC 434 Conducting Research Across Cultures: Trimester 1, 2025</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-94df807a54b4aea56b59f6b1a3567e79.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-d5a3029baa3e394e88f18ffb9b51a21b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">PSYC 434 Conducting Research Across Cultures: Trimester 1, 2025</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../content/course-outline.html"> 
<span class="menu-text">Course Outline</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-content" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Content</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-content">    
        <li>
    <a class="dropdown-item" href="../content/glossary.pdf">
 <span class="dropdown-text">Glossary</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/course-outline.html">
 <span class="dropdown-text">Course Outline</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/01-content.html">
 <span class="dropdown-text">Week 1: Course Introduction - R (installing packages)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/02-content.html">
 <span class="dropdown-text">Week 2: Causal Diagrams - Elementary Structures and Rules - R (using the interface)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/03-content.html">
 <span class="dropdown-text">Week 3: Causal Diagrams - Confounding Bias - R (regression/simulation)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/04-content.html">
 <span class="dropdown-text">Week 4: Causal Diagrams - Interaction, Measurement Bias, Selection Bias - R (regression/simulation)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/05-content.html">
 <span class="dropdown-text">Week 5: Causal Inference - Average Treatment Effects - R (regression/simulation: ATE)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/06-content.html">
 <span class="dropdown-text">Week 6: Conditional Average Treatment Effects (CATE) - R (regression/simulation: ATE)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/07-quiz.html">
 <span class="dropdown-text">Week 7: In Class Test</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/08-content.html">
 <span class="dropdown-text">Week 8: Causal Inference - Estimation of ATE and CATE - R and LaTeX</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/09-content.html">
 <span class="dropdown-text">Week 9: Hands On: A Full Study Analysis in R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/10-content.html">
 <span class="dropdown-text">Week 10: Hands On: Writing Up Your Analysis: Quarto Documents</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/11-content.html">
 <span class="dropdown-text">Week 11: Measurement: Factor Analysis, CFA, MultiGroup CFA, Partial Invariance/ And How These Approaches Fail</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/12-content.html">
 <span class="dropdown-text">Week 12: Student Presentations</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Causal Inference: Understanding How Effects Differ</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
            <p class="subtitle lead">Effect Modification, Interaction, and Conditional Average Treatment Effects</p>
                      </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Joseph Bulbulia <a href="mailto:joseph.bulbulia@vuw.ac.nz" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0002-5861-2056" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Victoria University of Wellington, New Zealand
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 1, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#if-you-learn-nothing-else-from-this-course" id="toc-if-you-learn-nothing-else-from-this-course" class="nav-link active" data-scroll-target="#if-you-learn-nothing-else-from-this-course">If you learn nothing else from this course…</a></li>
  <li><a href="#causal-inference-asks-what-if" id="toc-causal-inference-asks-what-if" class="nav-link" data-scroll-target="#causal-inference-asks-what-if">Causal inference asks: “What if?”</a></li>
  <li><a href="#what-do-interaction-and-effect-modification-mean-in-causal-inference" id="toc-what-do-interaction-and-effect-modification-mean-in-causal-inference" class="nav-link" data-scroll-target="#what-do-interaction-and-effect-modification-mean-in-causal-inference">What do ‘Interaction’ and ‘Effect Modification’ mean in Causal Inference?</a></li>
  <li><a href="#interaction-the-effect-of-teamwork-or-lack-thereof" id="toc-interaction-the-effect-of-teamwork-or-lack-thereof" class="nav-link" data-scroll-target="#interaction-the-effect-of-teamwork-or-lack-thereof">Interaction: The Effect of Teamwork (or Lack Thereof)</a>
  <ul class="collapse">
  <li><a href="#defining-interaction-does-1-1-2" id="toc-defining-interaction-does-1-1-2" class="nav-link" data-scroll-target="#defining-interaction-does-1-1-2">Defining Interaction: Does 1 + 1 = 2?</a></li>
  </ul></li>
  <li><a href="#effect-modification-different-effects-for-different-people" id="toc-effect-modification-different-effects-for-different-people" class="nav-link" data-scroll-target="#effect-modification-different-effects-for-different-people">Effect Modification: Different Effects for Different People</a>
  <ul class="collapse">
  <li><a href="#heterogeneous-treatment-effects-hte-the-idea-of-variation" id="toc-heterogeneous-treatment-effects-hte-the-idea-of-variation" class="nav-link" data-scroll-target="#heterogeneous-treatment-effects-hte-the-idea-of-variation">Heterogeneous Treatment Effects (HTE): The Idea of Variation</a></li>
  <li><a href="#conditional-average-treatment-effect-cate-measuring-variation-with-data-taux" id="toc-conditional-average-treatment-effect-cate-measuring-variation-with-data-taux" class="nav-link" data-scroll-target="#conditional-average-treatment-effect-cate-measuring-variation-with-data-taux">Conditional Average Treatment Effect (CATE): Measuring Variation with Data <span class="math inline">\tau(x)</span></a></li>
  <li><a href="#comparing-effects-across-defined-groups" id="toc-comparing-effects-across-defined-groups" class="nav-link" data-scroll-target="#comparing-effects-across-defined-groups">Comparing Effects Across Defined Groups</a></li>
  </ul></li>
  <li><a href="#estimating-how-effects-vary-getting-hattaux-from-data" id="toc-estimating-how-effects-vary-getting-hattaux-from-data" class="nav-link" data-scroll-target="#estimating-how-effects-vary-getting-hattaux-from-data">Estimating How Effects Vary: Getting <span class="math inline">\hat{\tau}(x)</span> from Data</a>
  <ul class="collapse">
  <li><a href="#personalised-effects-vs.-true-individual-effects" id="toc-personalised-effects-vs.-true-individual-effects" class="nav-link" data-scroll-target="#personalised-effects-vs.-true-individual-effects">“Personalised” Effects vs.&nbsp;True Individual Effects</a></li>
  <li><a href="#people-have-many-characteristics" id="toc-people-have-many-characteristics" class="nav-link" data-scroll-target="#people-have-many-characteristics">People Have Many Characteristics</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul></li>
  <li><a href="#course-review-so-far-a-quick-recap" id="toc-course-review-so-far-a-quick-recap" class="nav-link" data-scroll-target="#course-review-so-far-a-quick-recap">Course Review So Far: A Quick Recap</a>
  <ul class="collapse">
  <li><a href="#the-big-question-does-a-cause-y" id="toc-the-big-question-does-a-cause-y" class="nav-link" data-scroll-target="#the-big-question-does-a-cause-y">The Big Question: Does A cause Y?</a></li>
  <li><a href="#core-idea-what-if-counterfactuals" id="toc-core-idea-what-if-counterfactuals" class="nav-link" data-scroll-target="#core-idea-what-if-counterfactuals">Core Idea: “What If?” (Counterfactuals)</a></li>
  <li><a href="#this-lecture-clarified-concepts-of-interaction-vs.-effect-modification-vs.-individual-predictions" id="toc-this-lecture-clarified-concepts-of-interaction-vs.-effect-modification-vs.-individual-predictions" class="nav-link" data-scroll-target="#this-lecture-clarified-concepts-of-interaction-vs.-effect-modification-vs.-individual-predictions">This Lecture Clarified Concepts of Interaction vs.&nbsp;Effect Modification vs.&nbsp;Individual Predictions</a></li>
  <li><a href="#simple-summary" id="toc-simple-summary" class="nav-link" data-scroll-target="#simple-summary">Simple Summary:</a></li>
  </ul></li>
  <li><a href="#lab-part-1-setting-up-your-data" id="toc-lab-part-1-setting-up-your-data" class="nav-link" data-scroll-target="#lab-part-1-setting-up-your-data">Lab Part 1: Setting up your data</a>
  <ul class="collapse">
  <li><a href="#set-up-your-libraries" id="toc-set-up-your-libraries" class="nav-link" data-scroll-target="#set-up-your-libraries">Set up your libraries</a></li>
  <li><a href="#set-up-a-path-to-a-folder-in-your-directory" id="toc-set-up-a-path-to-a-folder-in-your-directory" class="nav-link" data-scroll-target="#set-up-a-path-to-a-folder-in-your-directory">Set up a path to a folder in your directory</a></li>
  <li><a href="#initial-data-wrangling-to-select-the-study-sample" id="toc-initial-data-wrangling-to-select-the-study-sample" class="nav-link" data-scroll-target="#initial-data-wrangling-to-select-the-study-sample">Initial Data Wrangling to select the study sample</a></li>
  <li><a href="#define-your-baseline-covariates-treatment-exposure-and-outcome" id="toc-define-your-baseline-covariates-treatment-exposure-and-outcome" class="nav-link" data-scroll-target="#define-your-baseline-covariates-treatment-exposure-and-outcome">Define your baseline covariates, treatment (exposure), and outcome</a></li>
  <li><a href="#make-your-baseline-table" id="toc-make-your-baseline-table" class="nav-link" data-scroll-target="#make-your-baseline-table">Make your baseline table</a></li>
  <li><a href="#make-tables" id="toc-make-tables" class="nav-link" data-scroll-target="#make-tables">Make tables</a></li>
  </ul></li>
  <li><a href="#baseline-table" id="toc-baseline-table" class="nav-link" data-scroll-target="#baseline-table">Baseline table</a></li>
  <li><a href="#exposure-table" id="toc-exposure-table" class="nav-link" data-scroll-target="#exposure-table">Exposure table</a></li>
  <li><a href="#outcome-table" id="toc-outcome-table" class="nav-link" data-scroll-target="#outcome-table">Outcome table</a>
  <ul class="collapse">
  <li><a href="#inspect-the-distribution-of-the-exposure-in-treatment-wave" id="toc-inspect-the-distribution-of-the-exposure-in-treatment-wave" class="nav-link" data-scroll-target="#inspect-the-distribution-of-the-exposure-in-treatment-wave">Inspect the distribution of the exposure in treatment wave</a></li>
  <li><a href="#check-for-change-in-the-treatment-positivity" id="toc-check-for-change-in-the-treatment-positivity" class="nav-link" data-scroll-target="#check-for-change-in-the-treatment-positivity">Check for change in the treatment (Positivity)</a></li>
  <li><a href="#explanation-for-the-table" id="toc-explanation-for-the-table" class="nav-link" data-scroll-target="#explanation-for-the-table">Explanation for the table</a></li>
  <li><a href="#lab-part-2-simulation-to-clarify-why-the-distribution-of-effect-modifiers-matter-for-estimating-treatment-effects" id="toc-lab-part-2-simulation-to-clarify-why-the-distribution-of-effect-modifiers-matter-for-estimating-treatment-effects" class="nav-link" data-scroll-target="#lab-part-2-simulation-to-clarify-why-the-distribution-of-effect-modifiers-matter-for-estimating-treatment-effects">Lab Part 2: Simulation to Clarify Why The Distribution of Effect Modifiers Matter For Estimating Treatment Effects</a></li>
  <li><a href="#lessons-from-lab-2" id="toc-lessons-from-lab-2" class="nav-link" data-scroll-target="#lessons-from-lab-2">Lessons from Lab 2</a></li>
  <li><a href="#appendix-a-simplification-of-additive-interaction-formula" id="toc-appendix-a-simplification-of-additive-interaction-formula" class="nav-link" data-scroll-target="#appendix-a-simplification-of-additive-interaction-formula">Appendix A: Simplification of Additive Interaction Formula</a></li>
  <li><a href="#appendix-b" id="toc-appendix-b" class="nav-link" data-scroll-target="#appendix-b">Appendix B</a>
  <ul class="collapse">
  <li><a href="#evidence-for-effect-modification-is-relative-to-inclusion-of-other-variables-in-the-model" id="toc-evidence-for-effect-modification-is-relative-to-inclusion-of-other-variables-in-the-model" class="nav-link" data-scroll-target="#evidence-for-effect-modification-is-relative-to-inclusion-of-other-variables-in-the-model">Evidence for effect-modification is relative to inclusion of other variables in the model</a></li>
  <li><a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages">Packages</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">





<style>
  .boxedblue {
      border: 2px solid blue;
      border-radius: 4px; /* slight roundness */
      padding: 3px 6px; /* vertical | horizontal */
      display: inline-block;
      color: blue;
    }
  .circleblue {
      border: 2px dashed blue;
      border-radius: 50%;
      padding: 3px 6px;
      display: inline-block;
      color: blue;
    }
</style>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Required Reading</strong></p>
<ul>
<li><span class="citation" data-cites="hernan2024WHATIF">(<a href="#ref-hernan2024WHATIF" role="doc-biblioref">Hernan and Robins 2020</a>)</span> Chapters 4-5 <a href="https://www.dropbox.com/scl/fi/9hy6xw1g1o4yz94ip8cvd/hernanrobins_WhatIf_2jan24.pdf?rlkey=8eaw6lqhmes7ddepuriwk5xk9&amp;dl=0">link</a></li>
</ul>
<p><strong>Optional Reading</strong></p>
<ul>
<li><p><span class="citation" data-cites="vanderweele2007FOURTYPESOFEFFECT">(<a href="#ref-vanderweele2007FOURTYPESOFEFFECT" role="doc-biblioref">Tyler J. VanderWeele and Robins 2007a</a>)</span> <a href="https://www.dropbox.com/scl/fi/drytp2ui2b8o9jplh4bm9/four_types_of_effect_modification__a.6.pdf?rlkey=mb9nl599v93m6kyyo69iv5nz1&amp;dl=0">link</a></p></li>
<li><p><span class="citation" data-cites="vanderweele2009distinction">(<a href="#ref-vanderweele2009distinction" role="doc-biblioref">Tyler J. VanderWeele 2009</a>)</span> <a href="https://www.dropbox.com/scl/fi/srpynr0dvjcndveplcydn/OutcomeWide_StatisticalScience.pdf?rlkey=h4fv32oyjegdfl3jq9u1fifc3&amp;dl=0">link</a></p></li>
</ul>
</div>
</div>
<div class="no-row-height column-margin column-container"></div><div class="no-row-height column-margin column-container"><div id="ref-vanderweele2007FOURTYPESOFEFFECT" class="csl-entry" role="listitem">
———. 2007a. <span>“Four types of effect modification: a classification based on directed acyclic graphs.”</span> <em>Epidemiology (Cambridge, Mass.)</em> 18 (5): 561–68. <a href="https://doi.org/10.1097/EDE.0b013e318127181b">https://doi.org/10.1097/EDE.0b013e318127181b</a>.
</div></div><div class="no-row-height column-margin column-container"><div id="ref-hernan2024WHATIF" class="csl-entry" role="listitem">
Hernan, M. A., and J. M. Robins. 2020. <em>Causal Inference: What If?</em> Chapman &amp; Hall/CRC Monographs on Statistics &amp; Applied Probab. Taylor &amp; Francis. <a href="https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/">https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/</a>.
</div></div><div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key Concepts for Assessment
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Causal Estimand:</strong> The specific causal question we want to answer (e.g., the average effect in the whole population).</li>
<li><strong>Statistical Estimand:</strong> The calculation we perform on our data to try and answer the causal question.</li>
<li><strong>Interaction:</strong> The combined effect of <em>two or more</em> interventions.</li>
<li><strong>Effect Modification:</strong> When the effect of <em>one</em> intervention changes depending on a person’s characteristics.</li>
<li><strong>Heterogeneous Treatment Effects (HTE):</strong> The general <em>idea</em> that treatment effects vary across people.</li>
<li><strong>Conditional Average Treatment Effect (CATE) <span class="math inline">\tau(x)</span>:</strong> The <em>average</em> treatment effect for a specific subgroup defined by characteristics <span class="math inline">x</span>.</li>
<li><strong>Estimated Conditional Average Treatment Effect <span class="math inline">\hat{\tau}(X)</span>:</strong> Our <em>estimate</em> (from data) of the average treatment effect for a subgroup with characteristics <span class="math inline">X</span>.</li>
</ul>
</div>
</div>
<section id="if-you-learn-nothing-else-from-this-course" class="level2">
<h2 class="anchored" data-anchor-id="if-you-learn-nothing-else-from-this-course">If you learn nothing else from this course…</h2>
<p>To answer psychological questions properly, we first need to state them very clearly. Causal inference gives us the tools to do this.</p>
</section>
<section id="causal-inference-asks-what-if" class="level2">
<h2 class="anchored" data-anchor-id="causal-inference-asks-what-if">Causal inference asks: “What if?”</h2>
<p>The core idea is to compare what <em>actually happened</em> with what <em>could have happened</em> under different conditions (these “what ifs” are called <strong>counterfactuals</strong>).</p>
<p>Imagine an outcome we care about, like student test scores (<span class="math inline">Y</span>). We might compare the score if <em>everyone</em> got a new teaching method (let’s call this condition <span class="math inline">a^*</span>) versus if <em>everyone</em> got the old method (condition <span class="math inline">a</span>).</p>
<p>The difference in the potential outcome (<span class="math inline">Y</span>) under these two scenarios is the causal effect for one person: <span class="math inline">Y(a^*) - Y(a)</span>.</p>
<p>Since we can’t see both scenarios for the same person, we often look at the average effect across a group. The <strong>Average Treatment Effect (ATE)</strong> is the average difference in potential outcomes across the whole population:</p>
<p><span class="math display">
\text{ATE} = \mathbb{E}[Y(a^*) - Y(a)]
</span></p>
<p>This asks: “On average, how much would scores change if we switched everyone from the old method (<span class="math inline">a</span>) to the new method (<span class="math inline">a^*</span>)?”.</p>
<p>A big challenge is dealing with <strong>confounders</strong> – other factors that mix up the relationship between the treatment (<span class="math inline">A</span>) and the outcome (<span class="math inline">Y</span>), potentially misleading us about the true causal effect. We need to account for these.</p>
</section>
<section id="what-do-interaction-and-effect-modification-mean-in-causal-inference" class="level2">
<h2 class="anchored" data-anchor-id="what-do-interaction-and-effect-modification-mean-in-causal-inference">What do ‘Interaction’ and ‘Effect Modification’ mean in Causal Inference?</h2>
<p>Words like ‘moderation’ and ‘interaction’ are often used loosely. Causal inference needs precise terms.</p>
<p>We’ll focus on two specific ideas:</p>
<ol type="1">
<li><strong>Interaction:</strong> About the effect of <em>combining</em> interventions.</li>
<li><strong>Effect Modification:</strong> About how the effect of <em>one</em> intervention changes for different <em>types of people</em>.</li>
</ol>
</section>
<section id="interaction-the-effect-of-teamwork-or-lack-thereof" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="interaction-the-effect-of-teamwork-or-lack-thereof">Interaction: The Effect of Teamwork (or Lack Thereof)</h2>
<p><strong>Interaction</strong> in causal inference is about <strong>joint interventions</strong>. We look at what happens when we apply <em>two or more different treatments</em> at the same time.</p>
<p>Let’s say we have two treatments, <span class="math inline">A</span> and <span class="math inline">B</span>, and an outcome <span class="math inline">Y</span>.</p>
<ul>
<li><span class="math inline">Y(\tilde{a})</span> is the potential outcome if we set treatment <span class="math inline">A</span> to level <span class="math inline">\tilde{a}</span>.</li>
<li><span class="math inline">Y(\tilde{b})</span> is the potential outcome if we set treatment <span class="math inline">B</span> to level <span class="math inline">\tilde{b}</span>.</li>
<li><span class="math inline">Y(\tilde{a}, \tilde{b})</span> is the potential outcome if we set <span class="math inline">A</span> to <span class="math inline">\tilde{a}</span> <em>and</em> <span class="math inline">B</span> to <span class="math inline">\tilde{b}</span> simultaneously.</li>
</ul>
<p>To figure out these effects from observational data, we usually need assumptions like:</p>
<ul>
<li><p><strong>Consistency:</strong> The outcome we see for someone who got treatment <span class="math inline">\tilde{a}</span> is the same as their potential outcome <span class="math inline">Y(\tilde{a})</span>.</p></li>
<li><p><strong>Conditional Exchangeability (No Unmeasured Confounding):</strong> We can make the groups receiving different treatments comparable by adjusting for measured confounders (<span class="math inline">L</span> for <span class="math inline">A \to Y</span>, and <span class="math inline">Q</span> for <span class="math inline">B \to Y</span>). The sets <span class="math inline">L</span> and <span class="math inline">Q</span> might overlap.</p></li>
<li><p><strong>Positivity</strong>: the exposures to be compared occur in all subgroups.</p></li>
</ul>
<p>To study the <em>interaction</em> between <span class="math inline">A</span> and <span class="math inline">B</span>, we need to be able to estimate the effect of <span class="math inline">A</span> and the effect of <span class="math inline">B</span>, which means we need to adjust for <em>all</em> confounders in <strong>both</strong> <span class="math inline">L</span> and <span class="math inline">Q</span> (i.e., their union <span class="math inline">L \cup Q</span>).</p>
<section id="defining-interaction-does-1-1-2" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="defining-interaction-does-1-1-2">Defining Interaction: Does 1 + 1 = 2?</h3>
<p>Let’s use an education example:</p>
<ul>
<li><span class="math inline">A</span>: New teaching method (1=New, 0=Old)</li>
<li><span class="math inline">B</span>: Extra tutoring (1=Yes, 0=No)</li>
<li><span class="math inline">Y</span>: Test score</li>
</ul>
<p>Is the boost in scores from getting <em>both</em> the new method <em>and</em> tutoring simply the sum of the boost from <em>only</em> the new method and the boost from <em>only</em> tutoring?</p>
<p>We define <strong>causal interaction on the additive scale</strong> (looking at differences) by comparing the effect of the joint intervention to the sum of the individual effects (all compared to getting neither):</p>
<p><span class="math display">
\underbrace{(\mathbb{E}[Y(1,1)] - \mathbb{E}[Y(0,0)])}_{\text{Effect of Both}} \quad \text{vs} \quad \underbrace{(\mathbb{E}[Y(1,0)] - \mathbb{E}[Y(0,0)])}_{\text{Effect of A only}} + \underbrace{(\mathbb{E}[Y(0,1)] - \mathbb{E}[Y(0,0)])}_{\text{Effect of B only}}
</span></p>
<p>Interaction exists if these are not equal. This simplifies to checking if the following is non-zero (see Appendix):</p>
<p><span class="math display">
\underbrace{\mathbb{E}[Y(1,1)]}_{\text{Both}} - \underbrace{\mathbb{E}[Y(1,0)]}_{\text{A only}} - \underbrace{\mathbb{E}[Y(0,1)]}_{\text{B only}} + \underbrace{\mathbb{E}[Y(0,0)]}_{\text{Neither}} \neq 0
</span></p>
<ul>
<li>If this is positive: <strong>Synergy</strong> (the combination is better than expected).</li>
<li>If this is negative: <strong>Antagonism</strong> (the combination is worse than expected).</li>
</ul>
<p><em>(We could also look at interaction on other scales, like ratios, which might give different answers. Always state the scale you’re using – we’ll come back to this in later lectures)</em></p>
<section id="finding-causal-interaction-in-data" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="finding-causal-interaction-in-data">Finding Causal Interaction in Data</h4>
<p>To estimate this interaction, we need valid estimates for all four average potential outcomes:</p>
<p><span class="math display">\mathbb{E}[Y(0,0)], \mathbb{E}[Y(1,0)], \mathbb{E}[Y(0,1)], \mathbb{E}[Y(1,1)]</span></p>
<p>This means we must control for confounders of <em>both</em> the <span class="math inline">A \to Y</span> link and the <span class="math inline">B \to Y</span> link.</p>
<p><a href="#fig-dag-interaction" class="quarto-xref">Figure&nbsp;1</a> shows this. <span class="math inline">L</span> are confounders for <span class="math inline">A \to Y</span>, and <span class="math inline">Q</span> are confounders for <span class="math inline">B \to Y</span>. We need to block the backdoor paths (red arrows).</p>
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div id="fig-dag-interaction" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-dag-interaction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06-content_files/figure-html/fig-dag-interaction-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-dag-interaction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Diagram illustrating causal interaction. Assessing the joint effect of two interventions, A (e.g., teaching method) and B (e.g., tutoring), on outcome Y (e.g., test score). L represents confounders of the A-Y relationship, and Q represents confounders of the B-Y relationship. Red arrows indicate biasing backdoor paths requiring adjustment. Assumes A and B are decided independently here.
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-dag-interaction-solved" class="quarto-xref">Figure&nbsp;2</a> shows we need to condition on (adjust for) <em>both</em> <span class="math inline">L_0</span> and <span class="math inline">Q_0</span>.</p>
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div id="fig-dag-interaction-solved" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-dag-interaction-solved-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06-content_files/figure-html/fig-dag-interaction-solved-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-dag-interaction-solved-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Identification of causal interaction requires adjusting for all confounders of A-Y (L) and B-Y (Q). Boxes around L and Q indicate conditioning, closing backdoor paths.
</figcaption>
</figure>
</div>
</div>
</div>
<p>In our education example:</p>
<ul>
<li><p><strong>L (Confounders for Teaching Method <span class="math inline">\to</span> Score):</strong> Prior achievement, motivation, family background (SES), school quality, teacher differences (if not randomly assigned).</p></li>
<li><p><strong>Q (Confounders for Tutoring <span class="math inline">\to</span> Score):</strong> Prior achievement, motivation, family background (SES - paying for tutoring), student availability, specific learning needs.</p></li>
</ul>
<p>Notice that prior achievement and motivation are in <em>both</em> <span class="math inline">L</span> and <span class="math inline">Q</span>. We need to measure and adjust for <em>all</em> important factors in <span class="math inline">L</span> and <span class="math inline">Q</span> to get a reliable estimate of the interaction.</p>
</section>
</section>
</section>
<section id="effect-modification-different-effects-for-different-people" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="effect-modification-different-effects-for-different-people">Effect Modification: Different Effects for Different People</h2>
<p>Unlike interaction (about combining treatments), <strong>effect modification</strong> is about whether the causal effect of a <em>single</em> intervention (<span class="math inline">A</span>) on an outcome (<span class="math inline">Y</span>) is <em>different</em> for different subgroups in the population. These subgroups are defined by baseline characteristics (like age, sex, prior history - let’s call these <span class="math inline">G</span> or <span class="math inline">X</span>).</p>
<p>Effect modification helps us understand <em>who</em> benefits most (or least) from an intervention. We explore this using ideas like Heterogeneous Treatment Effects (HTE) and Conditional Average Treatment Effects (CATE).</p>
<section id="heterogeneous-treatment-effects-hte-the-idea-of-variation" class="level3">
<h3 class="anchored" data-anchor-id="heterogeneous-treatment-effects-hte-the-idea-of-variation">Heterogeneous Treatment Effects (HTE): The Idea of Variation</h3>
<p><strong>Heterogeneous Treatment Effects (HTE)</strong> just means that the effect of a treatment (<span class="math inline">A</span> on <span class="math inline">Y</span>) isn’t the same for everyone. The effect <em>varies</em>. This variation <em>is</em> effect modification.</p>
<p>Why does it vary?</p>
<ul>
<li>Differences in things we can measure (like age, sex, baseline health - our <span class="math inline">X</span> variables).</li>
<li>Differences in things we can’t easily measure (like genetics, unmeasured background factors).</li>
</ul>
<p>HTE is the reality; treatments rarely work identically for all.</p>
</section>
<section id="conditional-average-treatment-effect-cate-measuring-variation-with-data-taux" class="level3">
<h3 class="anchored" data-anchor-id="conditional-average-treatment-effect-cate-measuring-variation-with-data-taux">Conditional Average Treatment Effect (CATE): Measuring Variation with Data <span class="math inline">\tau(x)</span></h3>
<p>To study HTE using data, we focus on the</p>
<p><strong>Conditional Average Treatment Effect (CATE)</strong>. CATE is a specific <em>causal question (estimand)</em>: What is the average treatment effect <em>for the subgroup of people who share specific measured characteristics</em> <span class="math inline">X=x</span>?</p>
<p><span class="math display">
\tau(x) = \text{CATE}(x) = \mathbb{E}[Y(1) - Y(0) | X = x]
</span></p>
<p>Here, <span class="math inline">Y(1)</span> is the potential outcome with treatment, <span class="math inline">Y(0)</span> without. <span class="math inline">\tau(x)</span> tells us the average effect specifically for people with characteristics <span class="math inline">X=x</span>. By looking at how <span class="math inline">\tau(x)</span> changes for different <span class="math inline">x</span>, we quantify effect modification <em>by the characteristics we measured in X</em>.</p>
</section>
<section id="comparing-effects-across-defined-groups" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="comparing-effects-across-defined-groups">Comparing Effects Across Defined Groups</h3>
<p>A simple way to check for effect modification by a category <span class="math inline">G</span> (like comparing males vs females, or different locations) is to estimate the Average Treatment Effect (ATE) <em>separately within each group</em>. This is like comparing CATEs where <span class="math inline">X</span> is just the group variable <span class="math inline">G</span>.</p>
<p>Let’s say <span class="math inline">A</span> is the treatment (0=control, 1=treated) and <span class="math inline">G</span> is the potential modifier (e.g., <span class="math inline">g=</span>female, <span class="math inline">g'=</span>male).</p>
<p>We compare:</p>
<ol type="1">
<li><p>The average effect for females (<span class="math inline">G=g_1</span>): <span class="math inline">\delta_{g_1} = \mathbb{E}[Y(1) | G=g_1] - \mathbb{E}[Y(0) | G=g_1]</span></p></li>
<li><p>The average effect for males (<span class="math inline">G=g_2</span>): <span class="math inline">\delta_{g_2} = \mathbb{E}[Y(1) | G=g_2] - \mathbb{E}[Y(0) | G=g_2]</span></p></li>
</ol>
<p>Effect modification by <span class="math inline">G</span> exists if these are different: <span class="math inline">\gamma = \delta_{g_1} - \delta_{g_2} \neq 0</span>.</p>
<p>If our estimate <span class="math inline">\hat{\gamma}</span> is far from zero, it suggests the treatment effect differs between males and females.</p>
<section id="finding-effect-modification-in-data" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="finding-effect-modification-in-data">Finding Effect Modification in Data</h4>
<p>To estimate these group-specific effects (<span class="math inline">\delta_g</span>) and their difference (<span class="math inline">\gamma</span>) correctly, we need to control for confounders (<span class="math inline">L</span>) of the <span class="math inline">A \to Y</span> relationship <em>within each group</em> defined by <span class="math inline">G</span>.</p>
<p>Note: we don’t necessarily need to control for things that cause <span class="math inline">G</span> itself, <em>unless</em> they also confound the <span class="math inline">A \to Y</span> relationship (i.e., are also in <span class="math inline">L</span>).</p>
<p>Look at <a href="#fig-dag-effect-modification" class="quarto-xref">Figure&nbsp;3</a>. To estimate the <span class="math inline">A \to Y</span> effect within levels of <span class="math inline">G</span>, we need to adjust for the confounders <span class="math inline">L_0</span>. But this will partially block the effect-modification of G on Y. Moreover, if we were identifying the causal effect of G on Y, after conditioning on L, we would find that a backdoor path opends from G to Y because L is a collider. We cannot interpret any coefficient for G in a regression model where L is in the model.</p>
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div id="fig-dag-effect-modification" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-dag-effect-modification-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06-content_files/figure-html/fig-dag-effect-modification-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-dag-effect-modification-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: How shall we investigate effect modification of A on Y by G? Can you see the problem?
</figcaption>
</figure>
</div>
</div>
</div>
<p>Thus it is essential to understand that when we control for confounding along the the <span class="math inline">A \to Y</span> path, we do not identify the causal effects of effect-modifiers. Rather, we should consider effect-modifiers <em>prognostic</em> indicators. Moreover, we’re going to need to develop methods for clarifying prognostic indicators in multi-dimensional settings where</p>
</section>
</section>
</section>
<section id="estimating-how-effects-vary-getting-hattaux-from-data" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="estimating-how-effects-vary-getting-hattaux-from-data">Estimating How Effects Vary: Getting <span class="math inline">\hat{\tau}(x)</span> from Data</h2>
<p>We defined the Conditional Average Treatment Effect (CATE), <span class="math inline">\tau(x)</span>, as the <em>true</em> average effect for a subgroup with specific features <span class="math inline">X=x</span>:</p>
<p><span class="math display">
\tau(x) = \mathbb{E}[Y(1) - Y(0) | X = x]
</span></p>
<p>Now, we want to <em>estimate</em> this from our actual data. We call our estimate <span class="math inline">\hat{\tau}(x)</span>. For any person <span class="math inline">i</span> in our study with features <span class="math inline">X_i</span>, the value <span class="math inline">\hat{\tau}(X_i)</span> is our data-based <em>prediction</em> of the average treatment effect <em>for people like person i</em>.</p>
<section id="personalised-effects-vs.-true-individual-effects" class="level3">
<h3 class="anchored" data-anchor-id="personalised-effects-vs.-true-individual-effects">“Personalised” Effects vs.&nbsp;True Individual Effects</h3>
<p>Wait - didn’t we say we <em>can’t</em> know the true effect for one specific person, <span class="math inline">Y_i(1) - Y_i(0)</span>? Yes, that’s still true.</p>
<p>So what does <span class="math inline">\hat{\tau}(X_i)</span> mean?</p>
<ul>
<li><p><strong>Individual Causal Effect (Unknowable):</strong> <span class="math inline">Y_i(1) - Y_i(0)</span>. This is the true effect for person <span class="math inline">i</span>. We can’t observe both <span class="math inline">Y_i(1)</span> and <span class="math inline">Y_i(0)</span>.</p></li>
<li><p><strong>Estimated CATE (<span class="math inline">\hat{\tau}(X_i)</span>) (What we calculate):</strong> This is our estimate of the <em>average</em> effect, <span class="math inline">\mathbb{E}[Y(1) - Y(0)]</span>, for the <em>subgroup</em> of people who share the same measured characteristics <span class="math inline">X_i</span> as person <span class="math inline">i</span>.</p></li>
</ul>
<p>When people talk about “personalised” or “individualised” treatment effects in this context, they usually mean <span class="math inline">\hat{\tau}(x)</span>. It’s “personalised” because the prediction uses person <span class="math inline">i</span>’s specific characteristics <span class="math inline">X_i = x</span>. But remember, it’s an <strong>estimated average effect for a group</strong>, not the unique effect for that single individual.</p>
</section>
<section id="people-have-many-characteristics" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="people-have-many-characteristics">People Have Many Characteristics</h3>
<p>People aren’t just in one group; they have many features at once. A student might be:</p>
<ul>
<li>Female</li>
<li>21 years old</li>
<li>From a low-income family</li>
<li>Did well on previous tests</li>
<li>Goes to a rural school</li>
<li>Highly motivated</li>
</ul>
<p>All these factors (<span class="math inline">X_i</span>) together might influence how they respond to a new teaching method.</p>
<p>Trying to figure this out with traditional regression by manually adding interaction terms (like <code>A*gender*age*income*...</code>) becomes impossible very quickly:</p>
<ul>
<li>Too many combinations, not enough data in each specific combo.</li>
<li>High risk of finding “effects” just by chance (false positives).</li>
<li>Hard to know which interactions to even include.</li>
<li>Can’t easily discover unexpected patterns.</li>
</ul>
<p>Thus, while simple linear regression with interaction terms (<code>lm(Y ~ A * X1 + A * X2)</code>) can estimate CATEs if the model is simple and correct, it often fails when things get complex (many <span class="math inline">X</span> variables, non-linear effects).</p>
<p><strong>Causal forests</strong> (using the <code>grf</code> package in R) <span class="citation" data-cites="grf2024">(<a href="#ref-grf2024" role="doc-biblioref">Tibshirani et al. 2024</a>)</span> are a powerful, flexible alternative designed for this task. They build decision trees that specifically aim to find groups with different treatment effects.</p>
<div class="no-row-height column-margin column-container"><div id="ref-grf2024" class="csl-entry" role="listitem">
Tibshirani, Julie, Susan Athey, Erik Sverdrup, and Stefan Wager. 2024. <em>Grf: Generalized Random Forests</em>. <a href="https://github.com/grf-labs/grf">https://github.com/grf-labs/grf</a>.
</div></div><p>We’ll learn how to use <code>grf</code> after the mid-term break. It will allow us to get the <span class="math inline">\hat{\tau}(x)</span> predictions and then think about how to use them, for instance, to prioritise who gets a treatment if resources are limited.</p>
<!-- This is where modern methods like **causal forests** come in, which we'll come back to after the mid-term break. -->
<!-- ### Causal Forests: A Modern Tool for Estimating $\hat{\tau}(X)$ -->
<!-- Causal forests (implemented in the R package `grf`) are designed for this complex situation. They are like random forests but built specifically to find differences in *treatment effects*. -->
<!-- How they help: -->
<!-- 1.  **Look at all features ($X$) at once:** They automatically search across all measured characteristics to see which ones explain differences in the treatment effect. -->
<!-- 2.  **Flexible:** They don't assume simple linear relationships and can find complex patterns. -->
<!-- 3.  **Local Averaging:** The estimate $\hat{\tau}(X_i)$ for person $i$ is based on the outcomes of other people in the data who are "similar" to person $i$ based on their characteristics $X$. -->
<!-- 4.  **"Honest" Estimates:** They use clever statistical techniques (like splitting the data) to try and give reliable estimates and confidence intervals, reducing the risk of overfitting. -->
<!-- The result is a prediction $\hat{\tau}(X_i)$ for each person $i$, based on their unique combination of measured features $X_i$. This gets us closer to understanding effect heterogeneity in a realistic way. -->
<!-- ### Why Estimate CATEs ($\hat{\tau}(X)$)? -->
<!-- Estimating $\hat{\tau}(X)$ is how we investigate HTE using our measured data $X$. We look at how $\hat{\tau}(X)$ changes across different types of people (different $X$ values) to: -->
<!-- 1.  **See if the effect varies:** Go beyond the overall average (ATE) and see *if* and *how* the effect differs. -->
<!-- 2.  **Find subgroups:** Identify groups (defined by $X$) who might benefit much more (or less, or even be harmed) by the intervention. -->
<!-- 3.  **Inform targeted policies:** Use the predictions $\hat{\tau}(X_i)$ to investigate if giving the treatment only to those predicted to benefit most would lead to better outcomes overall (we'll evaluate this later using tools like RATE curves -- again this is all coming after the mid-term break). -->
</section>
<section id="summary" class="level3">
<h3 class="anchored" data-anchor-id="summary">Summary</h3>
<p>Let’s revisit the centeral ideas:</p>
<section id="interaction" class="level4">
<h4 class="anchored" data-anchor-id="interaction"><strong>Interaction:</strong></h4>
<ul>
<li><strong>Think:</strong> Teamwork effect.</li>
<li><strong>What:</strong> Effect of <em>two or more different interventions</em> (<span class="math inline">A</span> and <span class="math inline">B</span>) applied together.</li>
<li><strong>Question:</strong> Is the joint effect <span class="math inline">\mathbb{E}[Y(a,b)]</span> different from the sum of individual effects?</li>
<li><strong>Needs:</strong> Control confounders for <em>all</em> interventions involved (<span class="math inline">L \cup Q</span>).</li>
</ul>
</section>
<section id="effect-modification-hte-cate" class="level4">
<h4 class="anchored" data-anchor-id="effect-modification-hte-cate"><strong>Effect Modification / HTE / CATE:</strong></h4>
<ul>
<li><strong>Think:</strong> Different effects for different groups.</li>
<li><strong>What:</strong> Effect of a <em>single intervention</em> (<span class="math inline">A</span>) varies depending on people’s <em>baseline characteristics</em> (<span class="math inline">G</span> or <span class="math inline">X</span>).</li>
<li><strong>Question (HTE):</strong> <em>Does</em> the effect vary? (The phenomenon).</li>
<li><strong>Question (CATE <span class="math inline">\tau(x)</span>):</strong> <em>What is</em> the average effect for a specific subgroup with features <span class="math inline">X=x</span>? (The measure).</li>
<li><strong>Needs:</strong> Control confounders for the <em>single</em> intervention (<span class="math inline">L</span>) within subgroups.</li>
</ul>
</section>
<section id="estimated-individualised-treatment-effects-hattaux" class="level4">
<h4 class="anchored" data-anchor-id="estimated-individualised-treatment-effects-hattaux"><strong>Estimated “Individualised” Treatment Effects (<span class="math inline">\hat{\tau}(x)</span>):</strong></h4>
<ul>
<li><strong>Think:</strong> Personal profile prediction.</li>
<li><strong>What:</strong> Our <em>estimate</em> of the average treatment effect for the subgroup of people sharing characteristics <span class="math inline">X_i</span>.</li>
<li><strong>How:</strong> Calculated using models (like causal forests) that use the person’s full profile <span class="math inline">X_i</span>.</li>
<li><strong>Important:</strong> This is <strong>not</strong> the true effect for that single person (which is unknowable). It’s an average for <em>people like them</em>.</li>
<li><strong>Use:</strong> Explore HTE, identify subgroups, potentially inform targeted treatment strategies.</li>
</ul>
<p>Keeping these concepts distinct helps us ask clear research questions and choose the right methods.</p>
</section>
</section>
</section>
<section id="course-review-so-far-a-quick-recap" class="level2">
<h2 class="anchored" data-anchor-id="course-review-so-far-a-quick-recap">Course Review So Far: A Quick Recap</h2>
<p>Let’s quickly review the main ideas of causal inference we’ve covered.</p>
<section id="the-big-question-does-a-cause-y" class="level3">
<h3 class="anchored" data-anchor-id="the-big-question-does-a-cause-y">The Big Question: Does A cause Y?</h3>
<p>Causal inference helps us answer if something (like a teaching method, <span class="math inline">A</span>) causes a change in something else (like test scores, <span class="math inline">Y</span>).</p>
</section>
<section id="core-idea-what-if-counterfactuals" class="level3">
<h3 class="anchored" data-anchor-id="core-idea-what-if-counterfactuals">Core Idea: “What If?” (Counterfactuals)</h3>
<p>We compare what actually happened to what <em>would have happened</em> in a different scenario.</p>
<ul>
<li><span class="math inline">Y(1)</span>: Score if the student <em>had</em> received the new method.</li>
<li><span class="math inline">Y(0)</span>: Score if the student <em>had</em> received the old method.</li>
</ul>
<p>The <strong>Average Treatment Effect (ATE)</strong> = <span class="math inline">\mathbb{E}[Y(1) - Y(0)]</span> is the average difference across the whole group.</p>
</section>
<section id="this-lecture-clarified-concepts-of-interaction-vs.-effect-modification-vs.-individual-predictions" class="level3">
<h3 class="anchored" data-anchor-id="this-lecture-clarified-concepts-of-interaction-vs.-effect-modification-vs.-individual-predictions">This Lecture Clarified Concepts of Interaction vs.&nbsp;Effect Modification vs.&nbsp;Individual Predictions</h3>
<section id="interaction-think-teamwork-effects" class="level4">
<h4 class="anchored" data-anchor-id="interaction-think-teamwork-effects">Interaction (Think: Teamwork Effects)</h4>
<ul>
<li><strong>About:</strong> Combining <em>two different interventions</em> (A and B).</li>
<li><strong>Question:</strong> Does using both A and B together give a result different from just adding up their separate effects? (e.g., new teaching method + tutoring).</li>
<li><strong>Needs:</strong> Analyse effects of A alone, B alone, and A+B together. Control confounders for <em>both</em> A and B.</li>
</ul>
</section>
<section id="effect-modification-think-different-effects-for-different-groups" class="level4">
<h4 class="anchored" data-anchor-id="effect-modification-think-different-effects-for-different-groups">Effect Modification (Think: Different Effects for Different Groups)</h4>
<ul>
<li><strong>About:</strong> How the effect of <em>one intervention</em> (A) changes based on people’s <em>characteristics</em> (X, like prior grades).</li>
<li><strong>Question:</strong> Does the teaching method (A) work better for high-achieving students (X=high) than low-achieving students (X=low)?
<ul>
<li><strong>HTE:</strong> The <em>idea</em> that effects differ.</li>
<li><strong>CATE <span class="math inline">\tau(x)</span>:</strong> The <em>average effect</em> for the specific group with characteristics <span class="math inline">X=x</span>.</li>
</ul></li>
<li><strong>Needs:</strong> Analyse effect of A <em>within</em> different groups (levels of X). Control confounders for A.</li>
</ul>
</section>
<section id="estimated-individualised-effects-hattaux_i-think-personal-profile-prediction" class="level4">
<h4 class="anchored" data-anchor-id="estimated-individualised-effects-hattaux_i-think-personal-profile-prediction">Estimated Individualised Effects (<span class="math inline">\hat{\tau}(X_i)</span>) (Think: Personal Profile Prediction)</h4>
<ul>
<li><strong>About:</strong> Using a person’s <em>whole profile</em> of characteristics (<span class="math inline">X_i</span> - age, gender, background, etc.) to predict their likely response to treatment A.</li>
<li><strong>How:</strong> Modern methods (like causal forests) take all of <span class="math inline">X_i</span> and estimate <span class="math inline">\hat{\tau}(X_i)</span>.</li>
<li><strong>Result:</strong> this <span class="math inline">\hat{\tau}(X_i)</span> is <strong>not</strong> the true unknowable effect for person <span class="math inline">i</span>. It is the estimated <em>average effect for people similar to person i</em> (sharing characteristics <span class="math inline">X_i</span>).</li>
<li><strong>Use:</strong> helps explore if tailoring treatment based on these profiles (<span class="math inline">X_i</span>) could be beneficial.</li>
</ul>
</section>
</section>
<section id="simple-summary" class="level3">
<h3 class="anchored" data-anchor-id="simple-summary">Simple Summary:</h3>
<ul>
<li><strong>Interaction:</strong> Do A and B work together well/badly?</li>
<li><strong>Effect Modification:</strong> Does A’s effect depend on <em>who</em> you are (based on X)?</li>
<li><strong><span class="math inline">\hat{\tau}(X_i)</span>:</strong> Can we <em>predict</em> A’s average effect for someone based on their specific profile <span class="math inline">X_i</span>?</li>
</ul>
<p>Understanding these differences is key to doing good causal research!</p>
</section>
</section>
<section id="lab-part-1-setting-up-your-data" class="level2">
<h2 class="anchored" data-anchor-id="lab-part-1-setting-up-your-data">Lab Part 1: Setting up your data</h2>
<section id="set-up-your-libraries" class="level3">
<h3 class="anchored" data-anchor-id="set-up-your-libraries">Set up your libraries</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"margot"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"here"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"skimr"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(gtsummary)) <span class="fu">install.packages</span>(<span class="st">"gtsummary"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(janitor)) <span class="fu">install.packages</span>(<span class="st">"janitor"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># if you need to update the margot package, uncomment and do this</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github("go-bayes/margot")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="set-up-a-path-to-a-folder-in-your-directory" class="level3">
<h3 class="anchored" data-anchor-id="set-up-a-path-to-a-folder-in-your-directory">Set up a path to a folder in your directory</h3>
<p>This will allow you to save the outputs of models and other information, which will be handy when you are producing your manuscript. Call this <code>push_mods</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Set up a path to a folder in your directory </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create a folder called saved and make a path like this</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>push_mods <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'/Users/joseph/v-project\ Dropbox/data/courses/25-psych-434'</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># view it (will be different for you)</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>push_mods</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "/Users/joseph/v-project Dropbox/data/courses/25-psych-434"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># another option</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(object, here::here(push_mods, "object"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="initial-data-wrangling-to-select-the-study-sample" class="level3">
<h3 class="anchored" data-anchor-id="initial-data-wrangling-to-select-the-study-sample">Initial Data Wrangling to select the study sample</h3>
<section id="where-to-find-variable-names-information" class="level4">
<h4 class="anchored" data-anchor-id="where-to-find-variable-names-information">Where to find variable names information</h4>
<p>Find it the data directory here: <a href="https://osf.io/75snb/" class="uri">https://osf.io/75snb/</a></p>
<p>Also see here: <a href="https://github.com/go-bayes/templates/tree/main/method" class="uri">https://github.com/go-bayes/templates/tree/main/method</a></p>
</section>
<section id="think-what-are-my-eligibility-criteria" class="level4">
<h4 class="anchored" data-anchor-id="think-what-are-my-eligibility-criteria">Think, what are my eligibility criteria?</h4>
<ul>
<li>Participated in at baseline</li>
<li>Participated at treatment wave</li>
<li>May have been lost to follow up at the end of the study</li>
<li>Full information on the treatment variable (think about this…)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(margot)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(table1)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># eliminate haven labels</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>df_nz <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(df_nz)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>df_nz <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">zap_formats</span>(df_nz)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>df_nz <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">zap_label</span>(df_nz)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>df_nz <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">zap_widths</span>(df_nz)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># name output folder</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>push_mods <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"outputs"</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># set exposure name</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>name_exposure <span class="ot">&lt;-</span>  <span class="st">"perfectionism"</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain ids for individuals who participated in 2018 and have no missing baseline exposure</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>ids_2018 <span class="ot">&lt;-</span> df_nz <span class="sc">%&gt;%</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">filter</span>(year_measured <span class="sc">==</span> <span class="dv">1</span>, wave <span class="sc">==</span> <span class="dv">2018</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span><span class="fu">sym</span>(name_exposure))) <span class="sc">|&gt;</span> <span class="co"># criteria, no missing</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(id)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain ids for individuals who participated in 2019</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>ids_2019 <span class="ot">&lt;-</span> df_nz <span class="sc">%&gt;%</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">filter</span>(year_measured <span class="sc">==</span> <span class="dv">1</span>, wave <span class="sc">==</span> <span class="dv">2019</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span><span class="fu">sym</span>(name_exposure))) <span class="sc">|&gt;</span> <span class="co"># criteria, no missing</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(id)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="co"># intersect IDs from 2018 and 2019 to ensure participation in both years</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>ids_2018_2019 <span class="ot">&lt;-</span> <span class="fu">intersect</span>(ids_2018, ids_2019)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="co"># data wrangling</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>dat_long <span class="ot">&lt;-</span> df_nz <span class="sc">|&gt;</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(id <span class="sc">%in%</span> ids_2018_2019 <span class="sc">&amp;</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>                  wave <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2018</span>, <span class="dv">2019</span>, <span class="dv">2020</span>)) <span class="sc">|&gt;</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(id, wave) <span class="sc">|&gt;</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"id"</span>,</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"wave"</span>,</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"year_measured"</span>,</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"age"</span>,</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"male"</span>,</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">"born_nz"</span>,</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">"eth_cat"</span>,</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">#factor(EthCat, labels = c("Euro", "Maori", "Pacific", "Asian")),</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">"employed"</span>,</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Are you currently employed? (this includes self-employment or casual work)</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">"edu"</span>,</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># "gen_cohort",</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">"household_inc"</span>,</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">"partner"</span>,</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 0 = no, 1 = yes</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">"parent"</span>,</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>    <span class="st">"alert_level_combined_lead"</span>, <span class="co"># see bibliography</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 0 = no, 1 = yes</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>    <span class="st">"political_conservative"</span>, <span class="co"># see nzavs sheet</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    <span class="st">"hours_exercise"</span>, <span class="co"># see nzavs sheet</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    <span class="st">"agreeableness"</span>, </span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mini-IPIP6 Agreeableness (also modelled as empathy facet)</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sympathize with others' feelings.</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Am not interested in other people's problems.</span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Feel others' emotions.</span></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Am not really interested in others.</span></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>    <span class="st">"conscientiousness"</span>,</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># see mini ipip6</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get chores done right away.</span></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Like order.</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make a mess of things.</span></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Often forget to put things back in their proper place.</span></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>    <span class="st">"extraversion"</span>,</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mini-IPIP6 Extraversion</span></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Am the life of the party.</span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Don't talk a lot.</span></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep in the background.</span></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Talk to a lot of different people at parties.</span></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>    <span class="st">"honesty_humility"</span>,</span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># see mini ipip6</span></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Would like to be seen driving around in a very expensive car.</span></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Would get a lot of pleasure from owning expensive luxury goods.</span></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Feel entitled to more of everything.</span></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Deserve more things in life.</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>    <span class="st">"openness"</span>,</span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>    <span class="co"># see mini ipip6</span></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Have a vivid imagination.</span></span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Have difficulty understanding abstract ideas.</span></span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Do not have a good imagination.</span></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Am not interested in abstract ideas.</span></span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>    <span class="st">"neuroticism"</span>,</span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># see mini ipip6</span></span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Have frequent mood swings.</span></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Am relaxed most of the time.</span></span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get upset easily.</span></span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Seldom feel blue.</span></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>    <span class="st">"modesty"</span>,</span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # see mini ipip6</span></span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # I want people to know that I am an important person of high status,</span></span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # I am an ordinary person who is no better than others.</span></span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # I wouldn’t want people to treat me as though I were superior to them.</span></span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # I think that I am entitled to more respect than the average person is</span></span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>    <span class="co">#"w_gend_age_ethnic",</span></span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sample_weights"</span>, <span class="co"># see nzavs sheet</span></span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>    <span class="st">"neighbourhood_community"</span>,</span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># #I feel a sense of community with others in my local neighbourhood.</span></span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>    <span class="st">"belong"</span>, <span class="co"># see nzavs sheet</span></span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rural_gch_2018_l"</span>,<span class="co"># see nzavs sheet</span></span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>    <span class="st">"support"</span>,</span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a>    <span class="co"># "support_help",</span></span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # 'There are people I can depend on to help me if I really need it.</span></span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># "support_turnto",</span></span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # There is no one I can turn to for guidance in times of stress.</span></span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a>    <span class="co"># "support_rnoguidance",</span></span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a>    <span class="co">#There is no one I can turn to for guidance in times of stress.</span></span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a>    <span class="st">"perfectionism"</span>,</span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a>    <span class="st">"religion_religious"</span>,</span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a>    <span class="st">"kessler_latent_depression"</span>,</span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a>    <span class="st">"kessler_latent_anxiety"</span></span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a>    <span class="co">#initialize 'censored'</span></span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a>    <span class="at">censored =</span> <span class="fu">ifelse</span>(<span class="fu">lead</span>(year_measured) <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a>    <span class="co"># modify 'censored' based on the condition; no need to check for NA here as 'censored' is already defined in the previous step</span></span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">censored =</span>  <span class="fu">ifelse</span>(<span class="fu">is.na</span>(censored) <span class="sc">&amp;</span></span>
<span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a>                         year_measured <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, censored)</span>
<span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>year_measured) <span class="sc">|&gt;</span></span>
<span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rescale these variables, to get all variables on a similar scale</span></span>
<span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a>    <span class="co"># otherwise your models can blow up, or become uninterpretable. </span></span>
<span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a>    <span class="at">household_inc_log =</span> <span class="fu">log</span>(household_inc <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a>    <span class="at">hours_exercise_log =</span> <span class="fu">log</span>(hours_exercise <span class="sc">+</span> <span class="dv">1</span>)  ) <span class="sc">|&gt;</span></span>
<span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="fu">c</span>(</span>
<span id="cb5-135"><a href="#cb5-135" aria-hidden="true" tabindex="-1"></a>      household_inc,</span>
<span id="cb5-136"><a href="#cb5-136" aria-hidden="true" tabindex="-1"></a>      hours_exercise)</span>
<span id="cb5-137"><a href="#cb5-137" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-138"><a href="#cb5-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dplyr::rename(sample_weights = w_gend_age_ethnic,</span></span>
<span id="cb5-140"><a href="#cb5-140" aria-hidden="true" tabindex="-1"></a>  <span class="co">#               sample_origin =  sample_origin_names_combined) |&gt;</span></span>
<span id="cb5-141"><a href="#cb5-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(id, wave) <span class="sc">|&gt;</span></span>
<span id="cb5-142"><a href="#cb5-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-143"><a href="#cb5-143" aria-hidden="true" tabindex="-1"></a>  <span class="at">rural_gch_2018_l =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(rural_gch_2018_l)),</span>
<span id="cb5-144"><a href="#cb5-144" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   parent = as.numeric(as.character(parent)),</span></span>
<span id="cb5-145"><a href="#cb5-145" aria-hidden="true" tabindex="-1"></a>  <span class="at">partner =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(partner)),</span>
<span id="cb5-146"><a href="#cb5-146" aria-hidden="true" tabindex="-1"></a>  <span class="at">born_nz =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(born_nz)),</span>
<span id="cb5-147"><a href="#cb5-147" aria-hidden="true" tabindex="-1"></a>  <span class="at">censored =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(censored)),</span>
<span id="cb5-148"><a href="#cb5-148" aria-hidden="true" tabindex="-1"></a>  <span class="at">employed =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(employed))</span>
<span id="cb5-149"><a href="#cb5-149" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-150"><a href="#cb5-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-151"><a href="#cb5-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-152"><a href="#cb5-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-153"><a href="#cb5-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(id, wave) <span class="sc">|&gt;</span></span>
<span id="cb5-154"><a href="#cb5-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>()</span>
<span id="cb5-155"><a href="#cb5-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-156"><a href="#cb5-156" aria-hidden="true" tabindex="-1"></a><span class="co"># check n in this sample</span></span>
<span id="cb5-157"><a href="#cb5-157" aria-hidden="true" tabindex="-1"></a>n_participants <span class="ot">&lt;-</span> skimr<span class="sc">::</span><span class="fu">n_unique</span>(dat_long<span class="sc">$</span>id)</span>
<span id="cb5-158"><a href="#cb5-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-159"><a href="#cb5-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-160"><a href="#cb5-160" aria-hidden="true" tabindex="-1"></a><span class="co"># make number pretty</span></span>
<span id="cb5-161"><a href="#cb5-161" aria-hidden="true" tabindex="-1"></a>n_participants<span class="ot">&lt;-</span> <span class="fu">prettyNum</span>(n_participants,<span class="at">big.mark=</span><span class="st">","</span>)</span>
<span id="cb5-162"><a href="#cb5-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-163"><a href="#cb5-163" aria-hidden="true" tabindex="-1"></a><span class="co"># save this so that you can use it in your manuscript</span></span>
<span id="cb5-164"><a href="#cb5-164" aria-hidden="true" tabindex="-1"></a>margot<span class="sc">::</span><span class="fu">here_save</span>(n_participants, <span class="st">"n_participants"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Object saved to: /Users/joseph/GIT/psych-434-2025/outputs/n_participants.rds
Object size: 0.00 MB
👍 Save operation completed successfully!</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># try reading </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>n_participants_did_it_work_question_mark <span class="ot">&lt;-</span> margot<span class="sc">::</span><span class="fu">here_read</span>(<span class="st">"n_participants"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Object read from: /Users/joseph/GIT/psych-434-2025/outputs/n_participants.rds
Object size: 0.00 MB
👍 Read operation completed successfully!</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># view</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># n_participants_did_it_work_question_mark</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are N = 14,439 participants.</p>
</section>
</section>
<section id="define-your-baseline-covariates-treatment-exposure-and-outcome" class="level3">
<h3 class="anchored" data-anchor-id="define-your-baseline-covariates-treatment-exposure-and-outcome">Define your baseline covariates, treatment (exposure), and outcome</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for example </span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>baseline_vars <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"male"</span>, <span class="st">"edu"</span>, <span class="st">"eth_cat"</span>, <span class="st">"partner"</span>, <span class="st">"employed"</span>, <span class="st">"born_nz"</span>, <span class="st">"neighbourhood_community"</span>, <span class="st">"household_inc_log"</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="st">"parent"</span>, <span class="st">"religion_religious"</span>, <span class="st">"rural_gch_2018_l"</span>,<span class="st">"sample_weights"</span>, <span class="st">"employed"</span>, <span class="st">"alert_level_combined_lead"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>exposure_var <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"perfectionism"</span>, <span class="st">"censored"</span>) <span class="co"># we will use the censored variable later</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># outcome, can be many</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>outcome_vars <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"kessler_latent_anxiety"</span>, <span class="st">"kessler_latent_depression"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># define waves</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>baseline_wave <span class="ot">=</span> <span class="st">"2018"</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co"># exposure waves</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>exposure_waves <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"2018"</span>,<span class="st">"2019"</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co">#outcome wave</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>outcome_wave <span class="ot">=</span> <span class="st">"2020"</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co"># exoposure</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>name_exposure <span class="ot">=</span> <span class="st">"perfectionism"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="make-your-baseline-table" class="level3">
<h3 class="anchored" data-anchor-id="make-your-baseline-table">Make your baseline table</h3>
</section>
<section id="make-tables" class="level3">
<h3 class="anchored" data-anchor-id="make-tables">Make tables</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>tables <span class="ot">&lt;-</span> margot<span class="sc">::</span><span class="fu">margot_summary_tables</span>(dat_long, </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="at">exposure_waves =</span> exposure_waves, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="at">baseline_wave =</span> baseline_wave, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="at">outcome_wave =</span> outcome_wave, </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="at">name_exposure =</span> name_exposure, </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="at">baseline_vars =</span> baseline_vars, </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="at">outcome_vars =</span> outcome_vars)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># save tables</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># margot::here_save_qs(table_exposures, "table_exposures", push_mods)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="baseline-table" class="level2">
<h2 class="anchored" data-anchor-id="baseline-table">Baseline table</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>tables<span class="sc">$</span>baseline_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="mxdxjnibwa" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#mxdxjnibwa table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#mxdxjnibwa thead, #mxdxjnibwa tbody, #mxdxjnibwa tfoot, #mxdxjnibwa tr, #mxdxjnibwa td, #mxdxjnibwa th {
  border-style: none;
}

#mxdxjnibwa p {
  margin: 0;
  padding: 0;
}

#mxdxjnibwa .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mxdxjnibwa .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#mxdxjnibwa .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mxdxjnibwa .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mxdxjnibwa .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mxdxjnibwa .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mxdxjnibwa .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mxdxjnibwa .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mxdxjnibwa .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mxdxjnibwa .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mxdxjnibwa .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mxdxjnibwa .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mxdxjnibwa .gt_spanner_row {
  border-bottom-style: hidden;
}

#mxdxjnibwa .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#mxdxjnibwa .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mxdxjnibwa .gt_from_md > :first-child {
  margin-top: 0;
}

#mxdxjnibwa .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mxdxjnibwa .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mxdxjnibwa .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#mxdxjnibwa .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#mxdxjnibwa .gt_row_group_first td {
  border-top-width: 2px;
}

#mxdxjnibwa .gt_row_group_first th {
  border-top-width: 2px;
}

#mxdxjnibwa .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mxdxjnibwa .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#mxdxjnibwa .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#mxdxjnibwa .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mxdxjnibwa .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mxdxjnibwa .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mxdxjnibwa .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#mxdxjnibwa .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mxdxjnibwa .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mxdxjnibwa .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mxdxjnibwa .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mxdxjnibwa .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mxdxjnibwa .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mxdxjnibwa .gt_left {
  text-align: left;
}

#mxdxjnibwa .gt_center {
  text-align: center;
}

#mxdxjnibwa .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mxdxjnibwa .gt_font_normal {
  font-weight: normal;
}

#mxdxjnibwa .gt_font_bold {
  font-weight: bold;
}

#mxdxjnibwa .gt_font_italic {
  font-style: italic;
}

#mxdxjnibwa .gt_super {
  font-size: 65%;
}

#mxdxjnibwa .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#mxdxjnibwa .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#mxdxjnibwa .gt_indent_1 {
  text-indent: 5px;
}

#mxdxjnibwa .gt_indent_2 {
  text-indent: 10px;
}

#mxdxjnibwa .gt_indent_3 {
  text-indent: 15px;
}

#mxdxjnibwa .gt_indent_4 {
  text-indent: 20px;
}

#mxdxjnibwa .gt_indent_5 {
  text-indent: 25px;
}

#mxdxjnibwa .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#mxdxjnibwa div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="gt_col_headings header">
<th id="label" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Exposure + Demographic Variables</strong></th>
<th id="stat_0" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>N = 14,439</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label" style="font-weight: bold">Age</td>
<td class="gt_row gt_center" headers="stat_0"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td class="gt_row gt_center" headers="stat_0">50 (14)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Min, Max</td>
<td class="gt_row gt_center" headers="stat_0">18, 94</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Q1, Q3</td>
<td class="gt_row gt_center" headers="stat_0">41, 61</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label" style="font-weight: bold">Alert Level Combined Lead</td>
<td class="gt_row gt_center" headers="stat_0"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;no_alert</td>
<td class="gt_row gt_center" headers="stat_0">10,261 (71%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;early_covid</td>
<td class="gt_row gt_center" headers="stat_0">1,617 (11%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;alert_level_1</td>
<td class="gt_row gt_center" headers="stat_0">1,272 (8.8%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;alert_level_2</td>
<td class="gt_row gt_center" headers="stat_0">366 (2.5%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;alert_level_2_5_3</td>
<td class="gt_row gt_center" headers="stat_0">253 (1.8%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;alert_level_4</td>
<td class="gt_row gt_center" headers="stat_0">670 (4.6%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label" style="font-weight: bold">Born Nz</td>
<td class="gt_row gt_center" headers="stat_0">11,398 (79%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="stat_0">25</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label" style="font-weight: bold">Edu</td>
<td class="gt_row gt_center" headers="stat_0"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td class="gt_row gt_center" headers="stat_0">5.38 (2.72)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Min, Max</td>
<td class="gt_row gt_center" headers="stat_0">0.00, 10.00</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Q1, Q3</td>
<td class="gt_row gt_center" headers="stat_0">3.00, 7.00</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="stat_0">110</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label" style="font-weight: bold">Employed</td>
<td class="gt_row gt_center" headers="stat_0">11,466 (80%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="stat_0">22</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label" style="font-weight: bold">Eth Cat</td>
<td class="gt_row gt_center" headers="stat_0"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;euro</td>
<td class="gt_row gt_center" headers="stat_0">11,835 (83%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;maori</td>
<td class="gt_row gt_center" headers="stat_0">1,526 (11%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;pacific</td>
<td class="gt_row gt_center" headers="stat_0">314 (2.2%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;asian</td>
<td class="gt_row gt_center" headers="stat_0">655 (4.6%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="stat_0">109</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label" style="font-weight: bold">Household Inc log</td>
<td class="gt_row gt_center" headers="stat_0"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td class="gt_row gt_center" headers="stat_0">11.41 (0.74)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Min, Max</td>
<td class="gt_row gt_center" headers="stat_0">0.71, 14.40</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Q1, Q3</td>
<td class="gt_row gt_center" headers="stat_0">11.00, 11.92</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="stat_0">655</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label" style="font-weight: bold">Male</td>
<td class="gt_row gt_center" headers="stat_0">5,238 (36%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label" style="font-weight: bold">Neighbourhood Community</td>
<td class="gt_row gt_center" headers="stat_0"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td class="gt_row gt_center" headers="stat_0">4.23 (1.66)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Min, Max</td>
<td class="gt_row gt_center" headers="stat_0">1.00, 7.00</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Q1, Q3</td>
<td class="gt_row gt_center" headers="stat_0">2.99, 5.95</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="stat_0">73</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label" style="font-weight: bold">Parent</td>
<td class="gt_row gt_center" headers="stat_0">10,350 (72%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="stat_0">8</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label" style="font-weight: bold">Partner</td>
<td class="gt_row gt_center" headers="stat_0">10,661 (76%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="stat_0">399</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label" style="font-weight: bold">Religion Religious</td>
<td class="gt_row gt_center" headers="stat_0">5,218 (36%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="stat_0">19</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label" style="font-weight: bold">Rural Gch 2018 l</td>
<td class="gt_row gt_center" headers="stat_0"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;1</td>
<td class="gt_row gt_center" headers="stat_0">8,822 (62%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;2</td>
<td class="gt_row gt_center" headers="stat_0">2,784 (19%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;3</td>
<td class="gt_row gt_center" headers="stat_0">1,740 (12%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;4</td>
<td class="gt_row gt_center" headers="stat_0">820 (5.7%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;5</td>
<td class="gt_row gt_center" headers="stat_0">170 (1.2%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="stat_0">103</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label" style="font-weight: bold">Sample Weights</td>
<td class="gt_row gt_center" headers="stat_0"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td class="gt_row gt_center" headers="stat_0">0.94 (1.22)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Min, Max</td>
<td class="gt_row gt_center" headers="stat_0">0.30, 19.96</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Q1, Q3</td>
<td class="gt_row gt_center" headers="stat_0">0.40, 1.03</td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="odd">
<td colspan="2" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span> n (%)</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
</section>
<section id="exposure-table" class="level2">
<h2 class="anchored" data-anchor-id="exposure-table">Exposure table</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tables$exposure_tables</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="outcome-table" class="level1 page-columns page-full">
<h1>Outcome table</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>tables<span class="sc">$</span>outcome_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="scwveccaln" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#scwveccaln table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#scwveccaln thead, #scwveccaln tbody, #scwveccaln tfoot, #scwveccaln tr, #scwveccaln td, #scwveccaln th {
  border-style: none;
}

#scwveccaln p {
  margin: 0;
  padding: 0;
}

#scwveccaln .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#scwveccaln .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#scwveccaln .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#scwveccaln .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#scwveccaln .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#scwveccaln .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#scwveccaln .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#scwveccaln .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#scwveccaln .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#scwveccaln .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#scwveccaln .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#scwveccaln .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#scwveccaln .gt_spanner_row {
  border-bottom-style: hidden;
}

#scwveccaln .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#scwveccaln .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#scwveccaln .gt_from_md > :first-child {
  margin-top: 0;
}

#scwveccaln .gt_from_md > :last-child {
  margin-bottom: 0;
}

#scwveccaln .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#scwveccaln .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#scwveccaln .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#scwveccaln .gt_row_group_first td {
  border-top-width: 2px;
}

#scwveccaln .gt_row_group_first th {
  border-top-width: 2px;
}

#scwveccaln .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#scwveccaln .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#scwveccaln .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#scwveccaln .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#scwveccaln .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#scwveccaln .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#scwveccaln .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#scwveccaln .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#scwveccaln .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#scwveccaln .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#scwveccaln .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#scwveccaln .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#scwveccaln .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#scwveccaln .gt_left {
  text-align: left;
}

#scwveccaln .gt_center {
  text-align: center;
}

#scwveccaln .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#scwveccaln .gt_font_normal {
  font-weight: normal;
}

#scwveccaln .gt_font_bold {
  font-weight: bold;
}

#scwveccaln .gt_font_italic {
  font-style: italic;
}

#scwveccaln .gt_super {
  font-size: 65%;
}

#scwveccaln .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#scwveccaln .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#scwveccaln .gt_indent_1 {
  text-indent: 5px;
}

#scwveccaln .gt_indent_2 {
  text-indent: 10px;
}

#scwveccaln .gt_indent_3 {
  text-indent: 15px;
}

#scwveccaln .gt_indent_4 {
  text-indent: 20px;
}

#scwveccaln .gt_indent_5 {
  text-indent: 25px;
}

#scwveccaln .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#scwveccaln div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="gt_col_headings header">
<th id="label" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Outcome Variables by Wave</strong></th>
<th id="stat_1" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>2018</strong><br> N = 14,439<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
<th id="stat_2" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>2020</strong><br> N = 14,439<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label" style="font-weight: bold">Kessler Latent Anxiety</td>
<td class="gt_row gt_center" headers="stat_1">1.04 (0.65, 1.67)</td>
<td class="gt_row gt_center" headers="stat_2">1.03 (0.65, 1.67)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="stat_1">148</td>
<td class="gt_row gt_center" headers="stat_2">2,893</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label" style="font-weight: bold">Kessler Latent Depression</td>
<td class="gt_row gt_center" headers="stat_1">0.31 (0.01, 0.96)</td>
<td class="gt_row gt_center" headers="stat_2">0.31 (0.01, 0.96)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="stat_1">152</td>
<td class="gt_row gt_center" headers="stat_2">2,890</td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="odd">
<td colspan="3" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span> Median (Q1, Q3)</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
<section id="inspect-the-distribution-of-the-exposure-in-treatment-wave" class="level3">
<h3 class="anchored" data-anchor-id="inspect-the-distribution-of-the-exposure-in-treatment-wave">Inspect the distribution of the exposure in treatment wave</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select 2019 wave</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>dt_19 <span class="ot">&lt;-</span> dat_long <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(wave <span class="sc">==</span> <span class="dv">2019</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mean</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>mean_exposure <span class="ot">&lt;-</span><span class="fu">mean</span>(dt_19<span class="sc">$</span>perfectionism, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># median</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>median_exposure <span class="ot">&lt;-</span><span class="fu">median</span>(dt_19<span class="sc">$</span>perfectionism, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># check if you like</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co"># median_exposure</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># mean_exposure</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># generate bar plot</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>graph_density_of_exposure_up <span class="ot">&lt;-</span> margot<span class="sc">::</span><span class="fu">margot_plot_shift</span>(</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  dt_19,</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">shift =</span> <span class="st">"up"</span>,</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_name =</span> <span class="st">"perfectionism"</span>,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">binwidth =</span> .<span class="dv">25</span>, </span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">range_highlight =</span> <span class="fu">c</span>(<span class="dv">0</span>,mean_exposure)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="co"># show</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>graph_density_of_exposure_up</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-content_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#margot::here_save(graph_density_of_exposure_up, "graph_density_of_exposure_up")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="check-for-change-in-the-treatment-positivity" class="level3">
<h3 class="anchored" data-anchor-id="check-for-change-in-the-treatment-positivity">Check for change in the treatment (Positivity)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  select data from wave 18 and 19 </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>dt_18_19_positivity <span class="ot">&lt;-</span> dat_long <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(wave <span class="sc">==</span> <span class="dv">2018</span> <span class="sc">|</span> wave <span class="sc">==</span> <span class="dv">2019</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">perfectionism_round =</span> <span class="fu">round</span>(perfectionism, <span class="at">digits =</span> <span class="dv">0</span>)) <span class="sc">|&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(perfectionism_round, id, wave) <span class="sc">|&gt;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>()</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span>margot<span class="sc">::</span><span class="fu">margot_transition_table</span>(<span class="at">data =</span> dt_18_19_positivity, <span class="at">state_var =</span> <span class="st">"perfectionism_round"</span>, <span class="at">id_var =</span> <span class="st">"id"</span>, <span class="at">wave_var =</span> <span class="st">"wave"</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># table</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>tables[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 13%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">From / To</th>
<th style="text-align: right;">State 1</th>
<th style="text-align: right;">State 2</th>
<th style="text-align: right;">State 3</th>
<th style="text-align: right;">State 4</th>
<th style="text-align: right;">State 5</th>
<th style="text-align: right;">State 6</th>
<th style="text-align: right;">State 7</th>
<th style="text-align: right;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">State 1</td>
<td style="text-align: right;">893</td>
<td style="text-align: right;">484</td>
<td style="text-align: right;">194</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1632</td>
</tr>
<tr class="even">
<td style="text-align: left;">State 2</td>
<td style="text-align: right;">657</td>
<td style="text-align: right;">1737</td>
<td style="text-align: right;">904</td>
<td style="text-align: right;">283</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3669</td>
</tr>
<tr class="odd">
<td style="text-align: left;">State 3</td>
<td style="text-align: right;">237</td>
<td style="text-align: right;">1073</td>
<td style="text-align: right;">1368</td>
<td style="text-align: right;">768</td>
<td style="text-align: right;">245</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3736</td>
</tr>
<tr class="even">
<td style="text-align: left;">State 4</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">335</td>
<td style="text-align: right;">803</td>
<td style="text-align: right;">1076</td>
<td style="text-align: right;">523</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">2921</td>
</tr>
<tr class="odd">
<td style="text-align: left;">State 5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">77</td>
<td style="text-align: right;">253</td>
<td style="text-align: right;">531</td>
<td style="text-align: right;">579</td>
<td style="text-align: right;">223</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">1713</td>
</tr>
<tr class="even">
<td style="text-align: left;">State 6</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">106</td>
<td style="text-align: right;">205</td>
<td style="text-align: right;">216</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">634</td>
</tr>
<tr class="odd">
<td style="text-align: left;">State 7</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">134</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for import later</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># margot::here_save(transition_table, "transition_table")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="explanation-for-the-table" class="level3">
<h3 class="anchored" data-anchor-id="explanation-for-the-table">Explanation for the table</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(out<span class="sc">$</span>explanation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>These transition matrices capture shifts in states between consecutive waves. Each cell represents the count of individuals transitioning from one state to another. The rows correspond to the initial state (From), and the columns correspond to the subsequent state (To). **Diagonal entries** (in **bold**) correspond to individuals who remained in the same state. **Off-diagonal entries** correspond to individuals who transitioned to a different state.

A higher number on the diagonal relative to off-diagonal entries indicates greater stability in a state. Conversely, higher off-diagonal numbers suggest more frequent shifts between states.</code></pre>
</div>
</div>
</section>
<section id="lab-part-2-simulation-to-clarify-why-the-distribution-of-effect-modifiers-matter-for-estimating-treatment-effects" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="lab-part-2-simulation-to-clarify-why-the-distribution-of-effect-modifiers-matter-for-estimating-treatment-effects">Lab Part 2: Simulation to Clarify Why The Distribution of Effect Modifiers Matter For Estimating Treatment Effects</h2>
<p>First, we load the <code>stdReg</code> library, which obtains marginal effect estimates by simulating counterfactuals under different levels of treatment <span class="citation" data-cites="sjölander2016">(<a href="#ref-sjölander2016" role="doc-biblioref">Sjölander 2016</a>)</span>. If a treatment is continuous, the levels can be specified.</p>
<div class="no-row-height column-margin column-container"><div id="ref-sjölander2016" class="csl-entry" role="listitem">
Sjölander, Arvid. 2016. <span>“Regression Standardization with the R Package stdReg.”</span> <em>European Journal of Epidemiology</em> 31 (6): 563–74. <a href="https://doi.org/10.1007/s10654-016-0157-3">https://doi.org/10.1007/s10654-016-0157-3</a>.
</div><div id="ref-parameters2020" class="csl-entry" role="listitem">
Lüdecke, Daniel, Mattan S. Ben-Shachar, Indrajeet Patil, and Dominique Makowski. 2020. <span>“Extracting, Computing and Exploring the Parameters of Statistical Models Using <span>R</span>.”</span> <em>Journal of Open Source Software</em> 5 (53): 2445. <a href="https://doi.org/10.21105/joss.02445">https://doi.org/10.21105/joss.02445</a>.
</div></div><p>We also load the <code>parameters</code> library, which creates nice tables <span class="citation" data-cites="parameters2020">(<a href="#ref-parameters2020" role="doc-biblioref">Lüdecke et al. 2020</a>)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to obtain marginal effects</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stdReg)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># to create nice tables</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parameters)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we write a function to simulate data for the sample and and target populations.</p>
<p>We assume the treatment effect is the same in the sample and target population. We will assume that the coefficient for the effect-modifier and the coefficient for interaction are the same. We assume no unmeasured confounding throughout the study. We assume only selective attrition of one effect modifier such that the baseline population differs from the sample population at the end of the study.</p>
<p>That is: <strong>the distribution of effect modifiers is the only respect in which the sample will differ from the target population.</strong></p>
<p>This function will generate data under a range of scenarios.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;See documentation in the <code>margot</code> package: <span class="citation" data-cites="margot2024">Bulbulia (<a href="#ref-margot2024" role="doc-biblioref">2024</a>)</span></p><div id="ref-margot2024" class="csl-entry" role="listitem">
Bulbulia, J. A. 2024. <em>Margot: MARGinal Observational Treatment-Effects</em>. <a href="https://doi.org/10.5281/zenodo.10907724">https://doi.org/10.5281/zenodo.10907724</a>.
</div></div></div><div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># function to generate data for the sample and population, </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># along with precise sample weights for the population, there are differences </span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># in the distribution of the true effect modifier but no differences in the treatment effect </span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># or the effect modification.all that differs between the sample and the population is </span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># the distribution of effect-modifiers.</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># reproducability</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate the data -- you can use different parameters</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> margot<span class="sc">::</span><span class="fu">simulate_ate_data_with_weights</span>(</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_sample =</span> <span class="dv">10000</span>,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_population =</span> <span class="dv">100000</span>,</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">p_z_sample =</span> <span class="fl">0.1</span>,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">p_z_population =</span> <span class="fl">0.5</span>,</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_a =</span> <span class="dv">1</span>,</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_z =</span> <span class="fl">2.5</span>,</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">noise_sd =</span> <span class="fl">0.5</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="co"># view</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ sample_data    :'data.frame':    10000 obs. of  4 variables:
  ..$ y_sample: num [1:10000] 1.1854 -0.0834 1.4635 -0.2841 2.6125 ...
  ..$ a_sample: int [1:10000] 0 0 1 0 0 0 1 1 1 0 ...
  ..$ z_sample: int [1:10000] 0 0 0 0 1 0 0 0 0 0 ...
  ..$ weights : num [1:10000] 0.556 0.556 0.556 0.556 5 ...
 $ population_data:'data.frame':    100000 obs. of  3 variables:
  ..$ y_population: num [1:100000] 0.331 1.982 -0.446 1.117 0.916 ...
  ..$ a_population: int [1:100000] 1 0 0 1 1 0 0 1 0 0 ...
  ..$ z_population: int [1:100000] 0 1 0 0 0 0 0 0 0 0 ...</code></pre>
</div>
</div>
<p>Ok, we have generated both sample and population data.</p>
<p>Next, we verify that the distributions of effect modifiers differ in the sample and in the target population:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain the generated data</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>sample_data <span class="ot">&lt;-</span> data<span class="sc">$</span>sample_data</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>population_data <span class="ot">&lt;-</span> data<span class="sc">$</span>population_data</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># check imbalance</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(sample_data<span class="sc">$</span>z_sample) <span class="co"># type 1 is rare</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   0    1 
9055  945 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(population_data<span class="sc">$</span>z_population) <span class="co"># type 1 is common</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    0     1 
49916 50084 </code></pre>
</div>
</div>
<p>Good, the distributions differ. The simulation is working as intended.</p>
<p>Next, consider the question: “What are the differences in the coefficients that we obtain from the study population at the end of study, as compared with the target population?”</p>
<p>First, we obtain the coefficients for the sample. They are as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model coefficients sample</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>model_sample  <span class="ot">&lt;-</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(y_sample <span class="sc">~</span> a_sample <span class="sc">*</span> z_sample, <span class="at">data =</span> sample_data)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># summary</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>parameters<span class="sc">::</span><span class="fu">model_parameters</span>(model_sample, <span class="at">ci_method =</span> <span class="st">"wald"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parameter           | Coefficient |       SE |        95% CI | t(9996) |      p
-------------------------------------------------------------------------------
(Intercept)         |   -6.89e-03 | 7.38e-03 | [-0.02, 0.01] |   -0.93 | 0.350 
a sample            |        1.01 |     0.01 | [ 0.99, 1.03] |   95.84 | &lt; .001
z sample            |        2.47 |     0.02 | [ 2.43, 2.52] |  104.09 | &lt; .001
a sample × z sample |        0.51 |     0.03 | [ 0.44, 0.57] |   14.82 | &lt; .001</code></pre>
</div>
</div>
<p>Ok, let’s obtain the coefficients for the weighted regression of the sample. Notice that the coefficients are virtually the same:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model the sample weighted to the population, again note that these coefficients are similar </span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>model_weighted_sample <span class="ot">&lt;-</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(y_sample <span class="sc">~</span>  a_sample  <span class="sc">*</span> z_sample,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> sample_data,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">weights =</span> weights)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># summary</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(parameters<span class="sc">::</span><span class="fu">model_parameters</span>(model_weighted_sample, <span class="at">ci_method =</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"wald"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parameter           | Coefficient |        95% CI |      p
----------------------------------------------------------
(Intercept)         |   -6.89e-03 | [-0.03, 0.01] | 0.480 
a sample            |        1.01 | [ 0.98, 1.04] | &lt; .001
z sample            |        2.47 | [ 2.45, 2.50] | &lt; .001
a sample × z sample |        0.51 | [ 0.47, 0.55] | &lt; .001

Model: y_sample ~ a_sample * z_sample (10000 Observations)
Sigma: 0.494 (df = 9996)</code></pre>
</div>
</div>
<p>We might be tempted to infer that weighting wasn’t relevant to the analysis. However, we’ll see that such an interpretation would be a mistake.</p>
<p>Next, let us obtain model coefficients for the population. Note again there is no difference – only narrower errors owing to the large sample size.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model coefficients population -- note that these coefficients are very similar. </span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>model_population <span class="ot">&lt;-</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(y_population <span class="sc">~</span> a_population <span class="sc">*</span> z_population, <span class="at">data =</span> population_data)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>parameters<span class="sc">::</span><span class="fu">model_parameters</span>(model_population, <span class="at">ci_method =</span> <span class="st">"wald"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parameter                   | Coefficient |       SE |        95% CI | t(99996) |      p
----------------------------------------------------------------------------------------
(Intercept)                 |    2.49e-03 | 3.18e-03 | [ 0.00, 0.01] |     0.78 | 0.434 
a population                |        1.00 | 4.49e-03 | [ 0.99, 1.01] |   222.35 | &lt; .001
z population                |        2.50 | 4.49e-03 | [ 2.49, 2.51] |   556.80 | &lt; .001
a population × z population |        0.50 | 6.35e-03 | [ 0.49, 0.51] |    78.80 | &lt; .001</code></pre>
</div>
</div>
<p>Again, there is no difference. That is, we find that all model coefficients are practically equivalent. The different distribution of effect modifiers does not result in different coefficient values for the treatment effect, the effect-modifier “effect,” or the interaction of effect modifier and treatment.</p>
<p>Consider why this is the case: in a large sample where the causal effects are invariant – as we have simulated them to be – we will have good replication in the effect modifiers within the sample, so our statistical model can recover the <em>coefficients</em> for the population – no problem.</p>
<p>However, <strong>in causal inference, we are interested in obtaining the marginal effect of the treatment</strong>. That is, we seek an estimate for the counterfactual contrast in which everyone in a pre-specified population was subject to one level of treatment compared with a counterfactual condition in which everyone in a population was subject to another level of the same treatment. <strong>When the sample population differs in the distribution of effect modifiers from the target population effect, the marginal effect estimates will typically differ.</strong></p>
<p>To see this, we use the <code>stdReg</code> package to recover marginal effect estimates, comparing (1) the sample ATE, (2) the true oracle ATE for the population, and (3) the weighted sample ATE. We will use the outputs of the same models above. The only difference is that we will calculate marginal effects from these outputs. We will contrast a difference from an intervention in which everyone receives treatment = 0 with one in which everyone receives treatment = 1, however, this choice is arbitrary, and the general lessons apply irrespective of the estimand.</p>
<p>First, consider this ATE for the sample population.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># What inference do we draw?  We cannot say the models are unbiased for the marginal effect estimates. </span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># regression standardisation </span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stdReg) <span class="co"># to obtain marginal effects </span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain sample ate</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>fit_std_sample <span class="ot">&lt;-</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  stdReg<span class="sc">::</span><span class="fu">stdGlm</span>(model_sample, <span class="at">data =</span> sample_data, <span class="at">X =</span> <span class="st">"a_sample"</span>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co"># summary</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_std_sample,</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">contrast =</span> <span class="st">"difference"</span>,</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">reference =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: y_sample ~ a_sample * z_sample
Family: gaussian 
Link function: identity 
Exposure:  a_sample 
Reference level:  a_sample = 0 
Contrast:  difference 

  Estimate Std. Error lower 0.95 upper 0.95
0     0.00     0.0000       0.00       0.00
1     1.06     0.0101       1.04       1.08</code></pre>
</div>
</div>
<p>The treatment effect is given as a 1.06 unit change in the outcome across the sample population, with a confidence interval from 1.04 to 1.08.</p>
<p>Next, we obtain the true (oracle) treatment effect for the population under the same intervention.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="do">## note the population effect is different</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">#obtain true ate</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>fit_std_population <span class="ot">&lt;-</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  stdReg<span class="sc">::</span><span class="fu">stdGlm</span>(model_population, <span class="at">data =</span> population_data, <span class="at">X =</span> <span class="st">"a_population"</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># summary</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_std_population,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">contrast =</span> <span class="st">"difference"</span>,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">reference =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: y_population ~ a_population * z_population
Family: gaussian 
Link function: identity 
Exposure:  a_population 
Reference level:  a_population = 0 
Contrast:  difference 

  Estimate Std. Error lower 0.95 upper 0.95
0     0.00    0.00000       0.00       0.00
1     1.25    0.00327       1.24       1.26</code></pre>
</div>
</div>
<p>Note, the true treatment effect is a 1.25 unit change in the population, with a confidence bound between 1.24 and 1.26. This is well outside the ATE that we obtain from the sample population!</p>
<p>Next, consider the ATE in the weighted regression, where the sample was weighted to the target population’s true distribution of effect modifiers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="do">## next try weights adjusted ate where we correctly assign population weights to the sample</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>fit_std_weighted_sample_weights <span class="ot">&lt;-</span> stdReg<span class="sc">::</span><span class="fu">stdGlm</span>( model_weighted_sample, </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sample_data, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">X =</span> <span class="st">"a_sample"</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co"># this gives us the right answer</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_std_weighted_sample_weights, </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">contrast =</span> <span class="st">"difference"</span>, </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">reference =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: y_sample ~ a_sample * z_sample
Family: gaussian 
Link function: identity 
Exposure:  a_sample 
Reference level:  a_sample = 0 
Contrast:  difference 

  Estimate Std. Error lower 0.95 upper 0.95
0     0.00     0.0000       0.00       0.00
1     1.25     0.0172       1.22       1.29</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># moral of the story. when we marginalise over the entire sample we need to weight estimates to the target population. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We find that we obtain the population-level causal effect estimate with accurate coverage by weighting the sample to the target population. So with appropriate weights, our results generalise from the sample to the target population.</p>
</section>
<section id="lessons-from-lab-2" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="lessons-from-lab-2">Lessons from Lab 2</h2>
<ul>
<li>Regression coefficients do not clarify the problem of sample/target population mismatch – or selection bias as discussed in this manuscript.</li>
<li>The correct advice to investigators is that they should not rely on regression coefficients when evaluating the biases that arise from sample attrition. This advice applies to both methods that the authors use to investigate threats of bias. That is, to implement this advice, the authors must first take it.</li>
<li>Generally, observed data are insufficient for assessing threats. Observed data do not clarify structural sources of bias, nor do they clarify effect-modification in the full counterfactual data condition in which all receive the treatment and all do not receive the treatment (at the same level).</li>
<li>To properly assess bias, one would need access to the counterfactual outcome—what would have happened to the missing participants had they not been lost to follow-up or had they responded. Again, the join distributions over “full data” are inherently unobservable <span class="citation" data-cites="vanderlaan2011">(<a href="#ref-vanderlaan2011" role="doc-biblioref">Van Der Laan and Rose 2011</a>)</span>.</li>
<li>In simple settings like the one we just simulated, we may address the gap between the sample and target population using methods such as modelling the censoring (e.g., censoring weighting). However, we never know what setting we are in or whether it is simple—such modelling must be handled with care. There is a large and growing epidemiology literature on this topic (see, for example, <span class="citation" data-cites="li2023non">Li, Miao, and Tchetgen Tchetgen (<a href="#ref-li2023non" role="doc-biblioref">2023</a>)</span>). <!-- - Matters become more complex when there is confounding and selection bias because the problem is not merely one of external validity but also internal validity (i.e. obtaining valid causal effect estimates for the baseline sample). See for example @scharfstein1999adjusting; @laan2003unified; @howe2016selection (note that @howe2016selection, "selection" bias is defined as collider stratification bias, a variety of confounding bias and not simple sample and target population mismatch.)   --></li>
</ul>
<div class="no-row-height column-margin column-container"><div id="ref-vanderlaan2011" class="csl-entry" role="listitem">
Van Der Laan, Mark J., and Sherri Rose. 2011. <em>Targeted Learning: Causal Inference for Observational and Experimental Data</em>. Springer Series in Statistics. New York, NY: Springer. <a href="https://link.springer.com/10.1007/978-1-4419-9782-1">https://link.springer.com/10.1007/978-1-4419-9782-1</a>.
</div><div id="ref-li2023non" class="csl-entry" role="listitem">
Li, Wei, Wang Miao, and Eric Tchetgen Tchetgen. 2023. <span>“Non-Parametric Inference about Mean Functionals of Non-Ignorable Non-Response Data Without Identifying the Joint Distribution.”</span> <em>Journal of the Royal Statistical Society Series B: Statistical Methodology</em> 85 (3): 913–35.
</div></div></section>
<section id="appendix-a-simplification-of-additive-interaction-formula" class="level2">
<h2 class="anchored" data-anchor-id="appendix-a-simplification-of-additive-interaction-formula">Appendix A: Simplification of Additive Interaction Formula</h2>
<p>We start with the definition of additive interaction based on comparing the joint effect relative to baseline versus the sum of individual effects relative to baseline:</p>
<p><span class="math display">
\Big(\mathbb{E}[Y(1,1)] - \mathbb{E}[Y(0,0)]\Big) - \Big[\Big(\mathbb{E}[Y(1,0)] - \mathbb{E}[Y(0,0)]\Big) + \Big(\mathbb{E}[Y(0,1)] - \mathbb{E}[Y(0,0)]\Big)\Big]
</span></p>
<p>First, distribute the negative sign across the terms within the square brackets:</p>
<p><span class="math display">
\mathbb{E}[Y(1,1)] - \mathbb{E}[Y(0,0)] - \Big(\mathbb{E}[Y(1,0)] - \mathbb{E}[Y(0,0)]\Big) - \Big(\mathbb{E}[Y(0,1)] - \mathbb{E}[Y(0,0)]\Big)
</span></p>
<p>Now remove the parentheses, flipping the signs inside them where preceded by a minus sign:</p>
<p><span class="math display">
\mathbb{E}[Y(1,1)] - \mathbb{E}[Y(0,0)] - \mathbb{E}[Y(1,0)] + \mathbb{E}[Y(0,0)] - \mathbb{E}[Y(0,1)] + \mathbb{E}[Y(0,0)]
</span></p>
<p>Next, combine the <span class="math inline">\mathbb{E}[Y(0,0)]</span> terms:</p>
<ul>
<li>We have <span class="math inline">-\mathbb{E}[Y(0,0)]</span></li>
<li>Then <span class="math inline">+\mathbb{E}[Y(0,0)]</span> (these two cancel each other out)</li>
<li>And another <span class="math inline">+\mathbb{E}[Y(0,0)]</span> remains.</li>
</ul>
<p>The expression simplifies to:</p>
<p><span class="math display">
\mathbb{E}[Y(1,1)] - \mathbb{E}[Y(1,0)] - \mathbb{E}[Y(0,1)] + \mathbb{E}[Y(0,0)]
</span></p>
<p>This is the standard definition of additive interaction, often called the interaction contrast. If this expression equals zero, there is no additive interaction; a non-zero value indicates an interaction effect.</p>
<p><strong>This shows clearly that interaction is measured as the deviation of the joint effect from the sum of the separate effects, adjusted for the baseline.</strong></p>
</section>
<section id="appendix-b" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="appendix-b">Appendix B</h2>
<section id="evidence-for-effect-modification-is-relative-to-inclusion-of-other-variables-in-the-model" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="evidence-for-effect-modification-is-relative-to-inclusion-of-other-variables-in-the-model">Evidence for effect-modification is relative to inclusion of other variables in the model</h3>
<p>The ‘sharp-null hypothesis’ states there is no effect of the exposure on the outcome for any unit in the target population. Unless the ‘sharp-null hypothesis’ is false, there may be effect-modification. For any study worth conducting, we cannot evaluate whether the sharp-null hypothesis is false. If we could the experiment would be otiose. Therefore, we must assume the possibility of effect-modification. Notably, whether a variable is an effect-modifier also depends on which other variables are included in the model. That is, just as for the concept of a ‘confounder’, where a variable is an ‘effect-modifier’ cannot be stated without reference to an assumed causal order and an explicit statement about which other variables will be included in the model <span class="citation" data-cites="vanderweele2012">(<a href="#ref-vanderweele2012" role="doc-biblioref">Tyler J. VanderWeele 2012</a>)</span>.</p>
<div class="no-row-height column-margin column-container"><div id="ref-vanderweele2012" class="csl-entry" role="listitem">
VanderWeele, Tyler J. 2012. <span>“Confounding and Effect Modification: Distribution and Measure.”</span> <em>Epidemiologic Methods</em> 1 (1): 55–82. <a href="https://doi.org/10.1515/2161-962X.1004">https://doi.org/10.1515/2161-962X.1004</a>.
</div></div><p>As illustrated in <a href="#fig-eff-mod-rel" class="quarto-xref">Figure&nbsp;4</a>, the marginal association between <span class="math inline">A</span> and <span class="math inline">Y</span> is unbiased. Here, exposure <span class="math inline">A</span> is unconditionally associated with <span class="math inline">Y</span>. Recall our convention <svg width="40px" height="40px"><circle cx="20" cy="20" r="18" fill="none" stroke="blue" stroke-width="2"></circle><text x="20" y="20" alignment-baseline="middle" text-anchor="middle" fill="blue" font-size="16">G</text></svg> denotes effect-modification with conditioning and <svg width="40px" height="40px"><circle cx="20" cy="20" r="18" fill="none" stroke="blue" stroke-width="2" stroke-dasharray="4,4"></circle><text x="20" y="20" alignment-baseline="middle" text-anchor="middle" fill="blue" font-size="16">Z</text></svg> indicates effect-modification without conditioning.</p>
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div id="fig-eff-mod-rel" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-eff-mod-rel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06-content_files/figure-html/fig-eff-mod-rel-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-eff-mod-rel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Consider a randomised experiment. There is no confounding. Here, the marginal association between A and Y provides an unbiased estimate for the causal effect of A on Y. Does the conditional association of A on Y vary within levels of G? The causal diagram allows for a classification of G as an effect modifier of A on Y by proxy. G modifies A’s effect on Y in virtue of G’s relationship to Z, which, according to this graph, is a direct effect modifier for the effect of A on Y.
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-dag-effect-modificationb" class="quarto-xref">Figure&nbsp;5</a> presents the same a randomised experiment as in the previous causal diagram. We again assume that there is no confounding of the marginal association between the exposure, <span class="math inline">A</span>, and the outcome, <span class="math inline">Y</span>. However, suppose we were to adjust for <span class="math inline">Z</span> and ask, does the conditional association of <span class="math inline">A</span> on <span class="math inline">Y</span> vary within levels of <span class="math inline">G</span>, after adjusting for <span class="math inline">Z</span>? That is, does <span class="math inline">G</span> remain an effect-modifier of the exposure on the outcome? <span class="citation" data-cites="vanderweele2007">Tyler J. VanderWeele and Robins (<a href="#ref-vanderweele2007" role="doc-biblioref">2007b</a>)</span> proved that for effect-modification to occur, at least one other arrow besides the treatment must enter into the outcome. According to <a href="#fig-dag-effect-modificationb" class="quarto-xref">Figure&nbsp;5</a> the only arrow into <span class="math inline">Y</span> other than <span class="math inline">A</span> arrives from <span class="math inline">Z</span>. Because <span class="math inline">Y</span> is independent of <span class="math inline">G</span> conditional on <span class="math inline">Z</span> we may infer that <span class="math inline">G</span> is no longer an effect modifier for the effect of <span class="math inline">A</span> on <span class="math inline">Y</span>. Viewed another way, <span class="math inline">G</span> no longer co-varies with <span class="math inline">Y</span> conditional on <span class="math inline">Z</span> and so cannot act as an effect-modifier.</p>
<div class="no-row-height column-margin column-container"></div><div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div id="fig-dag-effect-modificationb" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-dag-effect-modificationb-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06-content_files/figure-html/fig-dag-effect-modificationb-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-dag-effect-modificationb-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Conditioning on Z renders G independent of Y. G is no longer an effect modifier after conditioning on Z because G is independent of Y. Although Z is an unconditional effect modifier, G is not.
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-dag-effect-modificationc" class="quarto-xref">Figure&nbsp;6</a> presents the same a randomised experiment as in the previous graph. We assume a true effect of <span class="math inline">A \rightarrow Y</span>. If we do not condition on <span class="math inline">B</span>, then <span class="math inline">G</span> will not modify the effect of <span class="math inline">A  \rightarrow Y</span> because <span class="math inline">G</span> will not be associated with <span class="math inline">Y</span>. However, if we were to condition on <span class="math inline">B</span>, then both <span class="math inline">B</span> (an effect modifier by proxy) and <span class="math inline">G</span> may become effect-modifiers for the causal effect of <span class="math inline">A</span> on <span class="math inline">Y</span>. In this setting, both <span class="math inline">B</span> and <span class="math inline">G</span> are conditional effect-modifiers.</p>
<p>Note that casual graphs help us to evaluate classifications of conditional and unconditional effect modifiers. They may also help to clarify conditions in which conditioning on unconditional effect-modifiers may remove conditional effect-modification. However we cannot not tell from a causal diagram whether the ancestors of an unconditional effect-modifier will be conditional effect-modifiers for the effect of the exposure on the outcome; see: <span class="citation" data-cites="vanderweele2007">Tyler J. VanderWeele and Robins (<a href="#ref-vanderweele2007" role="doc-biblioref">2007b</a>)</span>, also <span class="citation" data-cites="suzuki2013counterfactual">Suzuki et al. (<a href="#ref-suzuki2013counterfactual" role="doc-biblioref">2013</a>)</span>. Causal diagrams express non-parametric relations. I have adopted an off-label colouring convention to denote instances of effect-modification to highlight possible pathways for effect-modification, which may be relative to other variables in a model.</p>
<div class="no-row-height column-margin column-container"><div id="ref-vanderweele2007" class="csl-entry" role="listitem">
VanderWeele, Tyler J., and James M. Robins. 2007b. <span>“Four types of effect modification: a classification based on directed acyclic graphs.”</span> <em>Epidemiology (Cambridge, Mass.)</em> 18 (5): 561–68. <a href="https://doi.org/10.1097/EDE.0b013e318127181b">https://doi.org/10.1097/EDE.0b013e318127181b</a>.
</div></div><div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div id="fig-dag-effect-modificationc" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-dag-effect-modificationc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06-content_files/figure-html/fig-dag-effect-modificationc-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-dag-effect-modificationc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Blue path denotes effect-modification for G by conditioning on B. Both B and G are conditional effect modifiers.
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-dag-effect-modificationd" class="quarto-xref">Figure&nbsp;7</a> reveals the relativity of effect-modification. If investigators do not condition on <span class="math inline">B</span>, then <span class="math inline">G</span> cannot be a conditional effect-modifier because <span class="math inline">G</span> would then be independent of <span class="math inline">Z</span> because <span class="math inline">B</span> is a collider. However, as we observed in <a href="#fig-dag-effect-modificationc" class="quarto-xref">Figure&nbsp;6</a>, conditioning on <span class="math inline">B</span>, a collider, may open a path for effect-modification of <span class="math inline">G</span> by <span class="math inline">Z</span>. Both <span class="math inline">B</span> and <span class="math inline">G</span> are conditional effect modifiers.</p>
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div id="fig-dag-effect-modificationd" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-dag-effect-modificationd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06-content_files/figure-html/fig-dag-effect-modificationd-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-dag-effect-modificationd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Blue path denotes effect-modification. Here G is not an effect modifier because B, a common effect (collider) of G and Z, is not conditioned on. Any conditional effect modification for G would require conditioning on B, and not-conditioning on G. Otherwise G will be d-separated from Y.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div id="fig-dag-effect-modification5c" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-dag-effect-modification5c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06-content_files/figure-html/fig-dag-effect-modification5c-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-dag-effect-modification5c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Blue path denotes effect-modification. Neither, G nor B are unconditional effect-modifiers for the effect of A on Y after Z is conditioned upon. If investigators condition on Z, the causal diagram implies they will not find evidence for effect-modification by B or G, which are conditionally independent of Y once Z is conditioned upon.
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-dag-effect-modification5c" class="quarto-xref">Figure&nbsp;8</a> considers the implications of conditioning on <span class="math inline">Z</span>, which is the only unconditional effect-modifier on the graph. If <span class="math inline">Z</span> is measured, conditioning on <span class="math inline">Z</span> will remove effect-modification for <span class="math inline">B</span> and <span class="math inline">G</span> because <span class="math inline">B,G\coprod Y |Z</span>. This examples again reveals the context dependency of effect-modification. Here, causal diagrams are useful for clarifying features of dependent and independent effect modification. For further discussion, see: <span class="citation" data-cites="suzuki2013counterfactual">Suzuki et al. (<a href="#ref-suzuki2013counterfactual" role="doc-biblioref">2013</a>)</span>; <span class="citation" data-cites="vanderweele2009distinction">Tyler J. VanderWeele (<a href="#ref-vanderweele2009distinction" role="doc-biblioref">2009</a>)</span>.</p>
<div class="no-row-height column-margin column-container"><div id="ref-suzuki2013counterfactual" class="csl-entry" role="listitem">
Suzuki, Etsuji, Toshiharu Mitsuhashi, Toshihide Tsuda, and Eiji Yamamoto. 2013. <span>“A Counterfactual Approach to Bias and Effect Modification in Terms of Response Types.”</span> <em>BMC Medical Research Methodology</em> 13 (1): 1–17.
</div><div id="ref-vanderweele2009distinction" class="csl-entry" role="listitem">
VanderWeele, Tyler J. 2009. <span>“On the Distinction Between Interaction and Effect Modification.”</span> <em>Epidemiology</em>, 863–71.
</div></div></section>
<section id="packages" class="level3">
<h3 class="anchored" data-anchor-id="packages">Packages</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>report<span class="sc">::</span><span class="fu">cite_packages</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  - Bulbulia J (2024). _margot: MARGinal Observational Treatment-effects_. doi:10.5281/zenodo.10907724 &lt;https://doi.org/10.5281/zenodo.10907724&gt;, R package version 0.3.3.3 Functions to obtain MARGinal Observational Treatment-effects from observational data., &lt;https://go-bayes.github.io/margot/&gt;.
  - Firke S (2024). _janitor: Simple Tools for Examining and Cleaning Dirty Data_. R package version 2.2.1, &lt;https://CRAN.R-project.org/package=janitor&gt;.
  - Grolemund G, Wickham H (2011). "Dates and Times Made Easy with lubridate." _Journal of Statistical Software_, *40*(3), 1-25. &lt;https://www.jstatsoft.org/v40/i03/&gt;.
  - Lüdecke D, Ben-Shachar M, Patil I, Makowski D (2020). "Extracting, Computing and Exploring the Parameters of Statistical Models using R." _Journal of Open Source Software_, *5*(53), 2445. doi:10.21105/joss.02445 &lt;https://doi.org/10.21105/joss.02445&gt;.
  - Müller K (2020). _here: A Simpler Way to Find Your Files_. R package version 1.0.1, &lt;https://CRAN.R-project.org/package=here&gt;.
  - Müller K, Wickham H (2023). _tibble: Simple Data Frames_. R package version 3.2.1, &lt;https://CRAN.R-project.org/package=tibble&gt;.
  - R Core Team (2025). _R: A Language and Environment for Statistical Computing_. R Foundation for Statistical Computing, Vienna, Austria. &lt;https://www.R-project.org/&gt;.
  - Rich B (2023). _table1: Tables of Descriptive Statistics in HTML_. R package version 1.4.3, &lt;https://CRAN.R-project.org/package=table1&gt;.
  - Sjoberg D, Whiting K, Curry M, Lavery J, Larmarange J (2021). "Reproducible Summary Tables with the gtsummary Package." _The R Journal_, *13*, 570-580. doi:10.32614/RJ-2021-053 &lt;https://doi.org/10.32614/RJ-2021-053&gt;, &lt;https://doi.org/10.32614/RJ-2021-053&gt;.
  - Sjolander A, Dahlqwist E (2021). _stdReg: Regression Standardization_. R package version 3.4.1, &lt;https://CRAN.R-project.org/package=stdReg&gt;.
  - Waring E, Quinn M, McNamara A, Arino de la Rubia E, Zhu H, Ellis S (2022). _skimr: Compact and Flexible Summaries of Data_. R package version 2.1.5, &lt;https://CRAN.R-project.org/package=skimr&gt;.
  - Wickham H (2016). _ggplot2: Elegant Graphics for Data Analysis_. Springer-Verlag New York. ISBN 978-3-319-24277-4, &lt;https://ggplot2.tidyverse.org&gt;.
  - Wickham H (2023). _forcats: Tools for Working with Categorical Variables (Factors)_. R package version 1.0.0, &lt;https://CRAN.R-project.org/package=forcats&gt;.
  - Wickham H (2023). _stringr: Simple, Consistent Wrappers for Common String Operations_. R package version 1.5.1, &lt;https://CRAN.R-project.org/package=stringr&gt;.
  - Wickham H, Averick M, Bryan J, Chang W, McGowan LD, François R, Grolemund G, Hayes A, Henry L, Hester J, Kuhn M, Pedersen TL, Miller E, Bache SM, Müller K, Ooms J, Robinson D, Seidel DP, Spinu V, Takahashi K, Vaughan D, Wilke C, Woo K, Yutani H (2019). "Welcome to the tidyverse." _Journal of Open Source Software_, *4*(43), 1686. doi:10.21105/joss.01686 &lt;https://doi.org/10.21105/joss.01686&gt;.
  - Wickham H, François R, Henry L, Müller K, Vaughan D (2023). _dplyr: A Grammar of Data Manipulation_. R package version 1.1.4, &lt;https://CRAN.R-project.org/package=dplyr&gt;.
  - Wickham H, Henry L (2025). _purrr: Functional Programming Tools_. R package version 1.0.4, &lt;https://CRAN.R-project.org/package=purrr&gt;.
  - Wickham H, Hester J, Bryan J (2024). _readr: Read Rectangular Text Data_. R package version 2.1.5, &lt;https://CRAN.R-project.org/package=readr&gt;.
  - Wickham H, Vaughan D, Girlich M (2024). _tidyr: Tidy Messy Data_. R package version 1.3.1, &lt;https://CRAN.R-project.org/package=tidyr&gt;.</code></pre>
</div>
</div>


<!-- -->


</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb43" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Causal Inference: Understanding How Effects Differ"</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Effect Modification, Interaction, and Conditional Average Treatment Effects"</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2025-APR-01"</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> /Users/joseph/GIT/templates/bib/references.bib</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="co">    warnings: FALSE</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co">    error: FALSE</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="co">    messages: FALSE</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: scroll</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight-style: kate</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools:</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="co">      source: true</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="co">      toggle: FALSE</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="an">html-math-method:</span><span class="co"> katex</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="an">reference-location:</span><span class="co"> margin</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="an">citation-location:</span><span class="co"> margin</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="an">cap-location:</span><span class="co"> margin</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a><span class="an">code-block-border-left:</span><span class="co"> true</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;style&gt;</span></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a><span class="in">  .boxedblue {</span></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a><span class="in">      border: 2px solid blue;</span></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a><span class="in">      border-radius: 4px; /* slight roundness */</span></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a><span class="in">      padding: 3px 6px; /* vertical | horizontal */</span></span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a><span class="in">      display: inline-block;</span></span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a><span class="in">      color: blue;</span></span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a><span class="in">  .circleblue {</span></span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a><span class="in">      border: 2px dashed blue;</span></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a><span class="in">      border-radius: 50%;</span></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a><span class="in">      padding: 3px 6px;</span></span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a><span class="in">      display: inline-block;</span></span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a><span class="in">      color: blue;</span></span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/style&gt;</span></span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a><span class="co"># libraries and functions (ensure these are accessible)</span></span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a><span class="co"># library("tinytex")</span></span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a><span class="co"># library(extrafont)</span></span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a><span class="co"># loadfonts(device = "win") # Adjust device based on OS if using extrafont</span></span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a><span class="co"># source("/Users/joseph/GIT/templates/functions/funs.R") </span></span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a>**Required Reading**</span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">@hernan2024WHATIF</span><span class="co">]</span> Chapters 4-5 <span class="co">[</span><span class="ot">link</span><span class="co">](https://www.dropbox.com/scl/fi/9hy6xw1g1o4yz94ip8cvd/hernanrobins_WhatIf_2jan24.pdf?rlkey=8eaw6lqhmes7ddepuriwk5xk9&amp;dl=0)</span></span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-60"><a href="#cb43-60" aria-hidden="true" tabindex="-1"></a>**Optional Reading**</span>
<span id="cb43-61"><a href="#cb43-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-62"><a href="#cb43-62" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">@vanderweele2007FOURTYPESOFEFFECT</span><span class="co">] [link]</span>(https://www.dropbox.com/scl/fi/drytp2ui2b8o9jplh4bm9/four_types_of_effect_modification__a.6.pdf?rlkey=mb9nl599v93m6kyyo69iv5nz1&amp;dl=0)</span>
<span id="cb43-63"><a href="#cb43-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-64"><a href="#cb43-64" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">@vanderweele2009distinction</span><span class="co">] [link]</span>(https://www.dropbox.com/scl/fi/srpynr0dvjcndveplcydn/OutcomeWide_StatisticalScience.pdf?rlkey=h4fv32oyjegdfl3jq9u1fifc3&amp;dl=0)</span>
<span id="cb43-65"><a href="#cb43-65" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb43-66"><a href="#cb43-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-67"><a href="#cb43-67" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb43-68"><a href="#cb43-68" aria-hidden="true" tabindex="-1"></a><span class="fu">## Key Concepts for Assessment</span></span>
<span id="cb43-69"><a href="#cb43-69" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Causal Estimand:** The specific causal question we want to answer (e.g., the average effect in the whole population).</span>
<span id="cb43-70"><a href="#cb43-70" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Statistical Estimand:** The calculation we perform on our data to try and answer the causal question.</span>
<span id="cb43-71"><a href="#cb43-71" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Interaction:** The combined effect of *two or more* interventions.</span>
<span id="cb43-72"><a href="#cb43-72" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Effect Modification:** When the effect of *one* intervention changes depending on a person's characteristics.</span>
<span id="cb43-73"><a href="#cb43-73" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Heterogeneous Treatment Effects (HTE):** The general *idea* that treatment effects vary across people.</span>
<span id="cb43-74"><a href="#cb43-74" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Conditional Average Treatment Effect (CATE) $\tau(x)$:** The *average* treatment effect for a specific subgroup defined by characteristics $x$.</span>
<span id="cb43-75"><a href="#cb43-75" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Estimated Conditional Average Treatment Effect $\hat{\tau}(X)$:** Our *estimate* (from data) of the average treatment effect for a subgroup with characteristics $X$.</span>
<span id="cb43-76"><a href="#cb43-76" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb43-77"><a href="#cb43-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-78"><a href="#cb43-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-79"><a href="#cb43-79" aria-hidden="true" tabindex="-1"></a><span class="fu">## If you learn nothing else from this course...</span></span>
<span id="cb43-80"><a href="#cb43-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-81"><a href="#cb43-81" aria-hidden="true" tabindex="-1"></a>To answer psychological questions properly, we first need to state them very clearly. Causal inference gives us the tools to do this.</span>
<span id="cb43-82"><a href="#cb43-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-83"><a href="#cb43-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-84"><a href="#cb43-84" aria-hidden="true" tabindex="-1"></a><span class="fu">## Causal inference asks: "What if?"</span></span>
<span id="cb43-85"><a href="#cb43-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-86"><a href="#cb43-86" aria-hidden="true" tabindex="-1"></a>The core idea is to compare what *actually happened* with what *could have happened* under different conditions (these "what ifs" are called **counterfactuals**).</span>
<span id="cb43-87"><a href="#cb43-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-88"><a href="#cb43-88" aria-hidden="true" tabindex="-1"></a>Imagine an outcome we care about, like student test scores ($Y$). We might compare the score if *everyone* got a new teaching method (let's call this condition $a^*$) versus if *everyone* got the old method (condition $a$).</span>
<span id="cb43-89"><a href="#cb43-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-90"><a href="#cb43-90" aria-hidden="true" tabindex="-1"></a>The difference in the potential outcome ($Y$) under these two scenarios is the causal effect for one person: $Y(a^*) - Y(a)$.</span>
<span id="cb43-91"><a href="#cb43-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-92"><a href="#cb43-92" aria-hidden="true" tabindex="-1"></a>Since we can't see both scenarios for the same person, we often look at the average effect across a group. The **Average Treatment Effect (ATE)** is the average difference in potential outcomes across the whole population:</span>
<span id="cb43-93"><a href="#cb43-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-94"><a href="#cb43-94" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-95"><a href="#cb43-95" aria-hidden="true" tabindex="-1"></a>\text{ATE} = \mathbb{E}<span class="co">[</span><span class="ot">Y(a^*) - Y(a)</span><span class="co">]</span></span>
<span id="cb43-96"><a href="#cb43-96" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-97"><a href="#cb43-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-98"><a href="#cb43-98" aria-hidden="true" tabindex="-1"></a>This asks: "On average, how much would scores change if we switched everyone from the old method ($a$) to the new method ($a^*$)?".</span>
<span id="cb43-99"><a href="#cb43-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-100"><a href="#cb43-100" aria-hidden="true" tabindex="-1"></a>A big challenge is dealing with **confounders** – other factors that mix up the relationship between the treatment ($A$) and the outcome ($Y$), potentially misleading us about the true causal effect. We need to account for these.</span>
<span id="cb43-101"><a href="#cb43-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-102"><a href="#cb43-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-103"><a href="#cb43-103" aria-hidden="true" tabindex="-1"></a><span class="fu">## What do 'Interaction' and 'Effect Modification' mean in Causal Inference?</span></span>
<span id="cb43-104"><a href="#cb43-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-105"><a href="#cb43-105" aria-hidden="true" tabindex="-1"></a>Words like 'moderation' and 'interaction' are often used loosely. Causal inference needs precise terms.</span>
<span id="cb43-106"><a href="#cb43-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-107"><a href="#cb43-107" aria-hidden="true" tabindex="-1"></a>We'll focus on two specific ideas:</span>
<span id="cb43-108"><a href="#cb43-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-109"><a href="#cb43-109" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Interaction:** About the effect of *combining* interventions.</span>
<span id="cb43-110"><a href="#cb43-110" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Effect Modification:** About how the effect of *one* intervention changes for different *types of people*.</span>
<span id="cb43-111"><a href="#cb43-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-112"><a href="#cb43-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-113"><a href="#cb43-113" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interaction: The Effect of Teamwork (or Lack Thereof)</span></span>
<span id="cb43-114"><a href="#cb43-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-115"><a href="#cb43-115" aria-hidden="true" tabindex="-1"></a>**Interaction** in causal inference is about **joint interventions**. We look at what happens when we apply *two or more different treatments* at the same time.</span>
<span id="cb43-116"><a href="#cb43-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-117"><a href="#cb43-117" aria-hidden="true" tabindex="-1"></a>Let's say we have two treatments, $A$ and $B$, and an outcome $Y$.</span>
<span id="cb43-118"><a href="#cb43-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-119"><a href="#cb43-119" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$Y(\tilde{a})$ is the potential outcome if we set treatment $A$ to level $\tilde{a}$.</span>
<span id="cb43-120"><a href="#cb43-120" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$Y(\tilde{b})$ is the potential outcome if we set treatment $B$ to level $\tilde{b}$.</span>
<span id="cb43-121"><a href="#cb43-121" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$Y(\tilde{a}, \tilde{b})$ is the potential outcome if we set $A$ to $\tilde{a}$ *and* $B$ to $\tilde{b}$ simultaneously.</span>
<span id="cb43-122"><a href="#cb43-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-123"><a href="#cb43-123" aria-hidden="true" tabindex="-1"></a>To figure out these effects from observational data, we usually need assumptions like:</span>
<span id="cb43-124"><a href="#cb43-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-125"><a href="#cb43-125" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Consistency:** The outcome we see for someone who got treatment $\tilde{a}$ is the same as their potential outcome $Y(\tilde{a})$.</span>
<span id="cb43-126"><a href="#cb43-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-127"><a href="#cb43-127" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Conditional Exchangeability (No Unmeasured Confounding):** We can make the groups receiving different treatments comparable by adjusting for measured confounders ($L$ for $A \to Y$, and $Q$ for $B \to Y$). The sets $L$ and $Q$ might overlap.</span>
<span id="cb43-128"><a href="#cb43-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-129"><a href="#cb43-129" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Positivity**: the exposures to be compared occur in all subgroups.</span>
<span id="cb43-130"><a href="#cb43-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-131"><a href="#cb43-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-132"><a href="#cb43-132" aria-hidden="true" tabindex="-1"></a>To study the *interaction* between $A$ and $B$, we need to be able to estimate the effect of $A$ and the effect of $B$, which means we need to adjust for *all* confounders in **both** $L$ and $Q$ (i.e., their union $L \cup Q$).</span>
<span id="cb43-133"><a href="#cb43-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-134"><a href="#cb43-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-135"><a href="#cb43-135" aria-hidden="true" tabindex="-1"></a><span class="fu">### Defining Interaction: Does 1 + 1 = 2?</span></span>
<span id="cb43-136"><a href="#cb43-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-137"><a href="#cb43-137" aria-hidden="true" tabindex="-1"></a>Let's use an education example:</span>
<span id="cb43-138"><a href="#cb43-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-139"><a href="#cb43-139" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$A$: New teaching method (1=New, 0=Old)</span>
<span id="cb43-140"><a href="#cb43-140" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$B$: Extra tutoring (1=Yes, 0=No)</span>
<span id="cb43-141"><a href="#cb43-141" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$Y$: Test score</span>
<span id="cb43-142"><a href="#cb43-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-143"><a href="#cb43-143" aria-hidden="true" tabindex="-1"></a>Is the boost in scores from getting *both* the new method *and* tutoring simply the sum of the boost from *only* the new method and the boost from *only* tutoring?</span>
<span id="cb43-144"><a href="#cb43-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-145"><a href="#cb43-145" aria-hidden="true" tabindex="-1"></a>We define **causal interaction on the additive scale** (looking at differences) by comparing the effect of the joint intervention to the sum of the individual effects (all compared to getting neither):</span>
<span id="cb43-146"><a href="#cb43-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-147"><a href="#cb43-147" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-148"><a href="#cb43-148" aria-hidden="true" tabindex="-1"></a>\underbrace{(\mathbb{E}<span class="co">[</span><span class="ot">Y(1,1)</span><span class="co">]</span> - \mathbb{E}<span class="co">[</span><span class="ot">Y(0,0)</span><span class="co">]</span>)}_{\text{Effect of Both}} \quad \text{vs} \quad \underbrace{(\mathbb{E}[Y(1,0)] - \mathbb{E}[Y(0,0)])}_{\text{Effect of A only}} + \underbrace{(\mathbb{E}[Y(0,1)] - \mathbb{E}[Y(0,0)])}_{\text{Effect of B only}}</span>
<span id="cb43-149"><a href="#cb43-149" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-150"><a href="#cb43-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-151"><a href="#cb43-151" aria-hidden="true" tabindex="-1"></a>Interaction exists if these are not equal. This simplifies to checking if the following is non-zero (see Appendix):</span>
<span id="cb43-152"><a href="#cb43-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-153"><a href="#cb43-153" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-154"><a href="#cb43-154" aria-hidden="true" tabindex="-1"></a>\underbrace{\mathbb{E}<span class="co">[</span><span class="ot">Y(1,1)</span><span class="co">]</span>}_{\text{Both}} - \underbrace{\mathbb{E}[Y(1,0)]}_{\text{A only}} - \underbrace{\mathbb{E}[Y(0,1)]}_{\text{B only}} + \underbrace{\mathbb{E}[Y(0,0)]}_{\text{Neither}} \neq 0</span>
<span id="cb43-155"><a href="#cb43-155" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-156"><a href="#cb43-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-157"><a href="#cb43-157" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If this is positive: **Synergy** (the combination is better than expected).</span>
<span id="cb43-158"><a href="#cb43-158" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If this is negative: **Antagonism** (the combination is worse than expected).</span>
<span id="cb43-159"><a href="#cb43-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-160"><a href="#cb43-160" aria-hidden="true" tabindex="-1"></a>*(We could also look at interaction on other scales, like ratios, which might give different answers. Always state the scale you're using -- we'll come back to this in later lectures)*</span>
<span id="cb43-161"><a href="#cb43-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-162"><a href="#cb43-162" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Finding Causal Interaction in Data</span></span>
<span id="cb43-163"><a href="#cb43-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-164"><a href="#cb43-164" aria-hidden="true" tabindex="-1"></a>To estimate this interaction, we need valid estimates for all four average potential outcomes:</span>
<span id="cb43-165"><a href="#cb43-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-166"><a href="#cb43-166" aria-hidden="true" tabindex="-1"></a>$$\mathbb{E}<span class="co">[</span><span class="ot">Y(0,0)</span><span class="co">]</span>, \mathbb{E}<span class="co">[</span><span class="ot">Y(1,0)</span><span class="co">]</span>, \mathbb{E}<span class="co">[</span><span class="ot">Y(0,1)</span><span class="co">]</span>, \mathbb{E}<span class="co">[</span><span class="ot">Y(1,1)</span><span class="co">]</span>$$</span>
<span id="cb43-167"><a href="#cb43-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-168"><a href="#cb43-168" aria-hidden="true" tabindex="-1"></a>This means we must control for confounders of *both* the $A \to Y$ link and the $B \to Y$ link.</span>
<span id="cb43-169"><a href="#cb43-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-170"><a href="#cb43-170" aria-hidden="true" tabindex="-1"></a>@fig-dag-interaction shows this. $L$ are confounders for $A \to Y$, and $Q$ are confounders for $B \to Y$. We need to block the backdoor paths (red arrows).</span>
<span id="cb43-171"><a href="#cb43-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-174"><a href="#cb43-174" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz}</span></span>
<span id="cb43-175"><a href="#cb43-175" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-dag-interaction</span></span>
<span id="cb43-176"><a href="#cb43-176" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Diagram illustrating causal interaction. Assessing the joint effect of two interventions, A (e.g., teaching method) and B (e.g., tutoring), on outcome Y (e.g., test score). L represents confounders of the A-Y relationship, and Q represents confounders of the B-Y relationship. Red arrows indicate biasing backdoor paths requiring adjustment. Assumes A and B are decided independently here."</span></span>
<span id="cb43-177"><a href="#cb43-177" aria-hidden="true" tabindex="-1"></a><span class="in">#| out-width: 100%</span></span>
<span id="cb43-178"><a href="#cb43-178" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb43-179"><a href="#cb43-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-180"><a href="#cb43-180" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning, shapes.geometric, arrows, decorations}</span></span>
<span id="cb43-181"><a href="#cb43-181" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzstyle{Arrow} = [-&gt;, thin, preaction = {decorate}]</span></span>
<span id="cb43-182"><a href="#cb43-182" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzset{&gt;=latex}</span></span>
<span id="cb43-183"><a href="#cb43-183" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[{every node/.append style}=draw]</span></span>
<span id="cb43-184"><a href="#cb43-184" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (LA) at (0, .5) {$L_{0}$};</span></span>
<span id="cb43-185"><a href="#cb43-185" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (LB) at (0, -.5) {$Q_{0}$};</span></span>
<span id="cb43-186"><a href="#cb43-186" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (A) at (2, .5) {$A_{1}$};</span></span>
<span id="cb43-187"><a href="#cb43-187" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (B) at (2, -.5) {$B_{1}$};</span></span>
<span id="cb43-188"><a href="#cb43-188" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (Y) at (5, 0) {$Y_{2}$};</span></span>
<span id="cb43-189"><a href="#cb43-189" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=red] (LA) to (A);</span></span>
<span id="cb43-190"><a href="#cb43-190" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=red] (LB) to (B);</span></span>
<span id="cb43-191"><a href="#cb43-191" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=red, bend left] (LA) to (Y);</span></span>
<span id="cb43-192"><a href="#cb43-192" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=red, bend right] (LB) to (Y);</span></span>
<span id="cb43-193"><a href="#cb43-193" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black] (A) to (Y); </span></span>
<span id="cb43-194"><a href="#cb43-194" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black] (B) to (Y); </span></span>
<span id="cb43-195"><a href="#cb43-195" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb43-196"><a href="#cb43-196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-197"><a href="#cb43-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-198"><a href="#cb43-198" aria-hidden="true" tabindex="-1"></a>@fig-dag-interaction-solved shows we need to condition on (adjust for) *both* $L_0$ and $Q_0$.</span>
<span id="cb43-199"><a href="#cb43-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-202"><a href="#cb43-202" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz}</span></span>
<span id="cb43-203"><a href="#cb43-203" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-dag-interaction-solved</span></span>
<span id="cb43-204"><a href="#cb43-204" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Identification of causal interaction requires adjusting for all confounders of A-Y (L) and B-Y (Q). Boxes around L and Q indicate conditioning, closing backdoor paths."</span></span>
<span id="cb43-205"><a href="#cb43-205" aria-hidden="true" tabindex="-1"></a><span class="in">#| out-width: 80%</span></span>
<span id="cb43-206"><a href="#cb43-206" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb43-207"><a href="#cb43-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-208"><a href="#cb43-208" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning, shapes.geometric, arrows, decorations}</span></span>
<span id="cb43-209"><a href="#cb43-209" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzstyle{Arrow} = [-&gt;, thin, preaction = {decorate}]</span></span>
<span id="cb43-210"><a href="#cb43-210" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzset{&gt;=latex}</span></span>
<span id="cb43-211"><a href="#cb43-211" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[{every node/.append style}=draw]</span></span>
<span id="cb43-212"><a href="#cb43-212" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=black] (LA) at (0, .5) {$L_{0}$}; </span></span>
<span id="cb43-213"><a href="#cb43-213" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=black] (LB) at (0, -.5) {$Q_{0}$}; </span></span>
<span id="cb43-214"><a href="#cb43-214" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (A) at (2, .5) {$A_{1}$};</span></span>
<span id="cb43-215"><a href="#cb43-215" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (B) at (2, -.5) {$B_{1}$};</span></span>
<span id="cb43-216"><a href="#cb43-216" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (Y) at (5, 0) {$Y_{2}$};</span></span>
<span id="cb43-217"><a href="#cb43-217" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black] (LA) to (A);</span></span>
<span id="cb43-218"><a href="#cb43-218" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black] (LB) to (B);</span></span>
<span id="cb43-219"><a href="#cb43-219" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black, bend left] (LA) to (Y);</span></span>
<span id="cb43-220"><a href="#cb43-220" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black, bend right] (LB) to (Y);</span></span>
<span id="cb43-221"><a href="#cb43-221" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black] (A) to (Y);</span></span>
<span id="cb43-222"><a href="#cb43-222" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black] (B) to (Y);</span></span>
<span id="cb43-223"><a href="#cb43-223" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb43-224"><a href="#cb43-224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-225"><a href="#cb43-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-226"><a href="#cb43-226" aria-hidden="true" tabindex="-1"></a>In our education example:</span>
<span id="cb43-227"><a href="#cb43-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-228"><a href="#cb43-228" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**L (Confounders for Teaching Method $\to$ Score):** Prior achievement, motivation, family background (SES), school quality, teacher differences (if not randomly assigned).</span>
<span id="cb43-229"><a href="#cb43-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-230"><a href="#cb43-230" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Q (Confounders for Tutoring $\to$ Score):** Prior achievement, motivation, family background (SES - paying for tutoring), student availability, specific learning needs.</span>
<span id="cb43-231"><a href="#cb43-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-232"><a href="#cb43-232" aria-hidden="true" tabindex="-1"></a>Notice that prior achievement and motivation are in *both* $L$ and $Q$. We need to measure and adjust for *all* important factors in $L$ and $Q$ to get a reliable estimate of the interaction.</span>
<span id="cb43-233"><a href="#cb43-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-234"><a href="#cb43-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-235"><a href="#cb43-235" aria-hidden="true" tabindex="-1"></a><span class="fu">## Effect Modification: Different Effects for Different People</span></span>
<span id="cb43-236"><a href="#cb43-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-237"><a href="#cb43-237" aria-hidden="true" tabindex="-1"></a>Unlike interaction (about combining treatments), **effect modification** is about whether the causal effect of a *single* intervention ($A$) on an outcome ($Y$) is *different* for different subgroups in the population. These subgroups are defined by baseline characteristics (like age, sex, prior history - let's call these $G$ or $X$).</span>
<span id="cb43-238"><a href="#cb43-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-239"><a href="#cb43-239" aria-hidden="true" tabindex="-1"></a>Effect modification helps us understand *who* benefits most (or least) from an intervention. We explore this using ideas like Heterogeneous Treatment Effects (HTE) and Conditional Average Treatment Effects (CATE).</span>
<span id="cb43-240"><a href="#cb43-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-241"><a href="#cb43-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-242"><a href="#cb43-242" aria-hidden="true" tabindex="-1"></a><span class="fu">### Heterogeneous Treatment Effects (HTE): The Idea of Variation</span></span>
<span id="cb43-243"><a href="#cb43-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-244"><a href="#cb43-244" aria-hidden="true" tabindex="-1"></a>**Heterogeneous Treatment Effects (HTE)** just means that the effect of a treatment ($A$ on $Y$) isn't the same for everyone. The effect *varies*. This variation *is* effect modification.</span>
<span id="cb43-245"><a href="#cb43-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-246"><a href="#cb43-246" aria-hidden="true" tabindex="-1"></a>Why does it vary?</span>
<span id="cb43-247"><a href="#cb43-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-248"><a href="#cb43-248" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Differences in things we can measure (like age, sex, baseline health - our $X$ variables).</span>
<span id="cb43-249"><a href="#cb43-249" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Differences in things we can't easily measure (like genetics, unmeasured background factors).</span>
<span id="cb43-250"><a href="#cb43-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-251"><a href="#cb43-251" aria-hidden="true" tabindex="-1"></a>HTE is the reality; treatments rarely work identically for all.</span>
<span id="cb43-252"><a href="#cb43-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-253"><a href="#cb43-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-254"><a href="#cb43-254" aria-hidden="true" tabindex="-1"></a><span class="fu">### Conditional Average Treatment Effect (CATE): Measuring Variation with Data $\tau(x)$</span></span>
<span id="cb43-255"><a href="#cb43-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-256"><a href="#cb43-256" aria-hidden="true" tabindex="-1"></a>To study HTE using data, we focus on the</span>
<span id="cb43-257"><a href="#cb43-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-258"><a href="#cb43-258" aria-hidden="true" tabindex="-1"></a>**Conditional Average Treatment Effect (CATE)**. CATE is a specific *causal question (estimand)*: What is the average treatment effect *for the subgroup of people who share specific measured characteristics* $X=x$?</span>
<span id="cb43-259"><a href="#cb43-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-260"><a href="#cb43-260" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-261"><a href="#cb43-261" aria-hidden="true" tabindex="-1"></a>\tau(x) = \text{CATE}(x) = \mathbb{E}<span class="co">[</span><span class="ot">Y(1) - Y(0) | X = x</span><span class="co">]</span></span>
<span id="cb43-262"><a href="#cb43-262" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-263"><a href="#cb43-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-264"><a href="#cb43-264" aria-hidden="true" tabindex="-1"></a>Here, $Y(1)$ is the potential outcome with treatment, $Y(0)$ without. $\tau(x)$ tells us the average effect specifically for people with characteristics $X=x$. By looking at how $\tau(x)$ changes for different $x$, we quantify effect modification *by the characteristics we measured in X*.</span>
<span id="cb43-265"><a href="#cb43-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-266"><a href="#cb43-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-267"><a href="#cb43-267" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comparing Effects Across Defined Groups</span></span>
<span id="cb43-268"><a href="#cb43-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-269"><a href="#cb43-269" aria-hidden="true" tabindex="-1"></a>A simple way to check for effect modification by a category $G$ (like comparing males vs females, or different locations) is to estimate the Average Treatment Effect (ATE) *separately within each group*. This is like comparing CATEs where $X$ is just the group variable $G$.</span>
<span id="cb43-270"><a href="#cb43-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-271"><a href="#cb43-271" aria-hidden="true" tabindex="-1"></a>Let's say $A$ is the treatment (0=control, 1=treated) and $G$ is the potential modifier (e.g., $g=$female, $g'=$male).</span>
<span id="cb43-272"><a href="#cb43-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-273"><a href="#cb43-273" aria-hidden="true" tabindex="-1"></a>We compare:</span>
<span id="cb43-274"><a href="#cb43-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-275"><a href="#cb43-275" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>The average effect for females ($G=g_1$): $\delta_{g_1} = \mathbb{E}<span class="co">[</span><span class="ot">Y(1) | G=g_1</span><span class="co">]</span> - \mathbb{E}<span class="co">[</span><span class="ot">Y(0) | G=g_1</span><span class="co">]</span>$</span>
<span id="cb43-276"><a href="#cb43-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-277"><a href="#cb43-277" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>The average effect for males ($G=g_2$): $\delta_{g_2} = \mathbb{E}<span class="co">[</span><span class="ot">Y(1) | G=g_2</span><span class="co">]</span> - \mathbb{E}<span class="co">[</span><span class="ot">Y(0) | G=g_2</span><span class="co">]</span>$</span>
<span id="cb43-278"><a href="#cb43-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-279"><a href="#cb43-279" aria-hidden="true" tabindex="-1"></a>Effect modification by $G$ exists if these are different: $\gamma = \delta_{g_1} - \delta_{g_2} \neq 0$.</span>
<span id="cb43-280"><a href="#cb43-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-281"><a href="#cb43-281" aria-hidden="true" tabindex="-1"></a>If our estimate $\hat{\gamma}$ is far from zero, it suggests the treatment effect differs between males and females.</span>
<span id="cb43-282"><a href="#cb43-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-283"><a href="#cb43-283" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Finding Effect Modification in Data</span></span>
<span id="cb43-284"><a href="#cb43-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-285"><a href="#cb43-285" aria-hidden="true" tabindex="-1"></a>To estimate these group-specific effects ($\delta_g$) and their difference ($\gamma$) correctly, we need to control for confounders ($L$) of the $A \to Y$ relationship *within each group* defined by $G$. </span>
<span id="cb43-286"><a href="#cb43-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-287"><a href="#cb43-287" aria-hidden="true" tabindex="-1"></a>Note: we don't necessarily need to control for things that cause $G$ itself, *unless* they also confound the $A \to Y$ relationship (i.e., are also in $L$).</span>
<span id="cb43-288"><a href="#cb43-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-289"><a href="#cb43-289" aria-hidden="true" tabindex="-1"></a>Look at @fig-dag-effect-modification. To estimate the $A \to Y$ effect within levels of $G$, we need to adjust for the confounders $L_0$. But this will partially block the effect-modification of G on Y.  Moreover, if we were identifying the causal effect of G on Y, after conditioning on L, we would find that a backdoor path opends from G to Y because L is a collider.  We cannot interpret any coefficient for G in a regression model where L is in the model. </span>
<span id="cb43-290"><a href="#cb43-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-293"><a href="#cb43-293" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz}</span></span>
<span id="cb43-294"><a href="#cb43-294" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-dag-effect-modification</span></span>
<span id="cb43-295"><a href="#cb43-295" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "How shall we investigate effect modification of A on Y by G? Can you see the problem?"</span></span>
<span id="cb43-296"><a href="#cb43-296" aria-hidden="true" tabindex="-1"></a><span class="in">#| out-width: 80%</span></span>
<span id="cb43-297"><a href="#cb43-297" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb43-298"><a href="#cb43-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-299"><a href="#cb43-299" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning, shapes.geometric, arrows.meta, decorations.pathmorphing}</span></span>
<span id="cb43-300"><a href="#cb43-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-301"><a href="#cb43-301" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzset{</span></span>
<span id="cb43-302"><a href="#cb43-302" aria-hidden="true" tabindex="-1"></a><span class="in">  Arrow/.style={-&gt;, &gt;=latex, line width=0.4pt},  % Defines a generic arrow style</span></span>
<span id="cb43-303"><a href="#cb43-303" aria-hidden="true" tabindex="-1"></a><span class="in">  emod/.style={rectangle, fill=blue!10, draw=blue, thick, minimum size=6mm},</span></span>
<span id="cb43-304"><a href="#cb43-304" aria-hidden="true" tabindex="-1"></a><span class="in">  emoddot/.style={circle, fill=blue!10, draw=blue, dotted, thick, minimum size=6mm}</span></span>
<span id="cb43-305"><a href="#cb43-305" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb43-306"><a href="#cb43-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-307"><a href="#cb43-307" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}</span></span>
<span id="cb43-308"><a href="#cb43-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-309"><a href="#cb43-309" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white, thick] (U) at (-4,0) {U};</span></span>
<span id="cb43-310"><a href="#cb43-310" aria-hidden="true" tabindex="-1"></a><span class="in">\node [black] (G) at (-2,0) {G};</span></span>
<span id="cb43-311"><a href="#cb43-311" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=black,thick] (L) at (0,0) {L$_{0}$};</span></span>
<span id="cb43-312"><a href="#cb43-312" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white, thick] (A) at (2,0) {A$_{1}$};</span></span>
<span id="cb43-313"><a href="#cb43-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-314"><a href="#cb43-314" aria-hidden="true" tabindex="-1"></a><span class="in">%\node [emoddot] (Z) at (0, -1) {Z};</span></span>
<span id="cb43-315"><a href="#cb43-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-316"><a href="#cb43-316" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white, thick] (Y) at (4,0) {Y$_{2}$};</span></span>
<span id="cb43-317"><a href="#cb43-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-318"><a href="#cb43-318" aria-hidden="true" tabindex="-1"></a><span class="in">\draw[Arrow, draw=black, bend left = 20] (U) to (L);</span></span>
<span id="cb43-319"><a href="#cb43-319" aria-hidden="true" tabindex="-1"></a><span class="in">\draw[Arrow, draw=black] (G) to (L);</span></span>
<span id="cb43-320"><a href="#cb43-320" aria-hidden="true" tabindex="-1"></a><span class="in">\draw[Arrow, draw=black] (L) to (A);</span></span>
<span id="cb43-321"><a href="#cb43-321" aria-hidden="true" tabindex="-1"></a><span class="in">\draw[Arrow, draw=black, bend left = 30] (L) to (Y);</span></span>
<span id="cb43-322"><a href="#cb43-322" aria-hidden="true" tabindex="-1"></a><span class="in">\draw[Arrow, draw=black, bend right = 30] (G) to (Y);</span></span>
<span id="cb43-323"><a href="#cb43-323" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black] (A) to (Y);</span></span>
<span id="cb43-324"><a href="#cb43-324" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black,bend left = 40] (U) to (Y);</span></span>
<span id="cb43-325"><a href="#cb43-325" aria-hidden="true" tabindex="-1"></a><span class="in">%\draw[-{Circle[open, fill=none]}, line width=0.25pt, draw=blue, bend right = 10] (Z) to (Y); % Circle-ended arrow</span></span>
<span id="cb43-326"><a href="#cb43-326" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb43-327"><a href="#cb43-327" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-328"><a href="#cb43-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-329"><a href="#cb43-329" aria-hidden="true" tabindex="-1"></a>Thus it is essential to understand that when we control for confounding along the the $A \to Y$ path, we do not identify the causal effects of effect-modifiers. Rather, we should consider effect-modifiers *prognostic* indicators. Moreover, we're going to need to develop methods for clarifying prognostic indicators in multi-dimensional settings where </span>
<span id="cb43-330"><a href="#cb43-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-331"><a href="#cb43-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-332"><a href="#cb43-332" aria-hidden="true" tabindex="-1"></a><span class="fu">## Estimating How Effects Vary: Getting $\hat{\tau}(x)$ from Data</span></span>
<span id="cb43-333"><a href="#cb43-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-334"><a href="#cb43-334" aria-hidden="true" tabindex="-1"></a>We defined the Conditional Average Treatment Effect (CATE), $\tau(x)$, as the *true* average effect for a subgroup with specific features $X=x$:</span>
<span id="cb43-335"><a href="#cb43-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-336"><a href="#cb43-336" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-337"><a href="#cb43-337" aria-hidden="true" tabindex="-1"></a>\tau(x) = \mathbb{E}<span class="co">[</span><span class="ot">Y(1) - Y(0) | X = x</span><span class="co">]</span></span>
<span id="cb43-338"><a href="#cb43-338" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-339"><a href="#cb43-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-340"><a href="#cb43-340" aria-hidden="true" tabindex="-1"></a>Now, we want to *estimate* this from our actual data. We call our estimate $\hat{\tau}(x)$. For any person $i$ in our study with features $X_i$, the value $\hat{\tau}(X_i)$ is our data-based *prediction* of the average treatment effect *for people like person i*.</span>
<span id="cb43-341"><a href="#cb43-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-342"><a href="#cb43-342" aria-hidden="true" tabindex="-1"></a><span class="fu">### "Personalised" Effects vs. True Individual Effects</span></span>
<span id="cb43-343"><a href="#cb43-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-344"><a href="#cb43-344" aria-hidden="true" tabindex="-1"></a>Wait - didn't we say we *can't* know the true effect for one specific person, $Y_i(1) - Y_i(0)$? Yes, that's still true.</span>
<span id="cb43-345"><a href="#cb43-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-346"><a href="#cb43-346" aria-hidden="true" tabindex="-1"></a>So what does $\hat{\tau}(X_i)$ mean?</span>
<span id="cb43-347"><a href="#cb43-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-348"><a href="#cb43-348" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Individual Causal Effect (Unknowable):** $Y_i(1) - Y_i(0)$. This is the true effect for person $i$. We can't observe both $Y_i(1)$ and $Y_i(0)$.</span>
<span id="cb43-349"><a href="#cb43-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-350"><a href="#cb43-350" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Estimated CATE ($\hat{\tau}(X_i)$) (What we calculate):** This is our estimate of the *average* effect, $\mathbb{E}[Y(1) - Y(0)]$, for the *subgroup* of people who share the same measured characteristics $X_i$ as person $i$.</span>
<span id="cb43-351"><a href="#cb43-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-352"><a href="#cb43-352" aria-hidden="true" tabindex="-1"></a>When people talk about "personalised" or "individualised" treatment effects in this context, they usually mean $\hat{\tau}(x)$. It's "personalised" because the prediction uses person $i$'s specific characteristics $X_i = x$. But remember, it's an **estimated average effect for a group**, not the unique effect for that single individual.</span>
<span id="cb43-353"><a href="#cb43-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-354"><a href="#cb43-354" aria-hidden="true" tabindex="-1"></a><span class="fu">### People Have Many Characteristics</span></span>
<span id="cb43-355"><a href="#cb43-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-356"><a href="#cb43-356" aria-hidden="true" tabindex="-1"></a>People aren't just in one group; they have many features at once. A student might be:</span>
<span id="cb43-357"><a href="#cb43-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-358"><a href="#cb43-358" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Female</span>
<span id="cb43-359"><a href="#cb43-359" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>21 years old</span>
<span id="cb43-360"><a href="#cb43-360" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>From a low-income family</span>
<span id="cb43-361"><a href="#cb43-361" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Did well on previous tests</span>
<span id="cb43-362"><a href="#cb43-362" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Goes to a rural school</span>
<span id="cb43-363"><a href="#cb43-363" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Highly motivated</span>
<span id="cb43-364"><a href="#cb43-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-365"><a href="#cb43-365" aria-hidden="true" tabindex="-1"></a>All these factors ($X_i$) together might influence how they respond to a new teaching method.</span>
<span id="cb43-366"><a href="#cb43-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-367"><a href="#cb43-367" aria-hidden="true" tabindex="-1"></a>Trying to figure this out with traditional regression by manually adding interaction terms (like <span class="in">`A*gender*age*income*...`</span>) becomes impossible very quickly:</span>
<span id="cb43-368"><a href="#cb43-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-369"><a href="#cb43-369" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Too many combinations, not enough data in each specific combo.</span>
<span id="cb43-370"><a href="#cb43-370" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>High risk of finding "effects" just by chance (false positives).</span>
<span id="cb43-371"><a href="#cb43-371" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Hard to know which interactions to even include.</span>
<span id="cb43-372"><a href="#cb43-372" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Can't easily discover unexpected patterns.</span>
<span id="cb43-373"><a href="#cb43-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-374"><a href="#cb43-374" aria-hidden="true" tabindex="-1"></a>Thus, while simple linear regression with interaction terms (<span class="in">`lm(Y ~ A * X1 + A * X2)`</span>) can estimate CATEs if the model is simple and correct, it often fails when things get complex (many $X$ variables, non-linear effects).</span>
<span id="cb43-375"><a href="#cb43-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-376"><a href="#cb43-376" aria-hidden="true" tabindex="-1"></a>**Causal forests** (using the <span class="in">`grf`</span> package in R) <span class="co">[</span><span class="ot">@grf2024</span><span class="co">]</span> are a powerful, flexible alternative designed for this task. They build decision trees that specifically aim to find groups with different treatment effects.</span>
<span id="cb43-377"><a href="#cb43-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-378"><a href="#cb43-378" aria-hidden="true" tabindex="-1"></a>We'll learn how to use <span class="in">`grf`</span> after the mid-term break. It will allow us to get the $\hat{\tau}(x)$ predictions and then think about how to use them, for instance, to prioritise who gets a treatment if resources are limited.</span>
<span id="cb43-379"><a href="#cb43-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-380"><a href="#cb43-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-381"><a href="#cb43-381" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- This is where modern methods like **causal forests** come in, which we'll come back to after the mid-term break. --&gt;</span></span>
<span id="cb43-382"><a href="#cb43-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-383"><a href="#cb43-383" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">###</span><span class="co"> Causal Forests: A Modern Tool for Estimating $\hat{\tau}(X)$ --&gt;</span></span>
<span id="cb43-384"><a href="#cb43-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-385"><a href="#cb43-385" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Causal forests (implemented in the R package `grf`) are designed for this complex situation. They are like random forests but built specifically to find differences in *treatment effects*. --&gt;</span></span>
<span id="cb43-386"><a href="#cb43-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-387"><a href="#cb43-387" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- How they help: --&gt;</span></span>
<span id="cb43-388"><a href="#cb43-388" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 1.  **Look at all features ($X$) at once:** They automatically search across all measured characteristics to see which ones explain differences in the treatment effect. --&gt;</span></span>
<span id="cb43-389"><a href="#cb43-389" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 2.  **Flexible:** They don't assume simple linear relationships and can find complex patterns. --&gt;</span></span>
<span id="cb43-390"><a href="#cb43-390" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 3.  **Local Averaging:** The estimate $\hat{\tau}(X_i)$ for person $i$ is based on the outcomes of other people in the data who are "similar" to person $i$ based on their characteristics $X$. --&gt;</span></span>
<span id="cb43-391"><a href="#cb43-391" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 4.  **"Honest" Estimates:** They use clever statistical techniques (like splitting the data) to try and give reliable estimates and confidence intervals, reducing the risk of overfitting. --&gt;</span></span>
<span id="cb43-392"><a href="#cb43-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-393"><a href="#cb43-393" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- The result is a prediction $\hat{\tau}(X_i)$ for each person $i$, based on their unique combination of measured features $X_i$. This gets us closer to understanding effect heterogeneity in a realistic way. --&gt;</span></span>
<span id="cb43-394"><a href="#cb43-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-395"><a href="#cb43-395" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">###</span><span class="co"> Why Estimate CATEs ($\hat{\tau}(X)$)? --&gt;</span></span>
<span id="cb43-396"><a href="#cb43-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-397"><a href="#cb43-397" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Estimating $\hat{\tau}(X)$ is how we investigate HTE using our measured data $X$. We look at how $\hat{\tau}(X)$ changes across different types of people (different $X$ values) to: --&gt;</span></span>
<span id="cb43-398"><a href="#cb43-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-399"><a href="#cb43-399" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 1.  **See if the effect varies:** Go beyond the overall average (ATE) and see *if* and *how* the effect differs. --&gt;</span></span>
<span id="cb43-400"><a href="#cb43-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-401"><a href="#cb43-401" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 2.  **Find subgroups:** Identify groups (defined by $X$) who might benefit much more (or less, or even be harmed) by the intervention. --&gt;</span></span>
<span id="cb43-402"><a href="#cb43-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-403"><a href="#cb43-403" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 3.  **Inform targeted policies:** Use the predictions $\hat{\tau}(X_i)$ to investigate if giving the treatment only to those predicted to benefit most would lead to better outcomes overall (we'll evaluate this later using tools like RATE curves -- again this is all coming after the mid-term break). --&gt;</span></span>
<span id="cb43-404"><a href="#cb43-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-405"><a href="#cb43-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-406"><a href="#cb43-406" aria-hidden="true" tabindex="-1"></a><span class="fu">### Summary</span></span>
<span id="cb43-407"><a href="#cb43-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-408"><a href="#cb43-408" aria-hidden="true" tabindex="-1"></a>Let's revisit the centeral ideas:</span>
<span id="cb43-409"><a href="#cb43-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-410"><a href="#cb43-410" aria-hidden="true" tabindex="-1"></a><span class="fu">####  **Interaction:**</span></span>
<span id="cb43-411"><a href="#cb43-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-412"><a href="#cb43-412" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Think:** Teamwork effect.</span>
<span id="cb43-413"><a href="#cb43-413" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**What:** Effect of *two or more different interventions* ($A$ and $B$) applied together.</span>
<span id="cb43-414"><a href="#cb43-414" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Question:** Is the joint effect $\mathbb{E}<span class="co">[</span><span class="ot">Y(a,b)</span><span class="co">]</span>$ different from the sum of individual effects?</span>
<span id="cb43-415"><a href="#cb43-415" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Needs:** Control confounders for *all* interventions involved ($L \cup Q$).</span>
<span id="cb43-416"><a href="#cb43-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-417"><a href="#cb43-417" aria-hidden="true" tabindex="-1"></a><span class="fu">####  **Effect Modification / HTE / CATE:**</span></span>
<span id="cb43-418"><a href="#cb43-418" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Think:** Different effects for different groups.</span>
<span id="cb43-419"><a href="#cb43-419" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**What:** Effect of a *single intervention* ($A$) varies depending on people's *baseline characteristics* ($G$ or $X$).</span>
<span id="cb43-420"><a href="#cb43-420" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Question (HTE):** *Does* the effect vary? (The phenomenon).</span>
<span id="cb43-421"><a href="#cb43-421" aria-hidden="true" tabindex="-1"></a><span class="ss">-  </span>**Question (CATE $\tau(x)$):** *What is* the average effect for a specific subgroup with features $X=x$? (The measure).</span>
<span id="cb43-422"><a href="#cb43-422" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Needs:** Control confounders for the *single* intervention ($L$) within subgroups.</span>
<span id="cb43-423"><a href="#cb43-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-424"><a href="#cb43-424" aria-hidden="true" tabindex="-1"></a><span class="fu">#### **Estimated "Individualised" Treatment Effects ($\hat{\tau}(x)$):**</span></span>
<span id="cb43-425"><a href="#cb43-425" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Think:** Personal profile prediction.</span>
<span id="cb43-426"><a href="#cb43-426" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**What:** Our *estimate* of the average treatment effect for the subgroup of people sharing characteristics $X_i$.</span>
<span id="cb43-427"><a href="#cb43-427" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**How:** Calculated using models (like causal forests) that use the person's full profile $X_i$.</span>
<span id="cb43-428"><a href="#cb43-428" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Important:** This is **not** the true effect for that single person (which is unknowable). It's an average for *people like them*.</span>
<span id="cb43-429"><a href="#cb43-429" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Use:** Explore HTE, identify subgroups, potentially inform targeted treatment strategies.</span>
<span id="cb43-430"><a href="#cb43-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-431"><a href="#cb43-431" aria-hidden="true" tabindex="-1"></a>Keeping these concepts distinct helps us ask clear research questions and choose the right methods.</span>
<span id="cb43-432"><a href="#cb43-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-433"><a href="#cb43-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-434"><a href="#cb43-434" aria-hidden="true" tabindex="-1"></a><span class="fu">## Course Review So Far: A Quick Recap</span></span>
<span id="cb43-435"><a href="#cb43-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-436"><a href="#cb43-436" aria-hidden="true" tabindex="-1"></a>Let's quickly review the main ideas of causal inference we've covered.</span>
<span id="cb43-437"><a href="#cb43-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-438"><a href="#cb43-438" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Big Question: Does A cause Y?</span></span>
<span id="cb43-439"><a href="#cb43-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-440"><a href="#cb43-440" aria-hidden="true" tabindex="-1"></a>Causal inference helps us answer if something (like a teaching method, $A$) causes a change in something else (like test scores, $Y$).</span>
<span id="cb43-441"><a href="#cb43-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-442"><a href="#cb43-442" aria-hidden="true" tabindex="-1"></a><span class="fu">### Core Idea: "What If?" (Counterfactuals)</span></span>
<span id="cb43-443"><a href="#cb43-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-444"><a href="#cb43-444" aria-hidden="true" tabindex="-1"></a>We compare what actually happened to what *would have happened* in a different scenario.</span>
<span id="cb43-445"><a href="#cb43-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-446"><a href="#cb43-446" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$Y(1)$: Score if the student *had* received the new method.</span>
<span id="cb43-447"><a href="#cb43-447" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$Y(0)$: Score if the student *had* received the old method.</span>
<span id="cb43-448"><a href="#cb43-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-449"><a href="#cb43-449" aria-hidden="true" tabindex="-1"></a>The **Average Treatment Effect (ATE)** = $\mathbb{E}<span class="co">[</span><span class="ot">Y(1) - Y(0)</span><span class="co">]</span>$ is the average difference across the whole group.</span>
<span id="cb43-450"><a href="#cb43-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-451"><a href="#cb43-451" aria-hidden="true" tabindex="-1"></a><span class="fu">### This Lecture Clarified Concepts of Interaction vs. Effect Modification vs. Individual Predictions</span></span>
<span id="cb43-452"><a href="#cb43-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-453"><a href="#cb43-453" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Interaction (Think: Teamwork Effects)</span></span>
<span id="cb43-454"><a href="#cb43-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-455"><a href="#cb43-455" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**About:** Combining *two different interventions* (A and B).</span>
<span id="cb43-456"><a href="#cb43-456" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Question:** Does using both A and B together give a result different from just adding up their separate effects? (e.g., new teaching method + tutoring).</span>
<span id="cb43-457"><a href="#cb43-457" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Needs:** Analyse effects of A alone, B alone, and A+B together. Control confounders for *both* A and B.</span>
<span id="cb43-458"><a href="#cb43-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-459"><a href="#cb43-459" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Effect Modification (Think: Different Effects for Different Groups)</span></span>
<span id="cb43-460"><a href="#cb43-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-461"><a href="#cb43-461" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**About:** How the effect of *one intervention* (A) changes based on people's *characteristics* (X, like prior grades).</span>
<span id="cb43-462"><a href="#cb43-462" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Question:** Does the teaching method (A) work better for high-achieving students (X=high) than low-achieving students (X=low)?</span>
<span id="cb43-463"><a href="#cb43-463" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**HTE:** The *idea* that effects differ.</span>
<span id="cb43-464"><a href="#cb43-464" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**CATE $\tau(x)$:** The *average effect* for the specific group with characteristics $X=x$.</span>
<span id="cb43-465"><a href="#cb43-465" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Needs:** Analyse effect of A *within* different groups (levels of X). Control confounders for A.</span>
<span id="cb43-466"><a href="#cb43-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-467"><a href="#cb43-467" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Estimated Individualised Effects ($\hat{\tau}(X_i)$) (Think: Personal Profile Prediction)</span></span>
<span id="cb43-468"><a href="#cb43-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-469"><a href="#cb43-469" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**About:** Using a person's *whole profile* of characteristics ($X_i$ - age, gender, background, etc.) to predict their likely response to treatment A.</span>
<span id="cb43-470"><a href="#cb43-470" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**How:** Modern methods (like causal forests) take all of $X_i$ and estimate $\hat{\tau}(X_i)$.</span>
<span id="cb43-471"><a href="#cb43-471" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Result:** this $\hat{\tau}(X_i)$ is **not** the true unknowable effect for person $i$. It is the estimated *average effect for people similar to person i* (sharing characteristics $X_i$).</span>
<span id="cb43-472"><a href="#cb43-472" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Use:** helps explore if tailoring treatment based on these profiles ($X_i$) could be beneficial.</span>
<span id="cb43-473"><a href="#cb43-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-474"><a href="#cb43-474" aria-hidden="true" tabindex="-1"></a><span class="fu">### Simple Summary:</span></span>
<span id="cb43-475"><a href="#cb43-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-476"><a href="#cb43-476" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Interaction:** Do A and B work together well/badly?</span>
<span id="cb43-477"><a href="#cb43-477" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Effect Modification:** Does A's effect depend on *who* you are (based on X)?</span>
<span id="cb43-478"><a href="#cb43-478" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**$\hat{\tau}(X_i)$:** Can we *predict* A's average effect for someone based on their specific profile $X_i$?</span>
<span id="cb43-479"><a href="#cb43-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-480"><a href="#cb43-480" aria-hidden="true" tabindex="-1"></a>Understanding these differences is key to doing good causal research!</span>
<span id="cb43-481"><a href="#cb43-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-482"><a href="#cb43-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-483"><a href="#cb43-483" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lab Part 1: Setting up your data</span></span>
<span id="cb43-484"><a href="#cb43-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-485"><a href="#cb43-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-486"><a href="#cb43-486" aria-hidden="true" tabindex="-1"></a><span class="fu">### Set up your libraries</span></span>
<span id="cb43-487"><a href="#cb43-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-490"><a href="#cb43-490" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-491"><a href="#cb43-491" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"margot"</span>)</span>
<span id="cb43-492"><a href="#cb43-492" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb43-493"><a href="#cb43-493" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb43-494"><a href="#cb43-494" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"here"</span>)</span>
<span id="cb43-495"><a href="#cb43-495" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"skimr"</span>)</span>
<span id="cb43-496"><a href="#cb43-496" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(gtsummary)) <span class="fu">install.packages</span>(<span class="st">"gtsummary"</span>)</span>
<span id="cb43-497"><a href="#cb43-497" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(janitor)) <span class="fu">install.packages</span>(<span class="st">"janitor"</span>)</span>
<span id="cb43-498"><a href="#cb43-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-499"><a href="#cb43-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-500"><a href="#cb43-500" aria-hidden="true" tabindex="-1"></a><span class="co"># if you need to update the margot package, uncomment and do this</span></span>
<span id="cb43-501"><a href="#cb43-501" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github("go-bayes/margot")</span></span>
<span id="cb43-502"><a href="#cb43-502" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-503"><a href="#cb43-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-504"><a href="#cb43-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-505"><a href="#cb43-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-506"><a href="#cb43-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-507"><a href="#cb43-507" aria-hidden="true" tabindex="-1"></a><span class="fu">### Set up a path to a folder in your directory </span></span>
<span id="cb43-508"><a href="#cb43-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-509"><a href="#cb43-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-510"><a href="#cb43-510" aria-hidden="true" tabindex="-1"></a>This will allow you to save the outputs of models and other information, which will be handy when you are producing your manuscript. Call this <span class="in">`push_mods`</span></span>
<span id="cb43-511"><a href="#cb43-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-514"><a href="#cb43-514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-515"><a href="#cb43-515" aria-hidden="true" tabindex="-1"></a><span class="do">### Set up a path to a folder in your directory </span></span>
<span id="cb43-516"><a href="#cb43-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-517"><a href="#cb43-517" aria-hidden="true" tabindex="-1"></a><span class="co"># create a folder called saved and make a path like this</span></span>
<span id="cb43-518"><a href="#cb43-518" aria-hidden="true" tabindex="-1"></a>push_mods <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'/Users/joseph/v-project\ Dropbox/data/courses/25-psych-434'</span>)</span>
<span id="cb43-519"><a href="#cb43-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-520"><a href="#cb43-520" aria-hidden="true" tabindex="-1"></a><span class="co"># view it (will be different for you)</span></span>
<span id="cb43-521"><a href="#cb43-521" aria-hidden="true" tabindex="-1"></a>push_mods</span>
<span id="cb43-522"><a href="#cb43-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-523"><a href="#cb43-523" aria-hidden="true" tabindex="-1"></a><span class="co"># another option</span></span>
<span id="cb43-524"><a href="#cb43-524" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(object, here::here(push_mods, "object"))</span></span>
<span id="cb43-525"><a href="#cb43-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-526"><a href="#cb43-526" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-527"><a href="#cb43-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-528"><a href="#cb43-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-529"><a href="#cb43-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-530"><a href="#cb43-530" aria-hidden="true" tabindex="-1"></a><span class="fu">### Initial Data Wrangling to select the study sample</span></span>
<span id="cb43-531"><a href="#cb43-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-532"><a href="#cb43-532" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Where to find variable names information</span></span>
<span id="cb43-533"><a href="#cb43-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-534"><a href="#cb43-534" aria-hidden="true" tabindex="-1"></a>Find it the data directory here: <span class="ot">&lt;https://osf.io/75snb/&gt;</span></span>
<span id="cb43-535"><a href="#cb43-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-536"><a href="#cb43-536" aria-hidden="true" tabindex="-1"></a>Also see here: <span class="ot">&lt;https://github.com/go-bayes/templates/tree/main/method&gt;</span></span>
<span id="cb43-537"><a href="#cb43-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-538"><a href="#cb43-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-539"><a href="#cb43-539" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Think, what are my eligibility criteria? </span></span>
<span id="cb43-540"><a href="#cb43-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-541"><a href="#cb43-541" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Participated in at baseline</span>
<span id="cb43-542"><a href="#cb43-542" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Participated at treatment wave</span>
<span id="cb43-543"><a href="#cb43-543" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>May have been lost to follow up at the end of the study</span>
<span id="cb43-544"><a href="#cb43-544" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Full information on the treatment variable (think about this...)</span>
<span id="cb43-545"><a href="#cb43-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-546"><a href="#cb43-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-547"><a href="#cb43-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-550"><a href="#cb43-550" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-551"><a href="#cb43-551" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(margot)</span>
<span id="cb43-552"><a href="#cb43-552" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb43-553"><a href="#cb43-553" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(table1)</span>
<span id="cb43-554"><a href="#cb43-554" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb43-555"><a href="#cb43-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-556"><a href="#cb43-556" aria-hidden="true" tabindex="-1"></a><span class="co"># eliminate haven labels</span></span>
<span id="cb43-557"><a href="#cb43-557" aria-hidden="true" tabindex="-1"></a>df_nz <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(df_nz)</span>
<span id="cb43-558"><a href="#cb43-558" aria-hidden="true" tabindex="-1"></a>df_nz <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">zap_formats</span>(df_nz)</span>
<span id="cb43-559"><a href="#cb43-559" aria-hidden="true" tabindex="-1"></a>df_nz <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">zap_label</span>(df_nz)</span>
<span id="cb43-560"><a href="#cb43-560" aria-hidden="true" tabindex="-1"></a>df_nz <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">zap_widths</span>(df_nz)</span>
<span id="cb43-561"><a href="#cb43-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-562"><a href="#cb43-562" aria-hidden="true" tabindex="-1"></a><span class="co"># name output folder</span></span>
<span id="cb43-563"><a href="#cb43-563" aria-hidden="true" tabindex="-1"></a>push_mods <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"outputs"</span>)</span>
<span id="cb43-564"><a href="#cb43-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-565"><a href="#cb43-565" aria-hidden="true" tabindex="-1"></a><span class="co"># set exposure name</span></span>
<span id="cb43-566"><a href="#cb43-566" aria-hidden="true" tabindex="-1"></a>name_exposure <span class="ot">&lt;-</span>  <span class="st">"perfectionism"</span></span>
<span id="cb43-567"><a href="#cb43-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-568"><a href="#cb43-568" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain ids for individuals who participated in 2018 and have no missing baseline exposure</span></span>
<span id="cb43-569"><a href="#cb43-569" aria-hidden="true" tabindex="-1"></a>ids_2018 <span class="ot">&lt;-</span> df_nz <span class="sc">%&gt;%</span></span>
<span id="cb43-570"><a href="#cb43-570" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">filter</span>(year_measured <span class="sc">==</span> <span class="dv">1</span>, wave <span class="sc">==</span> <span class="dv">2018</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-571"><a href="#cb43-571" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span><span class="fu">sym</span>(name_exposure))) <span class="sc">|&gt;</span> <span class="co"># criteria, no missing</span></span>
<span id="cb43-572"><a href="#cb43-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(id)</span>
<span id="cb43-573"><a href="#cb43-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-574"><a href="#cb43-574" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain ids for individuals who participated in 2019</span></span>
<span id="cb43-575"><a href="#cb43-575" aria-hidden="true" tabindex="-1"></a>ids_2019 <span class="ot">&lt;-</span> df_nz <span class="sc">%&gt;%</span></span>
<span id="cb43-576"><a href="#cb43-576" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">filter</span>(year_measured <span class="sc">==</span> <span class="dv">1</span>, wave <span class="sc">==</span> <span class="dv">2019</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-577"><a href="#cb43-577" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span><span class="fu">sym</span>(name_exposure))) <span class="sc">|&gt;</span> <span class="co"># criteria, no missing</span></span>
<span id="cb43-578"><a href="#cb43-578" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(id)</span>
<span id="cb43-579"><a href="#cb43-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-580"><a href="#cb43-580" aria-hidden="true" tabindex="-1"></a><span class="co"># intersect IDs from 2018 and 2019 to ensure participation in both years</span></span>
<span id="cb43-581"><a href="#cb43-581" aria-hidden="true" tabindex="-1"></a>ids_2018_2019 <span class="ot">&lt;-</span> <span class="fu">intersect</span>(ids_2018, ids_2019)</span>
<span id="cb43-582"><a href="#cb43-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-583"><a href="#cb43-583" aria-hidden="true" tabindex="-1"></a><span class="co"># data wrangling</span></span>
<span id="cb43-584"><a href="#cb43-584" aria-hidden="true" tabindex="-1"></a>dat_long <span class="ot">&lt;-</span> df_nz <span class="sc">|&gt;</span></span>
<span id="cb43-585"><a href="#cb43-585" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(id <span class="sc">%in%</span> ids_2018_2019 <span class="sc">&amp;</span></span>
<span id="cb43-586"><a href="#cb43-586" aria-hidden="true" tabindex="-1"></a>                  wave <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2018</span>, <span class="dv">2019</span>, <span class="dv">2020</span>)) <span class="sc">|&gt;</span></span>
<span id="cb43-587"><a href="#cb43-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(id, wave) <span class="sc">|&gt;</span></span>
<span id="cb43-588"><a href="#cb43-588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb43-589"><a href="#cb43-589" aria-hidden="true" tabindex="-1"></a>    <span class="st">"id"</span>,</span>
<span id="cb43-590"><a href="#cb43-590" aria-hidden="true" tabindex="-1"></a>    <span class="st">"wave"</span>,</span>
<span id="cb43-591"><a href="#cb43-591" aria-hidden="true" tabindex="-1"></a>    <span class="st">"year_measured"</span>,</span>
<span id="cb43-592"><a href="#cb43-592" aria-hidden="true" tabindex="-1"></a>    <span class="st">"age"</span>,</span>
<span id="cb43-593"><a href="#cb43-593" aria-hidden="true" tabindex="-1"></a>    <span class="st">"male"</span>,</span>
<span id="cb43-594"><a href="#cb43-594" aria-hidden="true" tabindex="-1"></a>    <span class="st">"born_nz"</span>,</span>
<span id="cb43-595"><a href="#cb43-595" aria-hidden="true" tabindex="-1"></a>    <span class="st">"eth_cat"</span>,</span>
<span id="cb43-596"><a href="#cb43-596" aria-hidden="true" tabindex="-1"></a>    <span class="co">#factor(EthCat, labels = c("Euro", "Maori", "Pacific", "Asian")),</span></span>
<span id="cb43-597"><a href="#cb43-597" aria-hidden="true" tabindex="-1"></a>    <span class="st">"employed"</span>,</span>
<span id="cb43-598"><a href="#cb43-598" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Are you currently employed? (this includes self-employment or casual work)</span></span>
<span id="cb43-599"><a href="#cb43-599" aria-hidden="true" tabindex="-1"></a>    <span class="st">"edu"</span>,</span>
<span id="cb43-600"><a href="#cb43-600" aria-hidden="true" tabindex="-1"></a>    <span class="co"># "gen_cohort",</span></span>
<span id="cb43-601"><a href="#cb43-601" aria-hidden="true" tabindex="-1"></a>    <span class="st">"household_inc"</span>,</span>
<span id="cb43-602"><a href="#cb43-602" aria-hidden="true" tabindex="-1"></a>    <span class="st">"partner"</span>,</span>
<span id="cb43-603"><a href="#cb43-603" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 0 = no, 1 = yes</span></span>
<span id="cb43-604"><a href="#cb43-604" aria-hidden="true" tabindex="-1"></a>    <span class="st">"parent"</span>,</span>
<span id="cb43-605"><a href="#cb43-605" aria-hidden="true" tabindex="-1"></a>    <span class="st">"alert_level_combined_lead"</span>, <span class="co"># see bibliography</span></span>
<span id="cb43-606"><a href="#cb43-606" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 0 = no, 1 = yes</span></span>
<span id="cb43-607"><a href="#cb43-607" aria-hidden="true" tabindex="-1"></a>    <span class="st">"political_conservative"</span>, <span class="co"># see nzavs sheet</span></span>
<span id="cb43-608"><a href="#cb43-608" aria-hidden="true" tabindex="-1"></a>    <span class="st">"hours_exercise"</span>, <span class="co"># see nzavs sheet</span></span>
<span id="cb43-609"><a href="#cb43-609" aria-hidden="true" tabindex="-1"></a>    <span class="st">"agreeableness"</span>, </span>
<span id="cb43-610"><a href="#cb43-610" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mini-IPIP6 Agreeableness (also modelled as empathy facet)</span></span>
<span id="cb43-611"><a href="#cb43-611" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sympathize with others' feelings.</span></span>
<span id="cb43-612"><a href="#cb43-612" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Am not interested in other people's problems.</span></span>
<span id="cb43-613"><a href="#cb43-613" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Feel others' emotions.</span></span>
<span id="cb43-614"><a href="#cb43-614" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Am not really interested in others.</span></span>
<span id="cb43-615"><a href="#cb43-615" aria-hidden="true" tabindex="-1"></a>    <span class="st">"conscientiousness"</span>,</span>
<span id="cb43-616"><a href="#cb43-616" aria-hidden="true" tabindex="-1"></a>    <span class="co"># see mini ipip6</span></span>
<span id="cb43-617"><a href="#cb43-617" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get chores done right away.</span></span>
<span id="cb43-618"><a href="#cb43-618" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Like order.</span></span>
<span id="cb43-619"><a href="#cb43-619" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make a mess of things.</span></span>
<span id="cb43-620"><a href="#cb43-620" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Often forget to put things back in their proper place.</span></span>
<span id="cb43-621"><a href="#cb43-621" aria-hidden="true" tabindex="-1"></a>    <span class="st">"extraversion"</span>,</span>
<span id="cb43-622"><a href="#cb43-622" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mini-IPIP6 Extraversion</span></span>
<span id="cb43-623"><a href="#cb43-623" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Am the life of the party.</span></span>
<span id="cb43-624"><a href="#cb43-624" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Don't talk a lot.</span></span>
<span id="cb43-625"><a href="#cb43-625" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep in the background.</span></span>
<span id="cb43-626"><a href="#cb43-626" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Talk to a lot of different people at parties.</span></span>
<span id="cb43-627"><a href="#cb43-627" aria-hidden="true" tabindex="-1"></a>    <span class="st">"honesty_humility"</span>,</span>
<span id="cb43-628"><a href="#cb43-628" aria-hidden="true" tabindex="-1"></a>    <span class="co"># see mini ipip6</span></span>
<span id="cb43-629"><a href="#cb43-629" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Would like to be seen driving around in a very expensive car.</span></span>
<span id="cb43-630"><a href="#cb43-630" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Would get a lot of pleasure from owning expensive luxury goods.</span></span>
<span id="cb43-631"><a href="#cb43-631" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Feel entitled to more of everything.</span></span>
<span id="cb43-632"><a href="#cb43-632" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Deserve more things in life.</span></span>
<span id="cb43-633"><a href="#cb43-633" aria-hidden="true" tabindex="-1"></a>    <span class="st">"openness"</span>,</span>
<span id="cb43-634"><a href="#cb43-634" aria-hidden="true" tabindex="-1"></a>    <span class="co"># see mini ipip6</span></span>
<span id="cb43-635"><a href="#cb43-635" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Have a vivid imagination.</span></span>
<span id="cb43-636"><a href="#cb43-636" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Have difficulty understanding abstract ideas.</span></span>
<span id="cb43-637"><a href="#cb43-637" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Do not have a good imagination.</span></span>
<span id="cb43-638"><a href="#cb43-638" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Am not interested in abstract ideas.</span></span>
<span id="cb43-639"><a href="#cb43-639" aria-hidden="true" tabindex="-1"></a>    <span class="st">"neuroticism"</span>,</span>
<span id="cb43-640"><a href="#cb43-640" aria-hidden="true" tabindex="-1"></a>    <span class="co"># see mini ipip6</span></span>
<span id="cb43-641"><a href="#cb43-641" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Have frequent mood swings.</span></span>
<span id="cb43-642"><a href="#cb43-642" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Am relaxed most of the time.</span></span>
<span id="cb43-643"><a href="#cb43-643" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get upset easily.</span></span>
<span id="cb43-644"><a href="#cb43-644" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Seldom feel blue.</span></span>
<span id="cb43-645"><a href="#cb43-645" aria-hidden="true" tabindex="-1"></a>    <span class="st">"modesty"</span>,</span>
<span id="cb43-646"><a href="#cb43-646" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # see mini ipip6</span></span>
<span id="cb43-647"><a href="#cb43-647" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # I want people to know that I am an important person of high status,</span></span>
<span id="cb43-648"><a href="#cb43-648" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # I am an ordinary person who is no better than others.</span></span>
<span id="cb43-649"><a href="#cb43-649" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # I wouldn’t want people to treat me as though I were superior to them.</span></span>
<span id="cb43-650"><a href="#cb43-650" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # I think that I am entitled to more respect than the average person is</span></span>
<span id="cb43-651"><a href="#cb43-651" aria-hidden="true" tabindex="-1"></a>    <span class="co">#"w_gend_age_ethnic",</span></span>
<span id="cb43-652"><a href="#cb43-652" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sample_weights"</span>, <span class="co"># see nzavs sheet</span></span>
<span id="cb43-653"><a href="#cb43-653" aria-hidden="true" tabindex="-1"></a>    <span class="st">"neighbourhood_community"</span>,</span>
<span id="cb43-654"><a href="#cb43-654" aria-hidden="true" tabindex="-1"></a>    <span class="co"># #I feel a sense of community with others in my local neighbourhood.</span></span>
<span id="cb43-655"><a href="#cb43-655" aria-hidden="true" tabindex="-1"></a>    <span class="st">"belong"</span>, <span class="co"># see nzavs sheet</span></span>
<span id="cb43-656"><a href="#cb43-656" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rural_gch_2018_l"</span>,<span class="co"># see nzavs sheet</span></span>
<span id="cb43-657"><a href="#cb43-657" aria-hidden="true" tabindex="-1"></a>    <span class="st">"support"</span>,</span>
<span id="cb43-658"><a href="#cb43-658" aria-hidden="true" tabindex="-1"></a>    <span class="co"># "support_help",</span></span>
<span id="cb43-659"><a href="#cb43-659" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # 'There are people I can depend on to help me if I really need it.</span></span>
<span id="cb43-660"><a href="#cb43-660" aria-hidden="true" tabindex="-1"></a>    <span class="co"># "support_turnto",</span></span>
<span id="cb43-661"><a href="#cb43-661" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # There is no one I can turn to for guidance in times of stress.</span></span>
<span id="cb43-662"><a href="#cb43-662" aria-hidden="true" tabindex="-1"></a>    <span class="co"># "support_rnoguidance",</span></span>
<span id="cb43-663"><a href="#cb43-663" aria-hidden="true" tabindex="-1"></a>    <span class="co">#There is no one I can turn to for guidance in times of stress.</span></span>
<span id="cb43-664"><a href="#cb43-664" aria-hidden="true" tabindex="-1"></a>    <span class="st">"perfectionism"</span>,</span>
<span id="cb43-665"><a href="#cb43-665" aria-hidden="true" tabindex="-1"></a>    <span class="st">"religion_religious"</span>,</span>
<span id="cb43-666"><a href="#cb43-666" aria-hidden="true" tabindex="-1"></a>    <span class="st">"kessler_latent_depression"</span>,</span>
<span id="cb43-667"><a href="#cb43-667" aria-hidden="true" tabindex="-1"></a>    <span class="st">"kessler_latent_anxiety"</span></span>
<span id="cb43-668"><a href="#cb43-668" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb43-669"><a href="#cb43-669" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb43-670"><a href="#cb43-670" aria-hidden="true" tabindex="-1"></a>    <span class="co">#initialize 'censored'</span></span>
<span id="cb43-671"><a href="#cb43-671" aria-hidden="true" tabindex="-1"></a>    <span class="at">censored =</span> <span class="fu">ifelse</span>(<span class="fu">lead</span>(year_measured) <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb43-672"><a href="#cb43-672" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-673"><a href="#cb43-673" aria-hidden="true" tabindex="-1"></a>    <span class="co"># modify 'censored' based on the condition; no need to check for NA here as 'censored' is already defined in the previous step</span></span>
<span id="cb43-674"><a href="#cb43-674" aria-hidden="true" tabindex="-1"></a>    <span class="at">censored =</span>  <span class="fu">ifelse</span>(<span class="fu">is.na</span>(censored) <span class="sc">&amp;</span></span>
<span id="cb43-675"><a href="#cb43-675" aria-hidden="true" tabindex="-1"></a>                         year_measured <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, censored)</span>
<span id="cb43-676"><a href="#cb43-676" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb43-677"><a href="#cb43-677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>year_measured) <span class="sc">|&gt;</span></span>
<span id="cb43-678"><a href="#cb43-678" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb43-679"><a href="#cb43-679" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rescale these variables, to get all variables on a similar scale</span></span>
<span id="cb43-680"><a href="#cb43-680" aria-hidden="true" tabindex="-1"></a>    <span class="co"># otherwise your models can blow up, or become uninterpretable. </span></span>
<span id="cb43-681"><a href="#cb43-681" aria-hidden="true" tabindex="-1"></a>    <span class="at">household_inc_log =</span> <span class="fu">log</span>(household_inc <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb43-682"><a href="#cb43-682" aria-hidden="true" tabindex="-1"></a>    <span class="at">hours_exercise_log =</span> <span class="fu">log</span>(hours_exercise <span class="sc">+</span> <span class="dv">1</span>)  ) <span class="sc">|&gt;</span></span>
<span id="cb43-683"><a href="#cb43-683" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb43-684"><a href="#cb43-684" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="fu">c</span>(</span>
<span id="cb43-685"><a href="#cb43-685" aria-hidden="true" tabindex="-1"></a>      household_inc,</span>
<span id="cb43-686"><a href="#cb43-686" aria-hidden="true" tabindex="-1"></a>      hours_exercise)</span>
<span id="cb43-687"><a href="#cb43-687" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb43-688"><a href="#cb43-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>() <span class="sc">|&gt;</span></span>
<span id="cb43-689"><a href="#cb43-689" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dplyr::rename(sample_weights = w_gend_age_ethnic,</span></span>
<span id="cb43-690"><a href="#cb43-690" aria-hidden="true" tabindex="-1"></a>  <span class="co">#               sample_origin =  sample_origin_names_combined) |&gt;</span></span>
<span id="cb43-691"><a href="#cb43-691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(id, wave) <span class="sc">|&gt;</span></span>
<span id="cb43-692"><a href="#cb43-692" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb43-693"><a href="#cb43-693" aria-hidden="true" tabindex="-1"></a>  <span class="at">rural_gch_2018_l =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(rural_gch_2018_l)),</span>
<span id="cb43-694"><a href="#cb43-694" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   parent = as.numeric(as.character(parent)),</span></span>
<span id="cb43-695"><a href="#cb43-695" aria-hidden="true" tabindex="-1"></a>  <span class="at">partner =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(partner)),</span>
<span id="cb43-696"><a href="#cb43-696" aria-hidden="true" tabindex="-1"></a>  <span class="at">born_nz =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(born_nz)),</span>
<span id="cb43-697"><a href="#cb43-697" aria-hidden="true" tabindex="-1"></a>  <span class="at">censored =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(censored)),</span>
<span id="cb43-698"><a href="#cb43-698" aria-hidden="true" tabindex="-1"></a>  <span class="at">employed =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(employed))</span>
<span id="cb43-699"><a href="#cb43-699" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb43-700"><a href="#cb43-700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>() <span class="sc">|&gt;</span></span>
<span id="cb43-701"><a href="#cb43-701" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb43-702"><a href="#cb43-702" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>() <span class="sc">|&gt;</span></span>
<span id="cb43-703"><a href="#cb43-703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(id, wave) <span class="sc">|&gt;</span></span>
<span id="cb43-704"><a href="#cb43-704" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>()</span>
<span id="cb43-705"><a href="#cb43-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-706"><a href="#cb43-706" aria-hidden="true" tabindex="-1"></a><span class="co"># check n in this sample</span></span>
<span id="cb43-707"><a href="#cb43-707" aria-hidden="true" tabindex="-1"></a>n_participants <span class="ot">&lt;-</span> skimr<span class="sc">::</span><span class="fu">n_unique</span>(dat_long<span class="sc">$</span>id)</span>
<span id="cb43-708"><a href="#cb43-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-709"><a href="#cb43-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-710"><a href="#cb43-710" aria-hidden="true" tabindex="-1"></a><span class="co"># make number pretty</span></span>
<span id="cb43-711"><a href="#cb43-711" aria-hidden="true" tabindex="-1"></a>n_participants<span class="ot">&lt;-</span> <span class="fu">prettyNum</span>(n_participants,<span class="at">big.mark=</span><span class="st">","</span>)</span>
<span id="cb43-712"><a href="#cb43-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-713"><a href="#cb43-713" aria-hidden="true" tabindex="-1"></a><span class="co"># save this so that you can use it in your manuscript</span></span>
<span id="cb43-714"><a href="#cb43-714" aria-hidden="true" tabindex="-1"></a>margot<span class="sc">::</span><span class="fu">here_save</span>(n_participants, <span class="st">"n_participants"</span>)</span>
<span id="cb43-715"><a href="#cb43-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-716"><a href="#cb43-716" aria-hidden="true" tabindex="-1"></a><span class="co"># try reading </span></span>
<span id="cb43-717"><a href="#cb43-717" aria-hidden="true" tabindex="-1"></a>n_participants_did_it_work_question_mark <span class="ot">&lt;-</span> margot<span class="sc">::</span><span class="fu">here_read</span>(<span class="st">"n_participants"</span>)</span>
<span id="cb43-718"><a href="#cb43-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-719"><a href="#cb43-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-720"><a href="#cb43-720" aria-hidden="true" tabindex="-1"></a><span class="co"># view</span></span>
<span id="cb43-721"><a href="#cb43-721" aria-hidden="true" tabindex="-1"></a><span class="co"># n_participants_did_it_work_question_mark</span></span>
<span id="cb43-722"><a href="#cb43-722" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-723"><a href="#cb43-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-724"><a href="#cb43-724" aria-hidden="true" tabindex="-1"></a>There are N = <span class="in">`r n_participants_did_it_work_question_mark`</span> participants.</span>
<span id="cb43-725"><a href="#cb43-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-726"><a href="#cb43-726" aria-hidden="true" tabindex="-1"></a><span class="fu">### Define your baseline covariates, treatment (exposure), and outcome</span></span>
<span id="cb43-727"><a href="#cb43-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-728"><a href="#cb43-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-731"><a href="#cb43-731" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-732"><a href="#cb43-732" aria-hidden="true" tabindex="-1"></a><span class="co"># for example </span></span>
<span id="cb43-733"><a href="#cb43-733" aria-hidden="true" tabindex="-1"></a>baseline_vars <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"male"</span>, <span class="st">"edu"</span>, <span class="st">"eth_cat"</span>, <span class="st">"partner"</span>, <span class="st">"employed"</span>, <span class="st">"born_nz"</span>, <span class="st">"neighbourhood_community"</span>, <span class="st">"household_inc_log"</span>,</span>
<span id="cb43-734"><a href="#cb43-734" aria-hidden="true" tabindex="-1"></a><span class="st">"parent"</span>, <span class="st">"religion_religious"</span>, <span class="st">"rural_gch_2018_l"</span>,<span class="st">"sample_weights"</span>, <span class="st">"employed"</span>, <span class="st">"alert_level_combined_lead"</span>)</span>
<span id="cb43-735"><a href="#cb43-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-736"><a href="#cb43-736" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment</span></span>
<span id="cb43-737"><a href="#cb43-737" aria-hidden="true" tabindex="-1"></a>exposure_var <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"perfectionism"</span>, <span class="st">"censored"</span>) <span class="co"># we will use the censored variable later</span></span>
<span id="cb43-738"><a href="#cb43-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-739"><a href="#cb43-739" aria-hidden="true" tabindex="-1"></a><span class="co"># outcome, can be many</span></span>
<span id="cb43-740"><a href="#cb43-740" aria-hidden="true" tabindex="-1"></a>outcome_vars <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"kessler_latent_anxiety"</span>, <span class="st">"kessler_latent_depression"</span>)</span>
<span id="cb43-741"><a href="#cb43-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-742"><a href="#cb43-742" aria-hidden="true" tabindex="-1"></a><span class="co"># define waves</span></span>
<span id="cb43-743"><a href="#cb43-743" aria-hidden="true" tabindex="-1"></a>baseline_wave <span class="ot">=</span> <span class="st">"2018"</span></span>
<span id="cb43-744"><a href="#cb43-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-745"><a href="#cb43-745" aria-hidden="true" tabindex="-1"></a><span class="co"># exposure waves</span></span>
<span id="cb43-746"><a href="#cb43-746" aria-hidden="true" tabindex="-1"></a>exposure_waves <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"2018"</span>,<span class="st">"2019"</span>)</span>
<span id="cb43-747"><a href="#cb43-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-748"><a href="#cb43-748" aria-hidden="true" tabindex="-1"></a><span class="co">#outcome wave</span></span>
<span id="cb43-749"><a href="#cb43-749" aria-hidden="true" tabindex="-1"></a>outcome_wave <span class="ot">=</span> <span class="st">"2020"</span></span>
<span id="cb43-750"><a href="#cb43-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-751"><a href="#cb43-751" aria-hidden="true" tabindex="-1"></a><span class="co"># exoposure</span></span>
<span id="cb43-752"><a href="#cb43-752" aria-hidden="true" tabindex="-1"></a>name_exposure <span class="ot">=</span> <span class="st">"perfectionism"</span></span>
<span id="cb43-753"><a href="#cb43-753" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-754"><a href="#cb43-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-755"><a href="#cb43-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-756"><a href="#cb43-756" aria-hidden="true" tabindex="-1"></a><span class="fu">### Make your baseline table</span></span>
<span id="cb43-757"><a href="#cb43-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-758"><a href="#cb43-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-759"><a href="#cb43-759" aria-hidden="true" tabindex="-1"></a><span class="fu">### Make tables</span></span>
<span id="cb43-760"><a href="#cb43-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-761"><a href="#cb43-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-762"><a href="#cb43-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-765"><a href="#cb43-765" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-766"><a href="#cb43-766" aria-hidden="true" tabindex="-1"></a>tables <span class="ot">&lt;-</span> margot<span class="sc">::</span><span class="fu">margot_summary_tables</span>(dat_long, </span>
<span id="cb43-767"><a href="#cb43-767" aria-hidden="true" tabindex="-1"></a><span class="at">exposure_waves =</span> exposure_waves, </span>
<span id="cb43-768"><a href="#cb43-768" aria-hidden="true" tabindex="-1"></a><span class="at">baseline_wave =</span> baseline_wave, </span>
<span id="cb43-769"><a href="#cb43-769" aria-hidden="true" tabindex="-1"></a><span class="at">outcome_wave =</span> outcome_wave, </span>
<span id="cb43-770"><a href="#cb43-770" aria-hidden="true" tabindex="-1"></a><span class="at">name_exposure =</span> name_exposure, </span>
<span id="cb43-771"><a href="#cb43-771" aria-hidden="true" tabindex="-1"></a><span class="at">baseline_vars =</span> baseline_vars, </span>
<span id="cb43-772"><a href="#cb43-772" aria-hidden="true" tabindex="-1"></a><span class="at">outcome_vars =</span> outcome_vars)</span>
<span id="cb43-773"><a href="#cb43-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-774"><a href="#cb43-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-775"><a href="#cb43-775" aria-hidden="true" tabindex="-1"></a><span class="co"># save tables</span></span>
<span id="cb43-776"><a href="#cb43-776" aria-hidden="true" tabindex="-1"></a><span class="co"># margot::here_save_qs(table_exposures, "table_exposures", push_mods)</span></span>
<span id="cb43-777"><a href="#cb43-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-778"><a href="#cb43-778" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-779"><a href="#cb43-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-780"><a href="#cb43-780" aria-hidden="true" tabindex="-1"></a><span class="fu">## Baseline table</span></span>
<span id="cb43-781"><a href="#cb43-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-784"><a href="#cb43-784" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-785"><a href="#cb43-785" aria-hidden="true" tabindex="-1"></a>tables<span class="sc">$</span>baseline_table</span>
<span id="cb43-786"><a href="#cb43-786" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-787"><a href="#cb43-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-788"><a href="#cb43-788" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exposure table</span></span>
<span id="cb43-789"><a href="#cb43-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-792"><a href="#cb43-792" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-793"><a href="#cb43-793" aria-hidden="true" tabindex="-1"></a><span class="co"># tables$exposure_tables</span></span>
<span id="cb43-794"><a href="#cb43-794" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-795"><a href="#cb43-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-796"><a href="#cb43-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-797"><a href="#cb43-797" aria-hidden="true" tabindex="-1"></a><span class="fu"># Outcome table</span></span>
<span id="cb43-798"><a href="#cb43-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-801"><a href="#cb43-801" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-802"><a href="#cb43-802" aria-hidden="true" tabindex="-1"></a>tables<span class="sc">$</span>outcome_table</span>
<span id="cb43-803"><a href="#cb43-803" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-804"><a href="#cb43-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-805"><a href="#cb43-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-806"><a href="#cb43-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-807"><a href="#cb43-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-808"><a href="#cb43-808" aria-hidden="true" tabindex="-1"></a><span class="fu">### Inspect the distribution of the exposure in treatment wave</span></span>
<span id="cb43-809"><a href="#cb43-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-812"><a href="#cb43-812" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-813"><a href="#cb43-813" aria-hidden="true" tabindex="-1"></a><span class="co"># select 2019 wave</span></span>
<span id="cb43-814"><a href="#cb43-814" aria-hidden="true" tabindex="-1"></a>dt_19 <span class="ot">&lt;-</span> dat_long <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(wave <span class="sc">==</span> <span class="dv">2019</span>)</span>
<span id="cb43-815"><a href="#cb43-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-816"><a href="#cb43-816" aria-hidden="true" tabindex="-1"></a><span class="co"># mean</span></span>
<span id="cb43-817"><a href="#cb43-817" aria-hidden="true" tabindex="-1"></a>mean_exposure <span class="ot">&lt;-</span><span class="fu">mean</span>(dt_19<span class="sc">$</span>perfectionism, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb43-818"><a href="#cb43-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-819"><a href="#cb43-819" aria-hidden="true" tabindex="-1"></a><span class="co"># median</span></span>
<span id="cb43-820"><a href="#cb43-820" aria-hidden="true" tabindex="-1"></a>median_exposure <span class="ot">&lt;-</span><span class="fu">median</span>(dt_19<span class="sc">$</span>perfectionism, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb43-821"><a href="#cb43-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-822"><a href="#cb43-822" aria-hidden="true" tabindex="-1"></a><span class="co"># check if you like</span></span>
<span id="cb43-823"><a href="#cb43-823" aria-hidden="true" tabindex="-1"></a><span class="co"># median_exposure</span></span>
<span id="cb43-824"><a href="#cb43-824" aria-hidden="true" tabindex="-1"></a><span class="co"># mean_exposure</span></span>
<span id="cb43-825"><a href="#cb43-825" aria-hidden="true" tabindex="-1"></a><span class="co"># generate bar plot</span></span>
<span id="cb43-826"><a href="#cb43-826" aria-hidden="true" tabindex="-1"></a>graph_density_of_exposure_up <span class="ot">&lt;-</span> margot<span class="sc">::</span><span class="fu">margot_plot_shift</span>(</span>
<span id="cb43-827"><a href="#cb43-827" aria-hidden="true" tabindex="-1"></a>  dt_19,</span>
<span id="cb43-828"><a href="#cb43-828" aria-hidden="true" tabindex="-1"></a>  <span class="at">shift =</span> <span class="st">"up"</span>,</span>
<span id="cb43-829"><a href="#cb43-829" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_name =</span> <span class="st">"perfectionism"</span>,</span>
<span id="cb43-830"><a href="#cb43-830" aria-hidden="true" tabindex="-1"></a>  <span class="at">binwidth =</span> .<span class="dv">25</span>, </span>
<span id="cb43-831"><a href="#cb43-831" aria-hidden="true" tabindex="-1"></a>  <span class="at">range_highlight =</span> <span class="fu">c</span>(<span class="dv">0</span>,mean_exposure)</span>
<span id="cb43-832"><a href="#cb43-832" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-833"><a href="#cb43-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-834"><a href="#cb43-834" aria-hidden="true" tabindex="-1"></a><span class="co"># show</span></span>
<span id="cb43-835"><a href="#cb43-835" aria-hidden="true" tabindex="-1"></a>graph_density_of_exposure_up</span>
<span id="cb43-836"><a href="#cb43-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-837"><a href="#cb43-837" aria-hidden="true" tabindex="-1"></a><span class="co"># save</span></span>
<span id="cb43-838"><a href="#cb43-838" aria-hidden="true" tabindex="-1"></a><span class="co">#margot::here_save(graph_density_of_exposure_up, "graph_density_of_exposure_up")</span></span>
<span id="cb43-839"><a href="#cb43-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-840"><a href="#cb43-840" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-841"><a href="#cb43-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-842"><a href="#cb43-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-843"><a href="#cb43-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-844"><a href="#cb43-844" aria-hidden="true" tabindex="-1"></a><span class="fu">### Check for change in the treatment (Positivity)</span></span>
<span id="cb43-845"><a href="#cb43-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-848"><a href="#cb43-848" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-849"><a href="#cb43-849" aria-hidden="true" tabindex="-1"></a><span class="co">#  select data from wave 18 and 19 </span></span>
<span id="cb43-850"><a href="#cb43-850" aria-hidden="true" tabindex="-1"></a>dt_18_19_positivity <span class="ot">&lt;-</span> dat_long <span class="sc">|&gt;</span></span>
<span id="cb43-851"><a href="#cb43-851" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(wave <span class="sc">==</span> <span class="dv">2018</span> <span class="sc">|</span> wave <span class="sc">==</span> <span class="dv">2019</span>) <span class="sc">|&gt;</span></span>
<span id="cb43-852"><a href="#cb43-852" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">perfectionism_round =</span> <span class="fu">round</span>(perfectionism, <span class="at">digits =</span> <span class="dv">0</span>)) <span class="sc">|&gt;</span></span>
<span id="cb43-853"><a href="#cb43-853" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(perfectionism_round, id, wave) <span class="sc">|&gt;</span></span>
<span id="cb43-854"><a href="#cb43-854" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>()</span>
<span id="cb43-855"><a href="#cb43-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-856"><a href="#cb43-856" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span>margot<span class="sc">::</span><span class="fu">margot_transition_table</span>(<span class="at">data =</span> dt_18_19_positivity, <span class="at">state_var =</span> <span class="st">"perfectionism_round"</span>, <span class="at">id_var =</span> <span class="st">"id"</span>, <span class="at">wave_var =</span> <span class="st">"wave"</span>)</span>
<span id="cb43-857"><a href="#cb43-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-858"><a href="#cb43-858" aria-hidden="true" tabindex="-1"></a><span class="co"># table</span></span>
<span id="cb43-859"><a href="#cb43-859" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>tables[[<span class="dv">1</span>]]</span>
<span id="cb43-860"><a href="#cb43-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-861"><a href="#cb43-861" aria-hidden="true" tabindex="-1"></a><span class="co"># for import later</span></span>
<span id="cb43-862"><a href="#cb43-862" aria-hidden="true" tabindex="-1"></a><span class="co"># margot::here_save(transition_table, "transition_table")</span></span>
<span id="cb43-863"><a href="#cb43-863" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-864"><a href="#cb43-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-865"><a href="#cb43-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-866"><a href="#cb43-866" aria-hidden="true" tabindex="-1"></a><span class="fu">### Explanation for the table</span></span>
<span id="cb43-867"><a href="#cb43-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-870"><a href="#cb43-870" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-871"><a href="#cb43-871" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(out<span class="sc">$</span>explanation)</span>
<span id="cb43-872"><a href="#cb43-872" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-873"><a href="#cb43-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-874"><a href="#cb43-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-875"><a href="#cb43-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-876"><a href="#cb43-876" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lab Part 2: Simulation to Clarify Why The Distribution of Effect Modifiers Matter For Estimating Treatment Effects </span></span>
<span id="cb43-877"><a href="#cb43-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-878"><a href="#cb43-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-879"><a href="#cb43-879" aria-hidden="true" tabindex="-1"></a>First, we load the <span class="in">`stdReg`</span> library, which obtains marginal effect estimates by simulating counterfactuals under different levels of treatment <span class="co">[</span><span class="ot">@sjölander2016</span><span class="co">]</span>. If a treatment is continuous, the levels can be specified. </span>
<span id="cb43-880"><a href="#cb43-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-881"><a href="#cb43-881" aria-hidden="true" tabindex="-1"></a>We also load the <span class="in">`parameters`</span> library, which creates nice tables <span class="co">[</span><span class="ot">@parameters2020</span><span class="co">]</span>.</span>
<span id="cb43-882"><a href="#cb43-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-883"><a href="#cb43-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-886"><a href="#cb43-886" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-887"><a href="#cb43-887" aria-hidden="true" tabindex="-1"></a><span class="co"># to obtain marginal effects</span></span>
<span id="cb43-888"><a href="#cb43-888" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stdReg)</span>
<span id="cb43-889"><a href="#cb43-889" aria-hidden="true" tabindex="-1"></a><span class="co"># to create nice tables</span></span>
<span id="cb43-890"><a href="#cb43-890" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parameters)</span>
<span id="cb43-891"><a href="#cb43-891" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-892"><a href="#cb43-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-893"><a href="#cb43-893" aria-hidden="true" tabindex="-1"></a>Next, we write a function to simulate data for the sample and and target populations. </span>
<span id="cb43-894"><a href="#cb43-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-895"><a href="#cb43-895" aria-hidden="true" tabindex="-1"></a>We assume the treatment effect is the same in the sample and target population. We will assume that the coefficient for the effect-modifier and the coefficient for interaction are the same.  We assume no unmeasured confounding throughout the study.  We assume only selective attrition of one effect modifier such that the baseline population differs from the sample population at the end of the study.   </span>
<span id="cb43-896"><a href="#cb43-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-897"><a href="#cb43-897" aria-hidden="true" tabindex="-1"></a>That is: **the distribution of effect modifiers is the only respect in which the sample will differ from the target population.**</span>
<span id="cb43-898"><a href="#cb43-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-899"><a href="#cb43-899" aria-hidden="true" tabindex="-1"></a>This function will generate data under a range of scenarios.<span class="ot">[^margot]</span></span>
<span id="cb43-900"><a href="#cb43-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-901"><a href="#cb43-901" aria-hidden="true" tabindex="-1"></a><span class="ot">[^margot]: </span>See documentation in the <span class="in">`margot`</span> package: @margot2024</span>
<span id="cb43-902"><a href="#cb43-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-903"><a href="#cb43-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-904"><a href="#cb43-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-907"><a href="#cb43-907" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-908"><a href="#cb43-908" aria-hidden="true" tabindex="-1"></a><span class="co"># function to generate data for the sample and population, </span></span>
<span id="cb43-909"><a href="#cb43-909" aria-hidden="true" tabindex="-1"></a><span class="co"># along with precise sample weights for the population, there are differences </span></span>
<span id="cb43-910"><a href="#cb43-910" aria-hidden="true" tabindex="-1"></a><span class="co"># in the distribution of the true effect modifier but no differences in the treatment effect </span></span>
<span id="cb43-911"><a href="#cb43-911" aria-hidden="true" tabindex="-1"></a><span class="co"># or the effect modification.all that differs between the sample and the population is </span></span>
<span id="cb43-912"><a href="#cb43-912" aria-hidden="true" tabindex="-1"></a><span class="co"># the distribution of effect-modifiers.</span></span>
<span id="cb43-913"><a href="#cb43-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-914"><a href="#cb43-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-915"><a href="#cb43-915" aria-hidden="true" tabindex="-1"></a><span class="co"># reproducability</span></span>
<span id="cb43-916"><a href="#cb43-916" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb43-917"><a href="#cb43-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-918"><a href="#cb43-918" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate the data -- you can use different parameters</span></span>
<span id="cb43-919"><a href="#cb43-919" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> margot<span class="sc">::</span><span class="fu">simulate_ate_data_with_weights</span>(</span>
<span id="cb43-920"><a href="#cb43-920" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_sample =</span> <span class="dv">10000</span>,</span>
<span id="cb43-921"><a href="#cb43-921" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_population =</span> <span class="dv">100000</span>,</span>
<span id="cb43-922"><a href="#cb43-922" aria-hidden="true" tabindex="-1"></a>  <span class="at">p_z_sample =</span> <span class="fl">0.1</span>,</span>
<span id="cb43-923"><a href="#cb43-923" aria-hidden="true" tabindex="-1"></a>  <span class="at">p_z_population =</span> <span class="fl">0.5</span>,</span>
<span id="cb43-924"><a href="#cb43-924" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_a =</span> <span class="dv">1</span>,</span>
<span id="cb43-925"><a href="#cb43-925" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_z =</span> <span class="fl">2.5</span>,</span>
<span id="cb43-926"><a href="#cb43-926" aria-hidden="true" tabindex="-1"></a>  <span class="at">noise_sd =</span> <span class="fl">0.5</span></span>
<span id="cb43-927"><a href="#cb43-927" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-928"><a href="#cb43-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-929"><a href="#cb43-929" aria-hidden="true" tabindex="-1"></a><span class="co"># view</span></span>
<span id="cb43-930"><a href="#cb43-930" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data)</span>
<span id="cb43-931"><a href="#cb43-931" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-932"><a href="#cb43-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-933"><a href="#cb43-933" aria-hidden="true" tabindex="-1"></a>Ok, we have generated both sample and population data. </span>
<span id="cb43-934"><a href="#cb43-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-935"><a href="#cb43-935" aria-hidden="true" tabindex="-1"></a>Next, we verify that the distributions of effect modifiers differ in the sample and in the target population:</span>
<span id="cb43-936"><a href="#cb43-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-939"><a href="#cb43-939" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-940"><a href="#cb43-940" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain the generated data</span></span>
<span id="cb43-941"><a href="#cb43-941" aria-hidden="true" tabindex="-1"></a>sample_data <span class="ot">&lt;-</span> data<span class="sc">$</span>sample_data</span>
<span id="cb43-942"><a href="#cb43-942" aria-hidden="true" tabindex="-1"></a>population_data <span class="ot">&lt;-</span> data<span class="sc">$</span>population_data</span>
<span id="cb43-943"><a href="#cb43-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-944"><a href="#cb43-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-945"><a href="#cb43-945" aria-hidden="true" tabindex="-1"></a><span class="co"># check imbalance</span></span>
<span id="cb43-946"><a href="#cb43-946" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(sample_data<span class="sc">$</span>z_sample) <span class="co"># type 1 is rare</span></span>
<span id="cb43-947"><a href="#cb43-947" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(population_data<span class="sc">$</span>z_population) <span class="co"># type 1 is common</span></span>
<span id="cb43-948"><a href="#cb43-948" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-949"><a href="#cb43-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-950"><a href="#cb43-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-951"><a href="#cb43-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-952"><a href="#cb43-952" aria-hidden="true" tabindex="-1"></a>Good, the distributions differ. The simulation is working as intended.</span>
<span id="cb43-953"><a href="#cb43-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-954"><a href="#cb43-954" aria-hidden="true" tabindex="-1"></a>Next, consider the question: "What are the differences in the coefficients that we obtain from the study population at the end of study, as compared with the target population?"  </span>
<span id="cb43-955"><a href="#cb43-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-956"><a href="#cb43-956" aria-hidden="true" tabindex="-1"></a>First, we obtain the coefficients for the sample. They are as follows:</span>
<span id="cb43-957"><a href="#cb43-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-958"><a href="#cb43-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-961"><a href="#cb43-961" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-962"><a href="#cb43-962" aria-hidden="true" tabindex="-1"></a><span class="co"># model coefficients sample</span></span>
<span id="cb43-963"><a href="#cb43-963" aria-hidden="true" tabindex="-1"></a>model_sample  <span class="ot">&lt;-</span></span>
<span id="cb43-964"><a href="#cb43-964" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(y_sample <span class="sc">~</span> a_sample <span class="sc">*</span> z_sample, <span class="at">data =</span> sample_data)</span>
<span id="cb43-965"><a href="#cb43-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-966"><a href="#cb43-966" aria-hidden="true" tabindex="-1"></a><span class="co"># summary</span></span>
<span id="cb43-967"><a href="#cb43-967" aria-hidden="true" tabindex="-1"></a>parameters<span class="sc">::</span><span class="fu">model_parameters</span>(model_sample, <span class="at">ci_method =</span> <span class="st">"wald"</span>)</span>
<span id="cb43-968"><a href="#cb43-968" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-969"><a href="#cb43-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-970"><a href="#cb43-970" aria-hidden="true" tabindex="-1"></a>Ok, let's obtain the coefficients for the weighted regression of the sample.   Notice that the coefficients are virtually the same:</span>
<span id="cb43-971"><a href="#cb43-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-974"><a href="#cb43-974" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-975"><a href="#cb43-975" aria-hidden="true" tabindex="-1"></a><span class="co"># model the sample weighted to the population, again note that these coefficients are similar </span></span>
<span id="cb43-976"><a href="#cb43-976" aria-hidden="true" tabindex="-1"></a>model_weighted_sample <span class="ot">&lt;-</span></span>
<span id="cb43-977"><a href="#cb43-977" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(y_sample <span class="sc">~</span>  a_sample  <span class="sc">*</span> z_sample,</span>
<span id="cb43-978"><a href="#cb43-978" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> sample_data,</span>
<span id="cb43-979"><a href="#cb43-979" aria-hidden="true" tabindex="-1"></a>      <span class="at">weights =</span> weights)</span>
<span id="cb43-980"><a href="#cb43-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-981"><a href="#cb43-981" aria-hidden="true" tabindex="-1"></a><span class="co"># summary</span></span>
<span id="cb43-982"><a href="#cb43-982" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(parameters<span class="sc">::</span><span class="fu">model_parameters</span>(model_weighted_sample, <span class="at">ci_method =</span></span>
<span id="cb43-983"><a href="#cb43-983" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"wald"</span>))</span>
<span id="cb43-984"><a href="#cb43-984" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-985"><a href="#cb43-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-986"><a href="#cb43-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-987"><a href="#cb43-987" aria-hidden="true" tabindex="-1"></a>We might be tempted to infer that weighting wasn't relevant to the analysis. However, we'll see that such an interpretation would be a mistake.</span>
<span id="cb43-988"><a href="#cb43-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-989"><a href="#cb43-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-990"><a href="#cb43-990" aria-hidden="true" tabindex="-1"></a>Next, let us obtain model coefficients for the population. Note again there is no difference -- only narrower errors owing to the large sample size. </span>
<span id="cb43-991"><a href="#cb43-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-992"><a href="#cb43-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-995"><a href="#cb43-995" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-996"><a href="#cb43-996" aria-hidden="true" tabindex="-1"></a><span class="co"># model coefficients population -- note that these coefficients are very similar. </span></span>
<span id="cb43-997"><a href="#cb43-997" aria-hidden="true" tabindex="-1"></a>model_population <span class="ot">&lt;-</span></span>
<span id="cb43-998"><a href="#cb43-998" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(y_population <span class="sc">~</span> a_population <span class="sc">*</span> z_population, <span class="at">data =</span> population_data)</span>
<span id="cb43-999"><a href="#cb43-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1000"><a href="#cb43-1000" aria-hidden="true" tabindex="-1"></a>parameters<span class="sc">::</span><span class="fu">model_parameters</span>(model_population, <span class="at">ci_method =</span> <span class="st">"wald"</span>)</span>
<span id="cb43-1001"><a href="#cb43-1001" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-1002"><a href="#cb43-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1003"><a href="#cb43-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1004"><a href="#cb43-1004" aria-hidden="true" tabindex="-1"></a>Again, there is no difference. That is, we find that all model coefficients are practically equivalent. The different distribution of effect modifiers does not result in different coefficient values for the treatment effect, the effect-modifier "effect," or the interaction of effect modifier and treatment. </span>
<span id="cb43-1005"><a href="#cb43-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1006"><a href="#cb43-1006" aria-hidden="true" tabindex="-1"></a>Consider why this is the case: in a large sample where the causal effects are invariant -- as we have simulated them to be -- we will have good replication in the effect modifiers within the sample, so our statistical model can recover the *coefficients* for the population -- no problem. </span>
<span id="cb43-1007"><a href="#cb43-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1008"><a href="#cb43-1008" aria-hidden="true" tabindex="-1"></a>However, **in causal inference, we are interested in obtaining the marginal effect of the treatment**. That is, we seek an estimate for the counterfactual contrast in which everyone in a pre-specified population was subject to one level of treatment compared with a counterfactual condition in which everyone in a population was subject to another level of the same treatment. **When the sample population differs in the distribution of effect modifiers from the target population effect, the marginal effect estimates will typically differ.**</span>
<span id="cb43-1009"><a href="#cb43-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1010"><a href="#cb43-1010" aria-hidden="true" tabindex="-1"></a>To see this, we use the <span class="in">`stdReg`</span> package to recover marginal effect estimates, comparing (1) the sample ATE, (2) the true oracle ATE for the population, and (3) the weighted sample ATE.  We will use the outputs of the same models above. The only difference is that we will calculate marginal effects from these outputs. We will contrast a difference from an intervention in which everyone receives treatment = 0 with one in which everyone receives treatment = 1, however, this choice is arbitrary, and the general lessons apply irrespective of the estimand.</span>
<span id="cb43-1011"><a href="#cb43-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1012"><a href="#cb43-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1013"><a href="#cb43-1013" aria-hidden="true" tabindex="-1"></a>First, consider this ATE for the sample population. </span>
<span id="cb43-1014"><a href="#cb43-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1015"><a href="#cb43-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1016"><a href="#cb43-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1019"><a href="#cb43-1019" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-1020"><a href="#cb43-1020" aria-hidden="true" tabindex="-1"></a><span class="co"># What inference do we draw?  We cannot say the models are unbiased for the marginal effect estimates. </span></span>
<span id="cb43-1021"><a href="#cb43-1021" aria-hidden="true" tabindex="-1"></a><span class="co"># regression standardisation </span></span>
<span id="cb43-1022"><a href="#cb43-1022" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stdReg) <span class="co"># to obtain marginal effects </span></span>
<span id="cb43-1023"><a href="#cb43-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1024"><a href="#cb43-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1025"><a href="#cb43-1025" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain sample ate</span></span>
<span id="cb43-1026"><a href="#cb43-1026" aria-hidden="true" tabindex="-1"></a>fit_std_sample <span class="ot">&lt;-</span></span>
<span id="cb43-1027"><a href="#cb43-1027" aria-hidden="true" tabindex="-1"></a>  stdReg<span class="sc">::</span><span class="fu">stdGlm</span>(model_sample, <span class="at">data =</span> sample_data, <span class="at">X =</span> <span class="st">"a_sample"</span>)</span>
<span id="cb43-1028"><a href="#cb43-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1029"><a href="#cb43-1029" aria-hidden="true" tabindex="-1"></a><span class="co"># summary</span></span>
<span id="cb43-1030"><a href="#cb43-1030" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_std_sample,</span>
<span id="cb43-1031"><a href="#cb43-1031" aria-hidden="true" tabindex="-1"></a>        <span class="at">contrast =</span> <span class="st">"difference"</span>,</span>
<span id="cb43-1032"><a href="#cb43-1032" aria-hidden="true" tabindex="-1"></a>        <span class="at">reference =</span> <span class="dv">0</span>)</span>
<span id="cb43-1033"><a href="#cb43-1033" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-1034"><a href="#cb43-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1035"><a href="#cb43-1035" aria-hidden="true" tabindex="-1"></a>The treatment effect is given as a 1.06 unit change in the outcome across the sample population, with a confidence interval from 1.04 to 1.08. </span>
<span id="cb43-1036"><a href="#cb43-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1037"><a href="#cb43-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1038"><a href="#cb43-1038" aria-hidden="true" tabindex="-1"></a>Next, we obtain the true (oracle) treatment effect for the population under the same intervention.</span>
<span id="cb43-1039"><a href="#cb43-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1040"><a href="#cb43-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1043"><a href="#cb43-1043" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-1044"><a href="#cb43-1044" aria-hidden="true" tabindex="-1"></a><span class="do">## note the population effect is different</span></span>
<span id="cb43-1045"><a href="#cb43-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1046"><a href="#cb43-1046" aria-hidden="true" tabindex="-1"></a><span class="co">#obtain true ate</span></span>
<span id="cb43-1047"><a href="#cb43-1047" aria-hidden="true" tabindex="-1"></a>fit_std_population <span class="ot">&lt;-</span></span>
<span id="cb43-1048"><a href="#cb43-1048" aria-hidden="true" tabindex="-1"></a>  stdReg<span class="sc">::</span><span class="fu">stdGlm</span>(model_population, <span class="at">data =</span> population_data, <span class="at">X =</span> <span class="st">"a_population"</span>)</span>
<span id="cb43-1049"><a href="#cb43-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1050"><a href="#cb43-1050" aria-hidden="true" tabindex="-1"></a><span class="co"># summary</span></span>
<span id="cb43-1051"><a href="#cb43-1051" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_std_population,</span>
<span id="cb43-1052"><a href="#cb43-1052" aria-hidden="true" tabindex="-1"></a>        <span class="at">contrast =</span> <span class="st">"difference"</span>,</span>
<span id="cb43-1053"><a href="#cb43-1053" aria-hidden="true" tabindex="-1"></a>        <span class="at">reference =</span> <span class="dv">0</span>)</span>
<span id="cb43-1054"><a href="#cb43-1054" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-1055"><a href="#cb43-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1056"><a href="#cb43-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1057"><a href="#cb43-1057" aria-hidden="true" tabindex="-1"></a>Note, the true treatment effect is a 1.25 unit change in the population, with a confidence bound between 1.24 and 1.26. This is well outside the ATE that we obtain from the sample population!</span>
<span id="cb43-1058"><a href="#cb43-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1059"><a href="#cb43-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1060"><a href="#cb43-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1061"><a href="#cb43-1061" aria-hidden="true" tabindex="-1"></a>Next, consider the ATE in the weighted regression, where the sample was weighted to the target population's true distribution of effect modifiers. </span>
<span id="cb43-1062"><a href="#cb43-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1063"><a href="#cb43-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1066"><a href="#cb43-1066" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-1067"><a href="#cb43-1067" aria-hidden="true" tabindex="-1"></a><span class="do">## next try weights adjusted ate where we correctly assign population weights to the sample</span></span>
<span id="cb43-1068"><a href="#cb43-1068" aria-hidden="true" tabindex="-1"></a>fit_std_weighted_sample_weights <span class="ot">&lt;-</span> stdReg<span class="sc">::</span><span class="fu">stdGlm</span>( model_weighted_sample, </span>
<span id="cb43-1069"><a href="#cb43-1069" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sample_data, </span>
<span id="cb43-1070"><a href="#cb43-1070" aria-hidden="true" tabindex="-1"></a>    <span class="at">X =</span> <span class="st">"a_sample"</span>)</span>
<span id="cb43-1071"><a href="#cb43-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1072"><a href="#cb43-1072" aria-hidden="true" tabindex="-1"></a><span class="co"># this gives us the right answer</span></span>
<span id="cb43-1073"><a href="#cb43-1073" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_std_weighted_sample_weights, </span>
<span id="cb43-1074"><a href="#cb43-1074" aria-hidden="true" tabindex="-1"></a>    <span class="at">contrast =</span> <span class="st">"difference"</span>, </span>
<span id="cb43-1075"><a href="#cb43-1075" aria-hidden="true" tabindex="-1"></a>    <span class="at">reference =</span> <span class="dv">0</span>)</span>
<span id="cb43-1076"><a href="#cb43-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1077"><a href="#cb43-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1078"><a href="#cb43-1078" aria-hidden="true" tabindex="-1"></a><span class="co"># moral of the story. when we marginalise over the entire sample we need to weight estimates to the target population. </span></span>
<span id="cb43-1079"><a href="#cb43-1079" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-1080"><a href="#cb43-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1081"><a href="#cb43-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1082"><a href="#cb43-1082" aria-hidden="true" tabindex="-1"></a>We find that we obtain the population-level causal effect estimate with accurate coverage by weighting the sample to the target population. So with appropriate weights, our results generalise from the sample to the target population.</span>
<span id="cb43-1083"><a href="#cb43-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1084"><a href="#cb43-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1085"><a href="#cb43-1085" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lessons from Lab 2</span></span>
<span id="cb43-1086"><a href="#cb43-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1087"><a href="#cb43-1087" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Regression coefficients do not clarify the problem of sample/target population mismatch -- or selection bias as discussed in this manuscript.</span>
<span id="cb43-1088"><a href="#cb43-1088" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The correct advice to investigators is that they should not rely on regression coefficients when evaluating the biases that arise from sample attrition. This advice applies to both methods that the authors use to investigate threats of bias. That is, to implement this advice, the authors must first take it.</span>
<span id="cb43-1089"><a href="#cb43-1089" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Generally, observed data are insufficient for assessing threats. Observed data do not clarify structural sources of bias, nor do they clarify effect-modification in the full counterfactual data condition in which all receive the treatment and all do not receive the treatment (at the same level).</span>
<span id="cb43-1090"><a href="#cb43-1090" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To properly assess bias, one would need access to the counterfactual outcome—what would have happened to the missing participants had they not been lost to follow-up or had they responded. Again, the join distributions over "full data" are inherently unobservable <span class="co">[</span><span class="ot">@vanderlaan2011</span><span class="co">]</span>. </span>
<span id="cb43-1091"><a href="#cb43-1091" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In simple settings like the one we just simulated, we may address the gap between the sample and target population using methods such as modelling the censoring (e.g., censoring weighting). However, we never know what setting we are in or whether it is simple—such modelling must be handled with care. There is a large and growing epidemiology literature on this topic (see, for example, @li2023non).</span>
<span id="cb43-1092"><a href="#cb43-1092" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- - Matters become more complex when there is confounding and selection bias because the problem is not merely one of external validity but also internal validity (i.e. obtaining valid causal effect estimates for the baseline sample). See for example @scharfstein1999adjusting; @laan2003unified; @howe2016selection (note that @howe2016selection, "selection" bias is defined as collider stratification bias, a variety of confounding bias and not simple sample and target population mismatch.)   --&gt;</span></span>
<span id="cb43-1093"><a href="#cb43-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1094"><a href="#cb43-1094" aria-hidden="true" tabindex="-1"></a><span class="fu">## Appendix A: Simplification of Additive Interaction Formula</span></span>
<span id="cb43-1095"><a href="#cb43-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1096"><a href="#cb43-1096" aria-hidden="true" tabindex="-1"></a>We start with the definition of additive interaction based on comparing the joint effect relative to baseline versus the sum of individual effects relative to baseline:</span>
<span id="cb43-1097"><a href="#cb43-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1098"><a href="#cb43-1098" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-1099"><a href="#cb43-1099" aria-hidden="true" tabindex="-1"></a>\Big(\mathbb{E}<span class="co">[</span><span class="ot">Y(1,1)</span><span class="co">]</span> - \mathbb{E}<span class="co">[</span><span class="ot">Y(0,0)</span><span class="co">]</span>\Big) - \Big<span class="co">[</span><span class="ot">\Big(\mathbb{E}[Y(1,0)] - \mathbb{E}[Y(0,0)]\Big) + \Big(\mathbb{E}[Y(0,1)] - \mathbb{E}[Y(0,0)]\Big)\Big</span><span class="co">]</span></span>
<span id="cb43-1100"><a href="#cb43-1100" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-1101"><a href="#cb43-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1102"><a href="#cb43-1102" aria-hidden="true" tabindex="-1"></a>First, distribute the negative sign across the terms within the square brackets:</span>
<span id="cb43-1103"><a href="#cb43-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1104"><a href="#cb43-1104" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-1105"><a href="#cb43-1105" aria-hidden="true" tabindex="-1"></a>\mathbb{E}<span class="co">[</span><span class="ot">Y(1,1)</span><span class="co">]</span> - \mathbb{E}<span class="co">[</span><span class="ot">Y(0,0)</span><span class="co">]</span> - \Big(\mathbb{E}<span class="co">[</span><span class="ot">Y(1,0)</span><span class="co">]</span> - \mathbb{E}<span class="co">[</span><span class="ot">Y(0,0)</span><span class="co">]</span>\Big) - \Big(\mathbb{E}<span class="co">[</span><span class="ot">Y(0,1)</span><span class="co">]</span> - \mathbb{E}<span class="co">[</span><span class="ot">Y(0,0)</span><span class="co">]</span>\Big)</span>
<span id="cb43-1106"><a href="#cb43-1106" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-1107"><a href="#cb43-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1108"><a href="#cb43-1108" aria-hidden="true" tabindex="-1"></a>Now remove the parentheses, flipping the signs inside them where preceded by a minus sign:</span>
<span id="cb43-1109"><a href="#cb43-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1110"><a href="#cb43-1110" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-1111"><a href="#cb43-1111" aria-hidden="true" tabindex="-1"></a>\mathbb{E}<span class="co">[</span><span class="ot">Y(1,1)</span><span class="co">]</span> - \mathbb{E}<span class="co">[</span><span class="ot">Y(0,0)</span><span class="co">]</span> - \mathbb{E}<span class="co">[</span><span class="ot">Y(1,0)</span><span class="co">]</span> + \mathbb{E}<span class="co">[</span><span class="ot">Y(0,0)</span><span class="co">]</span> - \mathbb{E}<span class="co">[</span><span class="ot">Y(0,1)</span><span class="co">]</span> + \mathbb{E}<span class="co">[</span><span class="ot">Y(0,0)</span><span class="co">]</span></span>
<span id="cb43-1112"><a href="#cb43-1112" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-1113"><a href="#cb43-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1114"><a href="#cb43-1114" aria-hidden="true" tabindex="-1"></a>Next, combine the $\mathbb{E}<span class="co">[</span><span class="ot">Y(0,0)</span><span class="co">]</span>$ terms:</span>
<span id="cb43-1115"><a href="#cb43-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1116"><a href="#cb43-1116" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>We have $-\mathbb{E}<span class="co">[</span><span class="ot">Y(0,0)</span><span class="co">]</span>$</span>
<span id="cb43-1117"><a href="#cb43-1117" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Then $+\mathbb{E}<span class="co">[</span><span class="ot">Y(0,0)</span><span class="co">]</span>$ (these two cancel each other out)</span>
<span id="cb43-1118"><a href="#cb43-1118" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>And another $+\mathbb{E}<span class="co">[</span><span class="ot">Y(0,0)</span><span class="co">]</span>$ remains.</span>
<span id="cb43-1119"><a href="#cb43-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1120"><a href="#cb43-1120" aria-hidden="true" tabindex="-1"></a>The expression simplifies to:</span>
<span id="cb43-1121"><a href="#cb43-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1122"><a href="#cb43-1122" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-1123"><a href="#cb43-1123" aria-hidden="true" tabindex="-1"></a>\mathbb{E}<span class="co">[</span><span class="ot">Y(1,1)</span><span class="co">]</span> - \mathbb{E}<span class="co">[</span><span class="ot">Y(1,0)</span><span class="co">]</span> - \mathbb{E}<span class="co">[</span><span class="ot">Y(0,1)</span><span class="co">]</span> + \mathbb{E}<span class="co">[</span><span class="ot">Y(0,0)</span><span class="co">]</span></span>
<span id="cb43-1124"><a href="#cb43-1124" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-1125"><a href="#cb43-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1126"><a href="#cb43-1126" aria-hidden="true" tabindex="-1"></a>This is the standard definition of additive interaction, often called the interaction contrast. If this expression equals zero, there is no additive interaction; a non-zero value indicates an interaction effect.</span>
<span id="cb43-1127"><a href="#cb43-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1128"><a href="#cb43-1128" aria-hidden="true" tabindex="-1"></a>**This shows clearly that interaction is measured as the deviation of the joint effect from the sum of the separate effects, adjusted for the baseline.**</span>
<span id="cb43-1129"><a href="#cb43-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1130"><a href="#cb43-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1131"><a href="#cb43-1131" aria-hidden="true" tabindex="-1"></a><span class="fu">## Appendix B</span></span>
<span id="cb43-1132"><a href="#cb43-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1133"><a href="#cb43-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1134"><a href="#cb43-1134" aria-hidden="true" tabindex="-1"></a><span class="fu">### Evidence for effect-modification is relative to inclusion of other variables in the model</span></span>
<span id="cb43-1135"><a href="#cb43-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1136"><a href="#cb43-1136" aria-hidden="true" tabindex="-1"></a>The 'sharp-null hypothesis' states there is no effect of the exposure on</span>
<span id="cb43-1137"><a href="#cb43-1137" aria-hidden="true" tabindex="-1"></a>the outcome for any unit in the target population. Unless the 'sharp-null hypothesis' is false, there may be effect-modification. For any study worth conducting, we cannot evaluate whether the sharp-null hypothesis is false. If we could the experiment would be otiose. Therefore, we must assume the possibility of effect-modification. Notably, whether a variable is an effect-modifier also depends on which other variables are included in the model. That is, just as for the concept of a 'confounder', where a variable is an 'effect-modifier' cannot be stated without reference to an assumed causal order and an explicit statement about which other variables will be included in the model <span class="co">[</span><span class="ot">@vanderweele2012</span><span class="co">]</span>.</span>
<span id="cb43-1138"><a href="#cb43-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1139"><a href="#cb43-1139" aria-hidden="true" tabindex="-1"></a>As illustrated in  @fig-eff-mod-rel, the marginal association between $A$ and $Y$ is unbiased. Here, exposure $A$ is unconditionally associated with $Y$. Recall our convention <span class="dt">&lt;</span><span class="kw">svg</span><span class="ot"> width</span><span class="op">=</span><span class="st">"40px"</span><span class="ot"> height</span><span class="op">=</span><span class="st">"40px"</span><span class="dt">&gt;&lt;</span><span class="kw">circle</span><span class="ot"> cx</span><span class="op">=</span><span class="st">"20"</span><span class="ot"> cy</span><span class="op">=</span><span class="st">"20"</span><span class="ot"> r</span><span class="op">=</span><span class="st">"18"</span><span class="ot"> fill</span><span class="op">=</span><span class="st">"none"</span><span class="ot"> stroke</span><span class="op">=</span><span class="st">"blue"</span><span class="ot"> stroke-width</span><span class="op">=</span><span class="st">"2"</span><span class="dt">/&gt;&lt;</span><span class="kw">text</span><span class="ot"> x</span><span class="op">=</span><span class="st">"20"</span><span class="ot"> y</span><span class="op">=</span><span class="st">"20"</span><span class="ot"> alignment-baseline</span><span class="op">=</span><span class="st">"middle"</span><span class="ot"> text-anchor</span><span class="op">=</span><span class="st">"middle"</span><span class="ot"> fill</span><span class="op">=</span><span class="st">"blue"</span><span class="ot"> font-size</span><span class="op">=</span><span class="st">"16"</span><span class="dt">&gt;</span>G<span class="dt">&lt;/</span><span class="kw">text</span><span class="dt">&gt;&lt;/</span><span class="kw">svg</span><span class="dt">&gt;</span> denotes effect-modification with conditioning and <span class="dt">&lt;</span><span class="kw">svg</span><span class="ot"> width</span><span class="op">=</span><span class="st">"40px"</span><span class="ot"> height</span><span class="op">=</span><span class="st">"40px"</span><span class="dt">&gt;&lt;</span><span class="kw">circle</span><span class="ot"> cx</span><span class="op">=</span><span class="st">"20"</span><span class="ot"> cy</span><span class="op">=</span><span class="st">"20"</span><span class="ot"> r</span><span class="op">=</span><span class="st">"18"</span><span class="ot"> fill</span><span class="op">=</span><span class="st">"none"</span><span class="ot"> stroke</span><span class="op">=</span><span class="st">"blue"</span><span class="ot"> stroke-width</span><span class="op">=</span><span class="st">"2"</span><span class="ot"> stroke-dasharray</span><span class="op">=</span><span class="st">"4,4"</span><span class="dt">/&gt;&lt;</span><span class="kw">text</span><span class="ot"> x</span><span class="op">=</span><span class="st">"20"</span><span class="ot"> y</span><span class="op">=</span><span class="st">"20"</span><span class="ot"> alignment-baseline</span><span class="op">=</span><span class="st">"middle"</span><span class="ot"> text-anchor</span><span class="op">=</span><span class="st">"middle"</span><span class="ot"> fill</span><span class="op">=</span><span class="st">"blue"</span><span class="ot"> font-size</span><span class="op">=</span><span class="st">"16"</span><span class="dt">&gt;</span>Z<span class="dt">&lt;/</span><span class="kw">text</span><span class="dt">&gt;&lt;/</span><span class="kw">svg</span><span class="dt">&gt;</span> indicates effect-modification without conditioning.</span>
<span id="cb43-1140"><a href="#cb43-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1143"><a href="#cb43-1143" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz}</span></span>
<span id="cb43-1144"><a href="#cb43-1144" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-eff-mod-rel</span></span>
<span id="cb43-1145"><a href="#cb43-1145" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Consider a randomised experiment. There is no confounding. Here, the marginal association between A and Y provides an unbiased estimate for the causal effect of A on Y. Does the conditional association of A on Y vary within levels of G? The causal diagram allows for a classification of G as an effect modifier of A on Y by proxy. G modifies A's effect on Y in virtue of G's relationship to Z, which, according to this graph, is a direct effect modifier for the effect of A on Y."</span></span>
<span id="cb43-1146"><a href="#cb43-1146" aria-hidden="true" tabindex="-1"></a><span class="in">#| out-width: 80%</span></span>
<span id="cb43-1147"><a href="#cb43-1147" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb43-1148"><a href="#cb43-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1149"><a href="#cb43-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1150"><a href="#cb43-1150" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb43-1151"><a href="#cb43-1151" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{shapes.geometric}</span></span>
<span id="cb43-1152"><a href="#cb43-1152" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{arrows}</span></span>
<span id="cb43-1153"><a href="#cb43-1153" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{decorations}</span></span>
<span id="cb43-1154"><a href="#cb43-1154" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzstyle{Arrow} = [-&gt;, thin, preaction = {decorate}]</span></span>
<span id="cb43-1155"><a href="#cb43-1155" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzset{&gt;=latex}</span></span>
<span id="cb43-1156"><a href="#cb43-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1157"><a href="#cb43-1157" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning, shapes.geometric, arrows.meta, decorations.pathmorphing}</span></span>
<span id="cb43-1158"><a href="#cb43-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1159"><a href="#cb43-1159" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzset{</span></span>
<span id="cb43-1160"><a href="#cb43-1160" aria-hidden="true" tabindex="-1"></a><span class="in">  Arrow/.style={-&gt;, &gt;=latex, line width=0.4pt},  % Defines a generic arrow style</span></span>
<span id="cb43-1161"><a href="#cb43-1161" aria-hidden="true" tabindex="-1"></a><span class="in">  emod/.style={rectangle, fill=blue!10, draw=blue, thick, minimum size=6mm},</span></span>
<span id="cb43-1162"><a href="#cb43-1162" aria-hidden="true" tabindex="-1"></a><span class="in">  emoddot/.style={circle, fill=blue!10, draw=blue, dotted, thick, minimum size=6mm}</span></span>
<span id="cb43-1163"><a href="#cb43-1163" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb43-1164"><a href="#cb43-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1165"><a href="#cb43-1165" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[{every node/.append style}=draw, emod/.style={rectangle, fill=blue!10,draw=blue, thick},</span></span>
<span id="cb43-1166"><a href="#cb43-1166" aria-hidden="true" tabindex="-1"></a><span class="in">emoddot/.style={circle, fill=blue!10, draw=blue, dotted}]</span></span>
<span id="cb43-1167"><a href="#cb43-1167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1168"><a href="#cb43-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1169"><a href="#cb43-1169" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (A) at (0, 0) {A$_{1}$};</span></span>
<span id="cb43-1170"><a href="#cb43-1170" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (Y) at (2, 0) {Y$_{2}$};</span></span>
<span id="cb43-1171"><a href="#cb43-1171" aria-hidden="true" tabindex="-1"></a><span class="in">\node [emoddot] (Z) at (-3,0) {Z};</span></span>
<span id="cb43-1172"><a href="#cb43-1172" aria-hidden="true" tabindex="-1"></a><span class="in">\node [emod] (G) at (-1, 0) {G};</span></span>
<span id="cb43-1173"><a href="#cb43-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1174"><a href="#cb43-1174" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black] (A) to (Y);</span></span>
<span id="cb43-1175"><a href="#cb43-1175" aria-hidden="true" tabindex="-1"></a><span class="in">\draw[-{Circle[open, fill=none]}, line width=0.25pt, draw=blue, bend left = 40]  (Z) to (Y);</span></span>
<span id="cb43-1176"><a href="#cb43-1176" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw = blue] (Z) to (G);</span></span>
<span id="cb43-1177"><a href="#cb43-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1178"><a href="#cb43-1178" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture} </span></span>
<span id="cb43-1179"><a href="#cb43-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1180"><a href="#cb43-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1181"><a href="#cb43-1181" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-1182"><a href="#cb43-1182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1183"><a href="#cb43-1183" aria-hidden="true" tabindex="-1"></a>@fig-dag-effect-modificationb presents the same a randomised experiment as in the previous causal diagram. We again assume that there is no confounding of the marginal association between the exposure, $A$, and the outcome, $Y$. However, suppose we were to adjust for $Z$ and ask, does the conditional association of $A$ on $Y$ vary within levels of $G$, after adjusting for $Z$? That is, does $G$ remain an effect-modifier of the exposure on the outcome? @vanderweele2007 proved that for effect-modification to occur, at least one other arrow besides the treatment must enter into the outcome. According to @fig-dag-effect-modificationb the only arrow into $Y$ other than $A$ arrives from $Z$. Because $Y$ is independent of $G$ conditional on $Z$ we may infer that $G$ is no longer an effect modifier for the effect of $A$ on $Y$. Viewed another way, $G$ no longer co-varies with $Y$</span>
<span id="cb43-1184"><a href="#cb43-1184" aria-hidden="true" tabindex="-1"></a>conditional on $Z$ and so cannot act as an effect-modifier.</span>
<span id="cb43-1185"><a href="#cb43-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1188"><a href="#cb43-1188" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz}</span></span>
<span id="cb43-1189"><a href="#cb43-1189" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-dag-effect-modificationb</span></span>
<span id="cb43-1190"><a href="#cb43-1190" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Conditioning on Z renders G independent of Y. G is no longer an effect modifier after conditioning on Z because G is independent of Y. Although Z is an unconditional effect modifier, G is not."</span></span>
<span id="cb43-1191"><a href="#cb43-1191" aria-hidden="true" tabindex="-1"></a><span class="in">#| out-width: 80%</span></span>
<span id="cb43-1192"><a href="#cb43-1192" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb43-1193"><a href="#cb43-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1194"><a href="#cb43-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1195"><a href="#cb43-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1196"><a href="#cb43-1196" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb43-1197"><a href="#cb43-1197" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{shapes.geometric}</span></span>
<span id="cb43-1198"><a href="#cb43-1198" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{arrows}</span></span>
<span id="cb43-1199"><a href="#cb43-1199" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{decorations}</span></span>
<span id="cb43-1200"><a href="#cb43-1200" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzstyle{Arrow} = [-&gt;, thin, preaction = {decorate}]</span></span>
<span id="cb43-1201"><a href="#cb43-1201" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzset{&gt;=latex}</span></span>
<span id="cb43-1202"><a href="#cb43-1202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1203"><a href="#cb43-1203" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning, shapes.geometric, arrows.meta, decorations.pathmorphing}</span></span>
<span id="cb43-1204"><a href="#cb43-1204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1205"><a href="#cb43-1205" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzset{</span></span>
<span id="cb43-1206"><a href="#cb43-1206" aria-hidden="true" tabindex="-1"></a><span class="in">  Arrow/.style={-&gt;, &gt;=latex, line width=0.4pt},  % Defines a generic arrow style</span></span>
<span id="cb43-1207"><a href="#cb43-1207" aria-hidden="true" tabindex="-1"></a><span class="in">  emod/.style={rectangle, fill=blue!10, draw=blue, thick, minimum size=6mm},</span></span>
<span id="cb43-1208"><a href="#cb43-1208" aria-hidden="true" tabindex="-1"></a><span class="in">  emoddot/.style={circle, fill=blue!10, draw=blue, dotted, thick, minimum size=6mm}</span></span>
<span id="cb43-1209"><a href="#cb43-1209" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb43-1210"><a href="#cb43-1210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1211"><a href="#cb43-1211" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[{every node/.append style}=draw, emod/.style={rectangle, fill=blue!10,draw=blue, thick},</span></span>
<span id="cb43-1212"><a href="#cb43-1212" aria-hidden="true" tabindex="-1"></a><span class="in">squarednode/.style={rectangle, draw=blue!60, fill=red!20, very thick, minimum size=5mm}]</span></span>
<span id="cb43-1213"><a href="#cb43-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1214"><a href="#cb43-1214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1215"><a href="#cb43-1215" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (A) at (0, 0) {A$_{1}$};</span></span>
<span id="cb43-1216"><a href="#cb43-1216" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (Y) at (2, 0) {Y$_{2}$};</span></span>
<span id="cb43-1217"><a href="#cb43-1217" aria-hidden="true" tabindex="-1"></a><span class="in">\node [emod] (Z) at (-3,0) {Z};</span></span>
<span id="cb43-1218"><a href="#cb43-1218" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (G) at (-1, 0) {G};</span></span>
<span id="cb43-1219"><a href="#cb43-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1220"><a href="#cb43-1220" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black] (A) to (Y);</span></span>
<span id="cb43-1221"><a href="#cb43-1221" aria-hidden="true" tabindex="-1"></a><span class="in">\draw[-{Circle[open, fill=none]}, line width=0.25pt, draw=blue, bend left = 40] (Z) to (Y);</span></span>
<span id="cb43-1222"><a href="#cb43-1222" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw = black] (Z) to (G);</span></span>
<span id="cb43-1223"><a href="#cb43-1223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1224"><a href="#cb43-1224" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture} </span></span>
<span id="cb43-1225"><a href="#cb43-1225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1226"><a href="#cb43-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1227"><a href="#cb43-1227" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-1228"><a href="#cb43-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1229"><a href="#cb43-1229" aria-hidden="true" tabindex="-1"></a>@fig-dag-effect-modificationc presents the same a randomised experiment as in the previous graph. We assume a true effect of $A \rightarrow Y$. If we do not condition on $B$, then $G$ will not modify the effect of $A  \rightarrow Y$ because $G$ will not be associated with $Y$. However, if we were to condition on $B$, then both $B$ (an effect modifier by proxy) and $G$ may become effect-modifiers for the causal effect of $A$ on $Y$. In this setting, both $B$ and $G$ are conditional effect-modifiers.</span>
<span id="cb43-1230"><a href="#cb43-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1231"><a href="#cb43-1231" aria-hidden="true" tabindex="-1"></a>Note that casual graphs help us to evaluate classifications of conditional and unconditional effect modifiers. They may also help to clarify conditions in which conditioning on unconditional effect-modifiers may remove conditional effect-modification. However we cannot not tell from a causal diagram whether the ancestors of an</span>
<span id="cb43-1232"><a href="#cb43-1232" aria-hidden="true" tabindex="-1"></a>unconditional effect-modifier will be conditional effect-modifiers for the effect of the exposure on the outcome; see: @vanderweele2007, also @suzuki2013counterfactual. Causal diagrams express non-parametric relations. I have adopted an off-label colouring convention to denote instances of effect-modification to highlight possible pathways for effect-modification, which may be relative to other variables in a model.</span>
<span id="cb43-1233"><a href="#cb43-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1236"><a href="#cb43-1236" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz}</span></span>
<span id="cb43-1237"><a href="#cb43-1237" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-dag-effect-modificationc</span></span>
<span id="cb43-1238"><a href="#cb43-1238" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Blue path denotes effect-modification for G by conditioning on B. Both B and G are conditional effect modifiers."</span></span>
<span id="cb43-1239"><a href="#cb43-1239" aria-hidden="true" tabindex="-1"></a><span class="in">#| out-width: 80%</span></span>
<span id="cb43-1240"><a href="#cb43-1240" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb43-1241"><a href="#cb43-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1242"><a href="#cb43-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1243"><a href="#cb43-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1244"><a href="#cb43-1244" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb43-1245"><a href="#cb43-1245" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{shapes.geometric}</span></span>
<span id="cb43-1246"><a href="#cb43-1246" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{arrows}</span></span>
<span id="cb43-1247"><a href="#cb43-1247" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{decorations}</span></span>
<span id="cb43-1248"><a href="#cb43-1248" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzstyle{Arrow} = [-&gt;, thin, preaction = {decorate}]</span></span>
<span id="cb43-1249"><a href="#cb43-1249" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzset{&gt;=latex}</span></span>
<span id="cb43-1250"><a href="#cb43-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1251"><a href="#cb43-1251" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning, shapes.geometric, arrows.meta, decorations.pathmorphing}</span></span>
<span id="cb43-1252"><a href="#cb43-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1253"><a href="#cb43-1253" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzset{</span></span>
<span id="cb43-1254"><a href="#cb43-1254" aria-hidden="true" tabindex="-1"></a><span class="in">  Arrow/.style={-&gt;, &gt;=latex, line width=0.4pt},  % Defines a generic arrow style</span></span>
<span id="cb43-1255"><a href="#cb43-1255" aria-hidden="true" tabindex="-1"></a><span class="in">  emod/.style={rectangle, fill=blue!10, draw=blue, thick, minimum size=6mm},</span></span>
<span id="cb43-1256"><a href="#cb43-1256" aria-hidden="true" tabindex="-1"></a><span class="in">  emoddot/.style={circle, fill=blue!10, draw=blue, dotted, thick, minimum size=6mm}</span></span>
<span id="cb43-1257"><a href="#cb43-1257" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb43-1258"><a href="#cb43-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1259"><a href="#cb43-1259" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[{every node/.append style}=draw, emod/.style={rectangle, fill=blue!10,draw=blue, thick},</span></span>
<span id="cb43-1260"><a href="#cb43-1260" aria-hidden="true" tabindex="-1"></a><span class="in">squarednode/.style={rectangle, draw=blue!60, fill=red!20, very thick, minimum size=5mm}]</span></span>
<span id="cb43-1261"><a href="#cb43-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1262"><a href="#cb43-1262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1263"><a href="#cb43-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1264"><a href="#cb43-1264" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (A) at (1, 0) {A$_{1}$};</span></span>
<span id="cb43-1265"><a href="#cb43-1265" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (Y) at (3, 0) {Y$_{2}$};</span></span>
<span id="cb43-1266"><a href="#cb43-1266" aria-hidden="true" tabindex="-1"></a><span class="in">\node [emoddot, dotted, draw=blue, bend left = 40] (Z) at (-2, 1) {Z};</span></span>
<span id="cb43-1267"><a href="#cb43-1267" aria-hidden="true" tabindex="-1"></a><span class="in">\node [emod] (G) at (-2, -1) {G};</span></span>
<span id="cb43-1268"><a href="#cb43-1268" aria-hidden="true" tabindex="-1"></a><span class="in">\node [emod] (B) at (-1,0) {B};</span></span>
<span id="cb43-1269"><a href="#cb43-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1270"><a href="#cb43-1270" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black] (A) to (Y);</span></span>
<span id="cb43-1271"><a href="#cb43-1271" aria-hidden="true" tabindex="-1"></a><span class="in">\draw[-{Circle[open, fill=none]}, line width=0.25pt, draw=blue, bend left = 20] (Z) to (Y);</span></span>
<span id="cb43-1272"><a href="#cb43-1272" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=blue] (Z) to (B);</span></span>
<span id="cb43-1273"><a href="#cb43-1273" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=blue] (G) to (B);</span></span>
<span id="cb43-1274"><a href="#cb43-1274" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture} </span></span>
<span id="cb43-1275"><a href="#cb43-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1276"><a href="#cb43-1276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-1277"><a href="#cb43-1277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1278"><a href="#cb43-1278" aria-hidden="true" tabindex="-1"></a>@fig-dag-effect-modificationd reveals the relativity of effect-modification. If investigators do not condition on $B$, then $G$</span>
<span id="cb43-1279"><a href="#cb43-1279" aria-hidden="true" tabindex="-1"></a>cannot be a conditional effect-modifier because $G$ would then be independent of $Z$ because $B$ is a collider. However, as we observed in</span>
<span id="cb43-1280"><a href="#cb43-1280" aria-hidden="true" tabindex="-1"></a>@fig-dag-effect-modificationc, conditioning on $B$, a collider, may open a path for effect-modification of $G$ by $Z$. Both $B$ and $G$ are</span>
<span id="cb43-1281"><a href="#cb43-1281" aria-hidden="true" tabindex="-1"></a>conditional effect modifiers.</span>
<span id="cb43-1282"><a href="#cb43-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1285"><a href="#cb43-1285" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz}</span></span>
<span id="cb43-1286"><a href="#cb43-1286" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-dag-effect-modificationd</span></span>
<span id="cb43-1287"><a href="#cb43-1287" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Blue path denotes effect-modification. Here G is not an effect modifier because B, a common effect (collider) of G and Z, is not conditioned on. Any conditional effect modification for G would require conditioning on B, and not-conditioning on G. Otherwise G will be d-separated from Y."</span></span>
<span id="cb43-1288"><a href="#cb43-1288" aria-hidden="true" tabindex="-1"></a><span class="in">#| out-width: 80%</span></span>
<span id="cb43-1289"><a href="#cb43-1289" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb43-1290"><a href="#cb43-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1291"><a href="#cb43-1291" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb43-1292"><a href="#cb43-1292" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{shapes.geometric}</span></span>
<span id="cb43-1293"><a href="#cb43-1293" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{arrows}</span></span>
<span id="cb43-1294"><a href="#cb43-1294" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{decorations}</span></span>
<span id="cb43-1295"><a href="#cb43-1295" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzstyle{Arrow} = [-&gt;, thin, preaction = {decorate}]</span></span>
<span id="cb43-1296"><a href="#cb43-1296" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzset{&gt;=latex}</span></span>
<span id="cb43-1297"><a href="#cb43-1297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1298"><a href="#cb43-1298" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning, shapes.geometric, arrows.meta, decorations.pathmorphing}</span></span>
<span id="cb43-1299"><a href="#cb43-1299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1300"><a href="#cb43-1300" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzset{</span></span>
<span id="cb43-1301"><a href="#cb43-1301" aria-hidden="true" tabindex="-1"></a><span class="in">  Arrow/.style={-&gt;, &gt;=latex, line width=0.4pt},  % Defines a generic arrow style</span></span>
<span id="cb43-1302"><a href="#cb43-1302" aria-hidden="true" tabindex="-1"></a><span class="in">  emod/.style={rectangle, fill=blue!10, draw=blue, thick, minimum size=6mm},</span></span>
<span id="cb43-1303"><a href="#cb43-1303" aria-hidden="true" tabindex="-1"></a><span class="in">  emoddot/.style={circle, fill=blue!10, draw=blue, dotted, thick, minimum size=6mm}</span></span>
<span id="cb43-1304"><a href="#cb43-1304" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb43-1305"><a href="#cb43-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1306"><a href="#cb43-1306" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[{every node/.append style}=draw, emod/.style={rectangle, fill=blue!10,draw=blue},</span></span>
<span id="cb43-1307"><a href="#cb43-1307" aria-hidden="true" tabindex="-1"></a><span class="in">emoddot/.style={circle, fill=blue!10, draw=blue, dotted}]</span></span>
<span id="cb43-1308"><a href="#cb43-1308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1309"><a href="#cb43-1309" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (A) at (1, 0) {A$_{1}$};</span></span>
<span id="cb43-1310"><a href="#cb43-1310" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (Y) at (3, 0) {Y$_{2}$};</span></span>
<span id="cb43-1311"><a href="#cb43-1311" aria-hidden="true" tabindex="-1"></a><span class="in">\node [emoddot, dotted, draw=blue] (Z) at (-2, 1) {Z};</span></span>
<span id="cb43-1312"><a href="#cb43-1312" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw = black] (G) at (-2, -1) {G};</span></span>
<span id="cb43-1313"><a href="#cb43-1313" aria-hidden="true" tabindex="-1"></a><span class="in">\node [emoddot] (B) at (-1,0) {B};</span></span>
<span id="cb43-1314"><a href="#cb43-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1315"><a href="#cb43-1315" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black] (A) to (Y);</span></span>
<span id="cb43-1316"><a href="#cb43-1316" aria-hidden="true" tabindex="-1"></a><span class="in">\draw[-{Circle[open, fill=none]}, line width=0.25pt, draw=blue, bend left = 20] (Z) to (Y);</span></span>
<span id="cb43-1317"><a href="#cb43-1317" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=blue] (Z) to (B);</span></span>
<span id="cb43-1318"><a href="#cb43-1318" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black] (G) to (B);</span></span>
<span id="cb43-1319"><a href="#cb43-1319" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture} </span></span>
<span id="cb43-1320"><a href="#cb43-1320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1321"><a href="#cb43-1321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-1322"><a href="#cb43-1322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1325"><a href="#cb43-1325" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz}</span></span>
<span id="cb43-1326"><a href="#cb43-1326" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-dag-effect-modification5c</span></span>
<span id="cb43-1327"><a href="#cb43-1327" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Blue path denotes effect-modification. Neither, G nor B are unconditional effect-modifiers for the effect of A on Y after Z is conditioned upon. If investigators condition on Z, the causal diagram implies they will not find evidence for effect-modification by B or G, which are conditionally independent of Y once Z is conditioned upon."</span></span>
<span id="cb43-1328"><a href="#cb43-1328" aria-hidden="true" tabindex="-1"></a><span class="in">#| out-width: 80%</span></span>
<span id="cb43-1329"><a href="#cb43-1329" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb43-1330"><a href="#cb43-1330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1331"><a href="#cb43-1331" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb43-1332"><a href="#cb43-1332" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{shapes.geometric}</span></span>
<span id="cb43-1333"><a href="#cb43-1333" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{arrows}</span></span>
<span id="cb43-1334"><a href="#cb43-1334" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{decorations}</span></span>
<span id="cb43-1335"><a href="#cb43-1335" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzstyle{Arrow} = [-&gt;, thin, preaction = {decorate}]</span></span>
<span id="cb43-1336"><a href="#cb43-1336" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzset{&gt;=latex}</span></span>
<span id="cb43-1337"><a href="#cb43-1337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1338"><a href="#cb43-1338" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning, shapes.geometric, arrows.meta, decorations.pathmorphing}</span></span>
<span id="cb43-1339"><a href="#cb43-1339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1340"><a href="#cb43-1340" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzset{</span></span>
<span id="cb43-1341"><a href="#cb43-1341" aria-hidden="true" tabindex="-1"></a><span class="in">  Arrow/.style={-&gt;, &gt;=latex, line width=0.4pt},  % Defines a generic arrow style</span></span>
<span id="cb43-1342"><a href="#cb43-1342" aria-hidden="true" tabindex="-1"></a><span class="in">  emod/.style={rectangle, fill=blue!10, draw=blue, thick, minimum size=6mm},</span></span>
<span id="cb43-1343"><a href="#cb43-1343" aria-hidden="true" tabindex="-1"></a><span class="in">  emoddot/.style={circle, fill=blue!10, draw=blue, dotted, thick, minimum size=6mm}</span></span>
<span id="cb43-1344"><a href="#cb43-1344" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb43-1345"><a href="#cb43-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1346"><a href="#cb43-1346" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[{every node/.append style}=draw, emod/.style={rectangle, fill=blue!10,draw=blue},</span></span>
<span id="cb43-1347"><a href="#cb43-1347" aria-hidden="true" tabindex="-1"></a><span class="in">emoddot/.style={circle, fill=blue!10, draw=blue, dotted}]</span></span>
<span id="cb43-1348"><a href="#cb43-1348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1349"><a href="#cb43-1349" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (A) at (1, 0) {A$_{1}$};</span></span>
<span id="cb43-1350"><a href="#cb43-1350" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (Y) at (3, 0) {Y$_{2}$};</span></span>
<span id="cb43-1351"><a href="#cb43-1351" aria-hidden="true" tabindex="-1"></a><span class="in">\node [emod, draw=blue] (Z) at (-2, 1) {Z};</span></span>
<span id="cb43-1352"><a href="#cb43-1352" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw = black] (G) at (-2, -1) {G};</span></span>
<span id="cb43-1353"><a href="#cb43-1353" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle] (B) at (-1,0) {B};</span></span>
<span id="cb43-1354"><a href="#cb43-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1355"><a href="#cb43-1355" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black] (A) to (Y);</span></span>
<span id="cb43-1356"><a href="#cb43-1356" aria-hidden="true" tabindex="-1"></a><span class="in">\draw[-{Circle[open, fill=none]}, line width=0.25pt, draw=blue, bend left = 40](Z) to (Y);</span></span>
<span id="cb43-1357"><a href="#cb43-1357" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black] (Z) to (B);</span></span>
<span id="cb43-1358"><a href="#cb43-1358" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black] (G) to (B);</span></span>
<span id="cb43-1359"><a href="#cb43-1359" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture} </span></span>
<span id="cb43-1360"><a href="#cb43-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1361"><a href="#cb43-1361" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-1362"><a href="#cb43-1362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1363"><a href="#cb43-1363" aria-hidden="true" tabindex="-1"></a>@fig-dag-effect-modification5c considers the implications of</span>
<span id="cb43-1364"><a href="#cb43-1364" aria-hidden="true" tabindex="-1"></a>conditioning on $Z$, which is the only unconditional effect-modifier on</span>
<span id="cb43-1365"><a href="#cb43-1365" aria-hidden="true" tabindex="-1"></a>the graph. If $Z$ is measured, conditioning on $Z$ will remove</span>
<span id="cb43-1366"><a href="#cb43-1366" aria-hidden="true" tabindex="-1"></a>effect-modification for $B$ and $G$ because $B,G\coprod Y |Z$. This</span>
<span id="cb43-1367"><a href="#cb43-1367" aria-hidden="true" tabindex="-1"></a>examples again reveals the context dependency of effect-modification.</span>
<span id="cb43-1368"><a href="#cb43-1368" aria-hidden="true" tabindex="-1"></a>Here, causal diagrams are useful for clarifying features of dependent</span>
<span id="cb43-1369"><a href="#cb43-1369" aria-hidden="true" tabindex="-1"></a>and independent effect modification. For further discussion, see:</span>
<span id="cb43-1370"><a href="#cb43-1370" aria-hidden="true" tabindex="-1"></a>@suzuki2013counterfactual; @vanderweele2009distinction.</span>
<span id="cb43-1371"><a href="#cb43-1371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1372"><a href="#cb43-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1373"><a href="#cb43-1373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1374"><a href="#cb43-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1375"><a href="#cb43-1375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1376"><a href="#cb43-1376" aria-hidden="true" tabindex="-1"></a><span class="fu">### Packages</span></span>
<span id="cb43-1377"><a href="#cb43-1377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1380"><a href="#cb43-1380" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-1381"><a href="#cb43-1381" aria-hidden="true" tabindex="-1"></a>report<span class="sc">::</span><span class="fu">cite_packages</span>()</span>
<span id="cb43-1382"><a href="#cb43-1382" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-1383"><a href="#cb43-1383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1384"><a href="#cb43-1384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1385"><a href="#cb43-1385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1386"><a href="#cb43-1386" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>